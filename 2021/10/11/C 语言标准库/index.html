<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)">
<meta name="generator" content="Hexo 5.1.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans+Simplified+Chinese:300,300italic,400,400italic,700,700italic%7CCousine:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/green/pace-theme-minimal.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"zheyizhifeng.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/db.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>
<meta name="description" content="assert.hassert()assert.h头文件定义了宏assert()，用于在运行时确保程序符合指定条件，如果不符合，就报错终止运行。 assert(PI &gt; 3);  上面代码在程序运行到这一行语句时，验证变量是否PI大于3。如果确实大于3，程序继续运行，否则就会终止运行，并且给出报错信息提示。">
<meta property="og:type" content="article">
<meta property="og:title" content="C 语言——标准库">
<meta property="og:url" content="https://zheyizhifeng.github.io/2021/10/11/C%20%E8%AF%AD%E8%A8%80%E6%A0%87%E5%87%86%E5%BA%93/index.html">
<meta property="og:site_name" content="Lucida&#39;s Blog">
<meta property="og:description" content="assert.hassert()assert.h头文件定义了宏assert()，用于在运行时确保程序符合指定条件，如果不符合，就报错终止运行。 assert(PI &gt; 3);  上面代码在程序运行到这一行语句时，验证变量是否PI大于3。如果确实大于3，程序继续运行，否则就会终止运行，并且给出报错信息提示。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-10-11T09:33:57.000Z">
<meta property="article:modified_time" content="2021-10-13T08:30:50.517Z">
<meta property="article:author" content="lucida">
<meta property="article:tag" content="Programming">
<meta property="article:tag" content="C 语言">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://zheyizhifeng.github.io/2021/10/11/C%20%E8%AF%AD%E8%A8%80%E6%A0%87%E5%87%86%E5%BA%93/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://zheyizhifeng.github.io/2021/10/11/C%20%E8%AF%AD%E8%A8%80%E6%A0%87%E5%87%86%E5%BA%93/","path":"2021/10/11/C 语言标准库/","title":"C 语言——标准库"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>C 语言——标准库 | Lucida's Blog</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Lucida's Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Stay Hungry, Stay Foolish</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">27</span></a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">20</span></a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">15</span></a></li>
        <li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#assert-h"><span class="nav-number">1.</span> <span class="nav-text">assert.h</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#assert"><span class="nav-number">1.1.</span> <span class="nav-text">assert()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#static-assert"><span class="nav-number">1.2.</span> <span class="nav-text">static_assert()</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ctype-h"><span class="nav-number">2.</span> <span class="nav-text">ctype.h</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E6%B5%8B%E8%AF%95%E5%87%BD%E6%95%B0"><span class="nav-number">2.1.</span> <span class="nav-text">字符测试函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E6%98%A0%E5%B0%84%E5%87%BD%E6%95%B0"><span class="nav-number">2.2.</span> <span class="nav-text">字符映射函数</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#errno-h"><span class="nav-number">3.</span> <span class="nav-text">errno.h</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#errno-%E5%8F%98%E9%87%8F"><span class="nav-number">3.1.</span> <span class="nav-text">errno 变量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%8F"><span class="nav-number">3.2.</span> <span class="nav-text">宏</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#float-h"><span class="nav-number">4.</span> <span class="nav-text">float.h</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#inttypes-h"><span class="nav-number">5.</span> <span class="nav-text">inttypes.h</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#iso646-h"><span class="nav-number">6.</span> <span class="nav-text">iso646.h</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#limits-h"><span class="nav-number">7.</span> <span class="nav-text">limits.h</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#locale-h"><span class="nav-number">8.</span> <span class="nav-text">locale.h</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B"><span class="nav-number">8.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#setlocale"><span class="nav-number">8.2.</span> <span class="nav-text">setlocale()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#localeconv"><span class="nav-number">8.3.</span> <span class="nav-text">localeconv()</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#math-h"><span class="nav-number">9.</span> <span class="nav-text">math.h</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B1%BB%E5%9E%8B%E5%92%8C%E5%AE%8F"><span class="nav-number">9.1.</span> <span class="nav-text">类型和宏</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%94%99%E8%AF%AF%E7%B1%BB%E5%9E%8B"><span class="nav-number">9.2.</span> <span class="nav-text">错误类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E5%80%BC%E7%B1%BB%E5%9E%8B"><span class="nav-number">9.3.</span> <span class="nav-text">数值类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#signbit"><span class="nav-number">9.4.</span> <span class="nav-text">signbit()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E8%A7%92%E5%87%BD%E6%95%B0"><span class="nav-number">9.5.</span> <span class="nav-text">三角函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%8C%E6%9B%B2%E5%87%BD%E6%95%B0"><span class="nav-number">9.6.</span> <span class="nav-text">双曲函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8C%87%E6%95%B0%E5%87%BD%E6%95%B0%E5%92%8C%E5%AF%B9%E6%95%B0%E5%87%BD%E6%95%B0"><span class="nav-number">9.7.</span> <span class="nav-text">指数函数和对数函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#frexp"><span class="nav-number">9.8.</span> <span class="nav-text">frexp()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ilogb"><span class="nav-number">9.9.</span> <span class="nav-text">ilogb()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ldexp"><span class="nav-number">9.10.</span> <span class="nav-text">ldexp()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#modf"><span class="nav-number">9.11.</span> <span class="nav-text">modf()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#scalbn"><span class="nav-number">9.12.</span> <span class="nav-text">scalbn()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#round"><span class="nav-number">9.13.</span> <span class="nav-text">round()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#trunc"><span class="nav-number">9.14.</span> <span class="nav-text">trunc()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ceil"><span class="nav-number">9.15.</span> <span class="nav-text">ceil()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#floor"><span class="nav-number">9.16.</span> <span class="nav-text">floor()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#fmod"><span class="nav-number">9.17.</span> <span class="nav-text">fmod()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%AE%E7%82%B9%E6%95%B0%E6%AF%94%E8%BE%83%E5%87%BD%E6%95%B0"><span class="nav-number">9.18.</span> <span class="nav-text">浮点数比较函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#isunordered"><span class="nav-number">9.19.</span> <span class="nav-text">isunordered()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E5%87%BD%E6%95%B0"><span class="nav-number">9.20.</span> <span class="nav-text">其他函数</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#signal-h"><span class="nav-number">10.</span> <span class="nav-text">signal.h</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-1"><span class="nav-number">10.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#signal"><span class="nav-number">10.2.</span> <span class="nav-text">signal()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%A1%E5%8F%B7%E7%9B%B8%E5%85%B3%E7%9A%84%E5%AE%8F"><span class="nav-number">10.3.</span> <span class="nav-text">信号相关的宏</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#raise"><span class="nav-number">10.4.</span> <span class="nav-text">raise()</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#stdarg-h"><span class="nav-number">11.</span> <span class="nav-text">stdarg.h</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#stdbool-h"><span class="nav-number">12.</span> <span class="nav-text">stdbool.h</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#stddef-h"><span class="nav-number">13.</span> <span class="nav-text">stddef.h</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#offsetof"><span class="nav-number">13.1.</span> <span class="nav-text">offsetof()</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#stdint-h"><span class="nav-number">14.</span> <span class="nav-text">stdint.h</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%BA%E5%AE%9A%E5%AE%BD%E5%BA%A6%E7%9A%84%E6%95%B4%E6%95%B0%E7%B1%BB%E5%9E%8B"><span class="nav-number">14.1.</span> <span class="nav-text">固定宽度的整数类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%80%E5%A4%A7%E5%AE%BD%E5%BA%A6%E7%9A%84%E6%95%B4%E6%95%B0%E7%B1%BB%E5%9E%8B"><span class="nav-number">14.2.</span> <span class="nav-text">最大宽度的整数类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%BA%E5%AE%9A%E5%AE%BD%E5%BA%A6%E7%9A%84%E6%95%B4%E6%95%B0%E5%B8%B8%E9%87%8F"><span class="nav-number">14.3.</span> <span class="nav-text">固定宽度的整数常量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%BA%E5%AE%9A%E5%AE%BD%E5%BA%A6%E7%9A%84%E6%95%B4%E6%95%B0%E6%9E%81%E9%99%90%E5%80%BC"><span class="nav-number">14.4.</span> <span class="nav-text">固定宽度的整数极限值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%A0%E4%BD%8D%E7%AC%A6"><span class="nav-number">14.5.</span> <span class="nav-text">占位符</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#stdio-h"><span class="nav-number">15.</span> <span class="nav-text">stdio.h</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%87%E5%87%86-I-O-%E5%87%BD%E6%95%B0"><span class="nav-number">15.1.</span> <span class="nav-text">标准 I&#x2F;O 函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E5%87%BD%E6%95%B0"><span class="nav-number">15.2.</span> <span class="nav-text">文件操作函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%93%8D%E4%BD%9C%E5%87%BD%E6%95%B0"><span class="nav-number">15.3.</span> <span class="nav-text">字符串操作函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#tmpfile"><span class="nav-number">15.4.</span> <span class="nav-text">tmpfile()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#tmpnam"><span class="nav-number">15.5.</span> <span class="nav-text">tmpnam()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#fflush"><span class="nav-number">15.6.</span> <span class="nav-text">fflush()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#setvbuf"><span class="nav-number">15.7.</span> <span class="nav-text">setvbuf()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#setbuf"><span class="nav-number">15.8.</span> <span class="nav-text">setbuf()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ungetc"><span class="nav-number">15.9.</span> <span class="nav-text">ungetc()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#perror"><span class="nav-number">15.10.</span> <span class="nav-text">perror()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0%E6%93%8D%E4%BD%9C%E5%87%BD%E6%95%B0"><span class="nav-number">15.11.</span> <span class="nav-text">可变参数操作函数</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#stdlib-h"><span class="nav-number">16.</span> <span class="nav-text">stdlib.h</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B1%BB%E5%9E%8B%E5%88%AB%E5%90%8D%E5%92%8C%E5%AE%8F"><span class="nav-number">16.1.</span> <span class="nav-text">类型别名和宏</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#abs-%EF%BC%8Clabs-%EF%BC%8Cllabs"><span class="nav-number">16.2.</span> <span class="nav-text">abs()，labs()，llabs()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#div-%EF%BC%8Cldiv-%EF%BC%8Clldiv"><span class="nav-number">16.3.</span> <span class="nav-text">div()，ldiv()，lldiv()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%AC%E6%88%90%E6%95%B0%E5%80%BC"><span class="nav-number">16.4.</span> <span class="nav-text">字符串转成数值</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#a-%E7%B3%BB%E5%88%97%E5%87%BD%E6%95%B0"><span class="nav-number">16.4.1.</span> <span class="nav-text">a 系列函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#str-%E7%B3%BB%E5%88%97%E5%87%BD%E6%95%B0%EF%BC%88%E6%B5%AE%E7%82%B9%E6%95%B0%E8%BD%AC%E6%8D%A2%EF%BC%89"><span class="nav-number">16.4.2.</span> <span class="nav-text">str 系列函数（浮点数转换）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#str-%E7%B3%BB%E5%88%97%E5%87%BD%E6%95%B0%EF%BC%88%E6%95%B4%E6%95%B0%E8%BD%AC%E6%8D%A2%EF%BC%89"><span class="nav-number">16.4.3.</span> <span class="nav-text">str 系列函数（整数转换）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#rand"><span class="nav-number">16.5.</span> <span class="nav-text">rand()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#srand"><span class="nav-number">16.6.</span> <span class="nav-text">srand()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#abort"><span class="nav-number">16.7.</span> <span class="nav-text">abort()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#exit-%EF%BC%8Cquick-exit-%EF%BC%8C-Exit"><span class="nav-number">16.8.</span> <span class="nav-text">exit()，quick_exit()，_Exit()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#atexit-%EF%BC%8Cat-quick-exit"><span class="nav-number">16.9.</span> <span class="nav-text">atexit()，at_quick_exit()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#getenv"><span class="nav-number">16.10.</span> <span class="nav-text">getenv()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#system"><span class="nav-number">16.11.</span> <span class="nav-text">system()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E5%87%BD%E6%95%B0"><span class="nav-number">16.12.</span> <span class="nav-text">内存管理函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#aligned-alloc"><span class="nav-number">16.12.1.</span> <span class="nav-text">aligned_alloc()</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#qsort"><span class="nav-number">16.13.</span> <span class="nav-text">qsort()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#bsearch"><span class="nav-number">16.14.</span> <span class="nav-text">bsearch()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%9A%E5%AD%97%E8%8A%82%E5%AD%97%E7%AC%A6%E5%87%BD%E6%95%B0"><span class="nav-number">16.15.</span> <span class="nav-text">多字节字符函数</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#string-h"><span class="nav-number">17.</span> <span class="nav-text">string.h</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0"><span class="nav-number">17.1.</span> <span class="nav-text">字符串处理函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#strchr-%EF%BC%8Cstrrchr"><span class="nav-number">17.1.1.</span> <span class="nav-text">strchr()，strrchr()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#strspn-%EF%BC%8Cstrcspn"><span class="nav-number">17.1.2.</span> <span class="nav-text">strspn()，strcspn()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#strpbrk"><span class="nav-number">17.1.3.</span> <span class="nav-text">strpbrk()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#strstr"><span class="nav-number">17.1.4.</span> <span class="nav-text">strstr()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#strtok"><span class="nav-number">17.1.5.</span> <span class="nav-text">strtok()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#strcoll"><span class="nav-number">17.1.6.</span> <span class="nav-text">strcoll()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#strxfrm"><span class="nav-number">17.1.7.</span> <span class="nav-text">strxfrm()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#strerror"><span class="nav-number">17.1.8.</span> <span class="nav-text">strerror()</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E6%93%8D%E4%BD%9C%E5%87%BD%E6%95%B0"><span class="nav-number">17.2.</span> <span class="nav-text">内存操作函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#memchr"><span class="nav-number">17.2.1.</span> <span class="nav-text">memchr()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#memset"><span class="nav-number">17.2.2.</span> <span class="nav-text">memset()</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E5%87%BD%E6%95%B0-1"><span class="nav-number">17.3.</span> <span class="nav-text">其他函数</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#time-h"><span class="nav-number">18.</span> <span class="nav-text">time.h</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#time-t"><span class="nav-number">18.1.</span> <span class="nav-text">time_t</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#struct-tm"><span class="nav-number">18.2.</span> <span class="nav-text">struct tm</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#time"><span class="nav-number">18.3.</span> <span class="nav-text">time()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ctime"><span class="nav-number">18.4.</span> <span class="nav-text">ctime()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#localtime-%EF%BC%8Cgmtime"><span class="nav-number">18.5.</span> <span class="nav-text">localtime()，gmtime()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#asctime"><span class="nav-number">18.6.</span> <span class="nav-text">asctime()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mktime"><span class="nav-number">18.7.</span> <span class="nav-text">mktime()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#difftime"><span class="nav-number">18.8.</span> <span class="nav-text">difftime()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#strftime"><span class="nav-number">18.9.</span> <span class="nav-text">strftime()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#timespec-get"><span class="nav-number">18.10.</span> <span class="nav-text">timespec_get()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#clock"><span class="nav-number">18.11.</span> <span class="nav-text">clock()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"><span class="nav-number">18.12.</span> <span class="nav-text">参考链接</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#wchar-h"><span class="nav-number">19.</span> <span class="nav-text">wchar.h</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B1%BB%E5%9E%8B%E5%88%AB%E5%90%8D%E5%92%8C%E5%AE%8F-1"><span class="nav-number">19.1.</span> <span class="nav-text">类型别名和宏</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#btowc-%EF%BC%8Cwctob"><span class="nav-number">19.2.</span> <span class="nav-text">btowc()，wctob()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#fwide"><span class="nav-number">19.3.</span> <span class="nav-text">fwide()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%BD%E5%AD%97%E7%AC%A6%E4%B8%93%E7%94%A8%E5%87%BD%E6%95%B0"><span class="nav-number">19.4.</span> <span class="nav-text">宽字符专用函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%9A%E5%AD%97%E8%8A%82%E5%AD%97%E7%AC%A6%E4%B8%93%E7%94%A8%E5%87%BD%E6%95%B0"><span class="nav-number">19.5.</span> <span class="nav-text">多字节字符专用函数</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#wctype-h"><span class="nav-number">20.</span> <span class="nav-text">wctype.h</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%BD%E5%AD%97%E7%AC%A6%E7%B1%BB%E5%9E%8B%E5%88%A4%E6%96%AD%E5%87%BD%E6%95%B0"><span class="nav-number">20.1.</span> <span class="nav-text">宽字符类型判断函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#wctype-%EF%BC%8Ciswctype"><span class="nav-number">20.2.</span> <span class="nav-text">wctype()，iswctype()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%A7%E5%B0%8F%E5%86%99%E8%BD%AC%E6%8D%A2%E5%87%BD%E6%95%B0"><span class="nav-number">20.3.</span> <span class="nav-text">大小写转换函数</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="lucida"
      src="/images/avatar.jpeg">
  <p class="site-author-name" itemprop="name">lucida</p>
  <div class="site-description" itemprop="description">文质彬彬，然后君子</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">15</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/zheyizhifeng" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zheyizhifeng" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:zheyizhifeng@126.com" title="E-Mail → mailto:zheyizhifeng@126.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/zheyizhifeng" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;zheyizhifeng" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/zheyizhifeng" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;zheyizhifeng" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.facebook.com/zheyizhifeng" title="FB Page → https:&#x2F;&#x2F;www.facebook.com&#x2F;zheyizhifeng" rel="noopener" target="_blank"><i class="fab fa-facebook fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="skype:zheyizhifeng?call|chat" title="Skype → skype:zheyizhifeng?call|chat" rel="noopener" target="_blank"><i class="fab fa-skype fa-fw"></i></a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/zheyizhifeng" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://zheyizhifeng.github.io/2021/10/11/C%20%E8%AF%AD%E8%A8%80%E6%A0%87%E5%87%86%E5%BA%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="lucida">
      <meta itemprop="description" content="文质彬彬，然后君子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucida's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          C 语言——标准库
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-10-11 17:33:57" itemprop="dateCreated datePublished" datetime="2021-10-11T17:33:57+08:00">2021-10-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-10-13 16:30:50" itemprop="dateModified" datetime="2021-10-13T16:30:50+08:00">2021-10-13</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming/" itemprop="url" rel="index"><span itemprop="name">Programming</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming/C-%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">C 语言</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="assert-h"><a href="#assert-h" class="headerlink" title="assert.h"></a>assert.h</h1><h2 id="assert"><a href="#assert" class="headerlink" title="assert()"></a>assert()</h2><p><code>assert.h</code>头文件定义了宏<code>assert()</code>，用于在运行时确保程序符合指定条件，如果不符合，就报错终止运行。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">assert</span><span class="token punctuation">(</span>PI <span class="token operator">></span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>上面代码在程序运行到这一行语句时，验证变量是否<code>PI</code>大于3。如果确实大于3，程序继续运行，否则就会终止运行，并且给出报错信息提示。</p>
<a id="more"></a>

<p><code>assert()</code>宏接受一个表达式作为参数，如果表达式的返回值非零，<code>assert()</code>就会报错，在标准错误流<code>stderr</code>中写入一条错误信息，显示没有通过的表达式，以及包含这个表达式的文件名和行号。最后，调用<code>abort()</code>函数终止程序（<code>abort()</code>函数的原型在<code>stdlib.h</code>头文件中）。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">z <span class="token operator">=</span> x <span class="token operator">*</span> x <span class="token operator">-</span> y <span class="token operator">*</span> y<span class="token punctuation">;</span>
<span class="token function">assert</span><span class="token punctuation">(</span>z <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>上面的<code>assert()</code>语句类似于下面的代码。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">if</span> <span class="token punctuation">(</span>z <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"z less than 0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>如果断言失败，程序会中断执行，会显示下面的提示。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">Assertion failed<span class="token operator">:</span> <span class="token punctuation">(</span>z <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> function main<span class="token punctuation">,</span> file <span class="token operator">/</span>Users<span class="token operator">/</span>assert<span class="token punctuation">.</span>c<span class="token punctuation">,</span> line <span class="token number">14.</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>上面报错的格式如下。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">Assertion failed<span class="token operator">:</span> <span class="token punctuation">[</span>expression<span class="token punctuation">]</span><span class="token punctuation">,</span> function <span class="token punctuation">[</span>abc<span class="token punctuation">]</span><span class="token punctuation">,</span> file <span class="token punctuation">[</span>xyz<span class="token punctuation">]</span><span class="token punctuation">,</span> line <span class="token punctuation">[</span>nnn<span class="token punctuation">]</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>上面代码中，方括号的部分使用实际数据替换掉。</p>
<p>使用 assert() 有几个好处：它不仅能自动标识文件和出问题的行号，还有一种无需更改代码就能开启或关闭 assert() 的机制。如果已经确认程序没有问题，不需要再做断言，就在<code>#include &lt;assert.h&gt;</code>语句的前面，定义一个宏<code>NDEBUG</code>。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">NDEBUG</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;assert.h></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>然后，重新编译程序，编译器就会禁用文件中所有的 assert() 语句。如果程序又出现问题，可以移除这条<code>#define NDBUG</code>指令（或者把它注释掉），再次编译，这样就重新启用了 assert() 语句。</p>
<p>assert() 的缺点是，因为引入了额外的检查，增加了程序的运行时间。</p>
<h2 id="static-assert"><a href="#static-assert" class="headerlink" title="static_assert()"></a>static_assert()</h2><p>C11 引入了静态断言<code>static_assert()</code>，用于在编译阶段进行断言判断。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">static_assert</span><span class="token punctuation">(</span>constant<span class="token operator">-</span>expression<span class="token punctuation">,</span> string<span class="token operator">-</span>literal<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><code>static_assert()</code>接受两个参数，第一个参数<code>constant-expression</code>是一个常量表达式，第二个参数<code>string-literal</code>是一个提示字符串。如果第一个参数的值为false，会产生一条编译错误，第二个参数就是错误提示信息。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">static_assert</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">"64-bit code generation is not supported."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>上面代码的意思是，如果当前计算机的<code>int</code>类型不等于4个字节，就会编译报错。</p>
<p>注意，<code>static_assert()</code>只在编译阶段运行，无法获得变量的值。如果对变量进行静态断言，就会导致编译错误。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">positive</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">static_assert</span><span class="token punctuation">(</span>n <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"value must > 0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面代码会导致编译报错，因为编译时无法知道变量<code>n</code>的值。</p>
<p><code>static_assert()</code>的好处是，尽量在编译阶段发现错误，避免运行时再报错，节省开发时间。另外，有些<code>assert()</code>断言位于函数之中，如果不执行该函数，就不会报错，而<code>static_assert()</code>不管函数是否执行，都会进行断言判断。最后，<code>static_assert()</code>不会生成可执行代码，所以不会造成任何运行时的性能损失。</p>
<h1 id="ctype-h"><a href="#ctype-h" class="headerlink" title="ctype.h"></a>ctype.h</h1><p><code>ctype.h</code>头文件定义了一系列字符处理函数的原型。</p>
<h2 id="字符测试函数"><a href="#字符测试函数" class="headerlink" title="字符测试函数"></a>字符测试函数</h2><p>这些函数用来判断字符是否属于某种类型。</p>
<ul>
<li><code>isalnum()</code>：是否为字母数字</li>
<li><code>isalpha()</code>：是否为字母</li>
<li><code>isdigit()</code>：是否为数字</li>
<li><code>isxdigit()</code>：是否为十六进制数字符</li>
<li><code>islower()</code>：是否为小写字母</li>
<li><code>isupper()</code>：是否为大写字母</li>
<li><code>isblank()</code>：是否为标准的空白字符（包含空格、水平制表符或换行符）</li>
<li><code>isspace()</code>：是否为空白字符（空格、换行符、换页符、回车符、垂直制表符、水平制表符等）</li>
<li><code>iscntrl()</code>：是否为控制字符，比如 Ctrl + B</li>
<li><code>isprint()</code>：是否为可打印字符</li>
<li><code>isgraph()</code>：是否为空格以外的任意可打印字符</li>
<li><code>ispunct()</code>：是否为标点符号（除了空格、字母、数字以外的可打印字符）</li>
</ul>
<p>它们接受一个待测试的字符作为参数。注意，参数类型为<code>int</code>，而不是<code>char</code>，因为它们允许 EOF 作为参数。</p>
<p>如果参数字符属于指定类型，就返回一个非零整数（通常是<code>1</code>，表示为真），否则返回<code>0</code>（表示为伪）。</p>
<p>下面是一个例子，用户输入一个字符，程序判断是否为英文字母。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;ctype.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">char</span> ch <span class="token operator">=</span> <span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isalpha</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"it is an alpha character.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"it is not an alpha character.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="字符映射函数"><a href="#字符映射函数" class="headerlink" title="字符映射函数"></a>字符映射函数</h2><p>这一类函数返回字符的某种对应形式，主要有两个函数。</p>
<ul>
<li><code>tolower()</code>：如果参数是大写字符，返回小写字符，否则返回原始参数。</li>
<li><code>toupper()</code>：如果参数是小写字符，返回大写字符，否则返回原始参数。</li>
</ul>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// 将字符转为大写</span>
ch <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>注意，这两个函数不会改变原始字符。</p>
<h1 id="errno-h"><a href="#errno-h" class="headerlink" title="errno.h"></a>errno.h</h1><h2 id="errno-变量"><a href="#errno-变量" class="headerlink" title="errno 变量"></a>errno 变量</h2><p><code>errno.h</code>声明了一个 int 类型的 errno 变量，用来存储错误码（正整数）。</p>
<p>如果这个变量有非零值，表示已经执行的程序发生了错误。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

errno <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> y <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>errno <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"sqrt error; program terminated.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面示例中，计算一个负值的平方根是不允许的，会导致<code>errno</code>不等于<code>0</code>。</p>
<p>如果要检查某个函数是否发生错误，必须在即将调用该函数之前，将<code>errno</code>的值置为0，防止其他函数改变<code>errno</code>的值。</p>
<h2 id="宏"><a href="#宏" class="headerlink" title="宏"></a>宏</h2><p>变量<code>errno</code>的值通常是两个宏<code>EDOM</code>或<code>ERANGE</code>。这两个宏都定义在<code>errno.h</code>。它们表示调用数学函数时，可能发生的两种错误。</p>
<ul>
<li>定义域错误（EDOM）：传递给函数的一个参数超出了函数的定义域。例如，负数传入<code>sqrt()</code>作为参数。</li>
<li>取值范围错误（ERANGE）：函数的返回值太大，无法用返回类型表示。例如，1000 传入<code>exp()</code>作为参数，因为 e^1000 太大，无法使用 double 类型表示。</li>
</ul>
<p>使用数学函数时，可以将<code>errno</code>的值与 EDOM 和 ERANGE 比较，用来确定到底发生了哪一类错误。</p>
<h1 id="float-h"><a href="#float-h" class="headerlink" title="float.h"></a>float.h</h1><p><code>float.h</code>定义了浮点数类型 float、double、long double 的一些宏，规定了这些类型的范围和精度。</p>
<p>(1) <code>FLT_ROUNDS</code></p>
<p>宏<code>FLT_ROUNDS</code>表示当前浮点数加法的四舍五入方向。</p>
<p>它有以下可能的值。</p>
<ul>
<li>-1：不确定。</li>
<li>0：向零舍入。</li>
<li>1：向最近的整数舍入。</li>
<li>2：向正无穷方向舍入。</li>
<li>3：向负无穷方向舍入。</li>
</ul>
<p>（2）<code>FLT_RADIX</code></p>
<p>宏<code>FLT_RADIX</code>表示科学计数法的指数部分的底（base），一般总是2。</p>
<p>（3）浮点数类型的最大值</p>
<ul>
<li><code>FLT_MAX</code></li>
<li><code>DBL_MAX</code></li>
<li><code>LDBL_MAX</code></li>
</ul>
<p>（4）浮点数类型的最小正值</p>
<ul>
<li><code>FLT_MIN</code></li>
<li><code>DBL_MIN</code></li>
<li><code>LDBL_MIN</code></li>
</ul>
<p>（5）两个同类型浮点数之间可表示的最小差值（最小精度）</p>
<ul>
<li><code>FLT_EPSILON</code></li>
<li><code>DBL_EPSILON</code></li>
<li><code>LDBL_EPSILON</code></li>
</ul>
<p>（6）<code>DECIMAL_DIG</code></p>
<p>宏<code>DECIMAL_DIG</code>表示十进制有效位数。</p>
<p>（7）<code>FLT_EVAL_METHOD</code></p>
<p>宏<code>FLT_EVAL_METHOD</code>表示浮点数运算时的类型转换。</p>
<p>它可能有以下值。</p>
<ul>
<li>-1：不确定。</li>
<li>0：在当前类型中运算。</li>
<li>1：float 和 double 类型的运算使用 double 类型的范围和精度求值。</li>
<li>2：所有浮点数类型的运算使用 long double 类型的范围和精度求值。</li>
</ul>
<p>（8）浮点数尾数部分的个数</p>
<ul>
<li><code>FLT_MANT_DIG</code></li>
<li><code>DBL_MANT_DIG</code></li>
<li><code>LDBL_MANT_DIG</code></li>
</ul>
<p>（9）浮点数指数部分有效数字的个数（十进制）</p>
<ul>
<li><code>FLT_DIG</code></li>
<li><code>DBL_DIG</code></li>
<li><code>LDBL_DIG</code></li>
</ul>
<p>（10）科学计数法的指数部分的最小次幂（负数）</p>
<ul>
<li><code>FLT_MIN_EXP</code></li>
<li><code>DBL_MIN_EXP</code></li>
<li><code>LDBL_MIN_EXP</code></li>
</ul>
<p>（11）科学计数法的指数部分的十进制最小次幂（负数）</p>
<ul>
<li><code>FLT_MIN_10_EXP</code></li>
<li><code>DBL_MIN_10_EXP</code></li>
<li><code>LDBL_MIN_10_EXP</code></li>
</ul>
<p>（12）科学计数法的指数部分的最大次幂</p>
<ul>
<li><code>FLT_MAX_EXP</code></li>
<li><code>DBL_MAX_EXP</code></li>
<li><code>LDBL_MAX_EXP</code></li>
</ul>
<p>科学计数法的指数部分的十进制最大次幂</p>
<ul>
<li><code>FLT_MAX_10_EXP</code></li>
<li><code>DBL_MAX_10_EXP</code></li>
<li><code>LDBL_MAX_10_EXP</code></li>
</ul>
<h1 id="inttypes-h"><a href="#inttypes-h" class="headerlink" title="inttypes.h"></a>inttypes.h</h1><p>C 语言还在头文件 inttypes.h 里面，为 stdint.h 定义的四类整数类型，提供了<code>printf()</code>和<code>scanf()</code>的占位符。</p>
<ul>
<li>固定宽度整数类型，比如 int8_t。</li>
<li>最小宽度整数类型，比如 int_least8_t。</li>
<li>最快最小宽度整数类型，比如 int_fast8_t。</li>
<li>最大宽度整数类型，比如 intmax_t。</li>
</ul>
<p><code>printf()</code>的占位符采用<code>PRI + 原始占位符 + 类型关键字/宽度</code>的形式构成。举例来说，原始占位符为<code>%d</code>，则对应的占位符如下。</p>
<ul>
<li>PRIdn （固定宽度类型）</li>
<li>PRIdLEASTn （最小宽度类型）</li>
<li>PRIdFASTn （最快最小宽度类型）</li>
<li>PRIdMAX （最大宽度类型）</li>
</ul>
<p>上面占位符中的<code>n</code>，可以用8、16、32、64代入。</p>
<p>下面是用法示例。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdint.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;inttypes.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  int_least16_t x <span class="token operator">=</span> <span class="token number">3490</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The value is %"</span> PRIdLEAST16 <span class="token string">"!\n"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面示例中，<code>PRIdLEAST16</code>对应的整数类型为 int_least16_t，原始占位符为<code>%d</code>。另外，<code>printf()</code>的第一个参数用到了多个字符串自动合并的写法。</p>
<p>下面是其它的原始占位符对应的占位符。</p>
<ul>
<li>%i：PRIin    PRIiLEASTn    PRIiFASTn    PRIiMAX</li>
<li>%o：PRIon    PRIoLEASTn    PRIoFASTn    PRIoMAX</li>
<li>%u：PRIun    PRIuLEASTn    PRIuFASTn    PRIuMAX</li>
<li>%x：PRIxn    PRIxLEASTn    PRIxFASTn    PRIxMAX</li>
<li>%X：PRIXn    PRIXLEASTn    PRIXFASTn    PRIXMAX</li>
</ul>
<p><code>scanf()</code>的占位符规则也与之类似。</p>
<ul>
<li>%d：SCNdn    SCNdLEASTn    SCNdFASTn    SCNdMAX</li>
<li>%i：SCNin    SCNiLEASTn    SCNiFASTn    SCNiMAX</li>
<li>%o：SCNon    SCNoLEASTn    SCNoFASTn    SCNoMAX</li>
<li>%u：SCNun    SCNuLEASTn    SCNuFASTn    SCNuMAX</li>
<li>%x：SCNxn    SCNxLEASTn    SCNxFASTn    SCNxMAX</li>
</ul>
<h1 id="iso646-h"><a href="#iso646-h" class="headerlink" title="iso646.h"></a>iso646.h</h1><p><code>iso646.h</code>头文件指定了一些常见运算符的替代拼写。比如，它用关键字<code>and</code>代替逻辑运算符<code>&amp;&amp;</code>。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">></span> <span class="token number">6</span> and x <span class="token operator">&lt;</span> <span class="token number">12</span><span class="token punctuation">)</span>
<span class="token comment">// 等同于</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">></span> <span class="token number">6</span> <span class="token operator">&amp;&amp;</span> x <span class="token operator">&lt;</span> <span class="token number">12</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>它定义的替代拼写如下。</p>
<ul>
<li>and    替代 &amp;&amp;</li>
<li>and_eq 替代 &amp;=</li>
<li>bitand 替代 &amp;</li>
<li>bitor 替代 |</li>
<li>compl 替代 ~</li>
<li>not 替代 !</li>
<li>not_eq 替代 !=</li>
<li>or 替代 ||</li>
<li>or_eq 替代 |=</li>
<li>xor 替代 ^</li>
<li>xor_eq 替代 ^=</li>
</ul>
<h1 id="limits-h"><a href="#limits-h" class="headerlink" title="limits.h"></a>limits.h</h1><p><code>limits.h</code>提供了用来定义各种整数类型（包括字符类型）取值范围的宏。</p>
<ul>
<li><code>CHAR_BIT</code>：每个字符包含的二进制位数。</li>
<li><code>SCHAR_MIN</code>：signed char 类型的最小值。</li>
<li><code>SCHAR_MAX</code>：signed char 类型的最大值。</li>
<li><code>UCHAR_MAX</code>：unsiged char 类型的最大值。</li>
<li><code>CHAR_MIN</code>：char 类型的最小值。</li>
<li><code>CHAR_MAX</code>：char 类型的最大值。</li>
<li><code>MB_LEN_MAX</code>：多字节字符最多包含的字节数。</li>
<li><code>SHRT_MIN</code>：short int 类型的最小值。</li>
<li><code>SHRT_MAX</code>：short int 类型的最大值。</li>
<li><code>USHRT_MAX</code>：unsigned short int 类型的最大值。</li>
<li><code>INT_MIN</code>：int 类型的最小值。</li>
<li><code>INT_MAX</code>：int 类型的最大值。</li>
<li><code>UINT_MAX</code>：unsigned int 类型的最大值。</li>
<li><code>LONG_MIN</code>：long int 类型的最小值。</li>
<li><code>LONG_MAX</code>：long int 类型的最大值。</li>
<li><code>ULONG_MAX</code>：unsigned long int 类型的最大值。</li>
<li><code>LLONG_MIN</code>：long long int 类型的最小值。</li>
<li><code>LLONG_MAX</code>：long long int 类型的最大值。</li>
<li><code>ULLONG_MAX</code>：unsigned long long int 类型的最大值。</li>
</ul>
<p>下面的示例是使用预处理指令判断，int 类型是否可以用来存储大于 100000 的数。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">INT_MAX <span class="token operator">&lt;</span> <span class="token number">100000</span></span></span>
  <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">error</span> <span class="token expression"><span class="token keyword">int</span> type is too small</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>上面示例中，如果 int 类型太小，预处理器会显示一条出错消息。</p>
<p>可以使用<code>limit.h</code>里面的宏，为类型别名选择正确的底层类型。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">INT_MAX <span class="token operator">>=</span> <span class="token number">100000</span></span></span>
  <span class="token keyword">typedef</span> <span class="token keyword">int</span> Quantity<span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
  <span class="token keyword">typedef</span> <span class="token keyword">long</span> <span class="token keyword">int</span> Quantity<span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面示例中，如果整数类型的最大值（<code>INT_MAX</code>）不小于100000，那么类型别名<code>Quantity</code>指向<code>int</code>，否则就指向<code>long int</code>。</p>
<h1 id="locale-h"><a href="#locale-h" class="headerlink" title="locale.h"></a>locale.h</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><code>locale.h</code>是程序的本地化设置，主要影响以下的行为。</p>
<ul>
<li>数字格式</li>
<li>货币格式</li>
<li>字符集</li>
<li>日期和时间格式</li>
</ul>
<p>它设置了以下几个宏。</p>
<ul>
<li>LC_COLLATE：影响字符串比较函数<code>strcoll()</code>和<code>strxfrm()</code>。</li>
<li>LC_CTYPE：影响字符处理函数的行为。</li>
<li>LC_MONETARY：影响货币格式。</li>
<li>LC_NUMERIC：影响<code>printf()</code>的数字格式。</li>
<li>LC_TIME：影响时间格式<code>strftime()</code>和<code>wcsftime()</code>。</li>
<li>LC_ALL：将以上所有类别设置为给定的语言环境。</li>
</ul>
<h2 id="setlocale"><a href="#setlocale" class="headerlink" title="setlocale()"></a>setlocale()</h2><p><code>setlocale()</code>用来设置当前的地区。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">setlocal</span><span class="token punctuation">(</span><span class="token keyword">int</span> category<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> locale<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>它接受两个参数。第一个参数表示影响范围，如果值为前面五个表示类别的宏之一，则只影响该宏对应的类别，如果值为<code>LC_ALL</code>，则影响所有类别。第二个参数通常只为<code>&quot;C&quot;</code>（正常模式）或<code>&quot;&quot;</code>（本地模式）。</p>
<p>任意程序开始时，都隐含下面的调用。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">setlocale</span><span class="token punctuation">(</span>LC_ALL<span class="token punctuation">,</span> <span class="token string">"C"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>下面的语句将格式本地化。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">set_locale</span><span class="token punctuation">(</span>LC_ALL<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>上面示例中，第二个参数为空字符，表示使用当前环境提供的本地化设置。</p>
<p>理论上，第二个参数也可以设为当前系统支持的某种格式。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">setlocale</span><span class="token punctuation">(</span>LC_ALL<span class="token punctuation">,</span> <span class="token string">"en_US.UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>但是这样的话，程序的可移植性就变差了，因为无法保证其他系统也会支持那种格式。所以，通常都将第二个参数设为空字符串，使用操作系统的当前设置。</p>
<p><code>setlocale()</code>的返回值是一个字符串指针，表示已经设置好的格式。如果调用失败，则返回空指针 NULL。</p>
<p><code>setlocale()</code>可以用来查询当前地区，这时第二个参数设为 NULL 就可以了。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">char</span> <span class="token operator">*</span>loc<span class="token punctuation">;</span>

loc <span class="token operator">=</span> <span class="token function">setlocale</span><span class="token punctuation">(</span>LC_ALL<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 输出 Starting locale: C</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Starting locale: %s\n"</span><span class="token punctuation">,</span> loc<span class="token punctuation">)</span><span class="token punctuation">;</span>

loc <span class="token operator">=</span> <span class="token function">setlocale</span><span class="token punctuation">(</span>LC_ALL<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 输出 Native locale: en_US.UTF-8    </span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Native locale: %s\n"</span><span class="token punctuation">,</span> loc<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="localeconv"><a href="#localeconv" class="headerlink" title="localeconv()"></a>localeconv()</h2><p><code>localeconv()</code>用来获取当前格式的详细信息。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">lconv</span><span class="token operator">*</span> <span class="token function">localeconv</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>该函数返回一个 Struct 结构指针，该结构里面包含了格式信息，它的主要属性如下。</p>
<ul>
<li>char* mon_decimal_point：货币的十进制小数点字符，比如<code>.</code>。</li>
<li>char* mon_thousands_sep：货币的千位分隔符，比如<code>,</code>。</li>
<li>char* mon_grouping：货币的分组描述符。</li>
<li>char* positive_sign：货币的正值符号，比如<code>+</code>或为空字符串。</li>
<li>char* negative_sign：货币的负值符号，比如<code>-</code>。</li>
<li>char* currency_symbol：货币符号，比如<code>$</code>。</li>
<li>char frac_digits：打印货币金额时，十进制小数点后面输出几位小数，比如设为<code>2</code>。</li>
<li>char p_cs_precedes：设为<code>1</code>时，货币符号<code>currency_symbol</code>出现在非负金额前面。设为<code>0</code>时，出现在后面。</li>
<li>char n_cs_precedes：设为<code>1</code>时，货币符号<code>currency_symbol</code>出现在负的货币金额前面。设为<code>0</code>时，出现在后面。</li>
<li>char p_sep_by_space：决定了非负的货币金额与货币符号之间的分隔字符。</li>
<li>char n_sep_by_space：决定了负的货币金额与货币符号之间的分隔字符。</li>
<li>char p_sign_posn：决定了非负值的正值符号的位置。</li>
<li>char n_sign_posn：决定了负值的负值符号的位置。</li>
<li>char* int_curr_symbol：货币的国际符号，比如<code>USD</code>。</li>
<li>char int_frac_digits：使用国际符号时，<code>frac_digits</code>的值。</li>
<li>char int_p_cs_precedes：使用国际符号时，<code>p_cs_precedes</code>的值。</li>
<li>char int_n_cs_precedes：使用国际符号时，<code>n_cs_precedes</code>的值。</li>
<li>char int_p_sep_by_space：使用国际符号时，<code>p_sep_by_space</code>的值。</li>
<li>char int_n_sep_by_space：使用国际符号时，<code>n_sep_by_space</code>的值。</li>
<li>char int_p_sign_posn：使用国际符号时，<code>p_sign_posn</code>的值。</li>
<li>char int_n_sign_posn：使用国际符号时，<code>n_sign_posn</code>的值。</li>
</ul>
<p>下面程序打印当前系统的属性值。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;locale.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token function">setlocale</span> <span class="token punctuation">(</span>LC_ALL<span class="token punctuation">,</span><span class="token string">"zh_CN"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">lconv</span> <span class="token operator">*</span> lc<span class="token punctuation">;</span>
    lc<span class="token operator">=</span><span class="token function">localeconv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"decimal_point: %s\n"</span><span class="token punctuation">,</span>lc<span class="token operator">-></span>decimal_point<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"thousands_sep: %s\n"</span><span class="token punctuation">,</span>lc<span class="token operator">-></span>thousands_sep<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"grouping: %s\n"</span><span class="token punctuation">,</span>lc<span class="token operator">-></span>grouping<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"int_curr_symbol: %s\n"</span><span class="token punctuation">,</span>lc<span class="token operator">-></span>int_curr_symbol<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"currency_symbol: %s\n"</span><span class="token punctuation">,</span>lc<span class="token operator">-></span>currency_symbol<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"mon_decimal_point: %s\n"</span><span class="token punctuation">,</span>lc<span class="token operator">-></span>mon_decimal_point<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"mon_thousands_sep: %s\n"</span><span class="token punctuation">,</span>lc<span class="token operator">-></span>mon_thousands_sep<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"mon_grouping: %s\n"</span><span class="token punctuation">,</span>lc<span class="token operator">-></span>mon_grouping<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"positive_sign: %s\n"</span><span class="token punctuation">,</span>lc<span class="token operator">-></span>positive_sign<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"negative_sign: %s\n"</span><span class="token punctuation">,</span>lc<span class="token operator">-></span>negative_sign<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"frac_digits: %d\n"</span><span class="token punctuation">,</span>lc<span class="token operator">-></span>frac_digits<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"p_cs_precedes: %d\n"</span><span class="token punctuation">,</span>lc<span class="token operator">-></span>p_cs_precedes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"n_cs_precedes: %d\n"</span><span class="token punctuation">,</span>lc<span class="token operator">-></span>n_cs_precedes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"p_sep_by_space: %d\n"</span><span class="token punctuation">,</span>lc<span class="token operator">-></span>p_sep_by_space<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"n_sep_by_space: %d\n"</span><span class="token punctuation">,</span>lc<span class="token operator">-></span>n_sep_by_space<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"p_sign_posn: %d\n"</span><span class="token punctuation">,</span>lc<span class="token operator">-></span>p_sign_posn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"n_sign_posn: %d\n"</span><span class="token punctuation">,</span>lc<span class="token operator">-></span>n_sign_posn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"int_frac_digits: %d\n"</span><span class="token punctuation">,</span>lc<span class="token operator">-></span>int_frac_digits<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"int_p_cs_precedes: %d\n"</span><span class="token punctuation">,</span>lc<span class="token operator">-></span>int_p_cs_precedes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"int_n_cs_precedes: %d\n"</span><span class="token punctuation">,</span>lc<span class="token operator">-></span>int_n_cs_precedes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"int_p_sep_by_space: %d\n"</span><span class="token punctuation">,</span>lc<span class="token operator">-></span>int_p_sep_by_space<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"int_n_sep_by_space: %d\n"</span><span class="token punctuation">,</span>lc<span class="token operator">-></span>int_n_sep_by_space<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"int_p_sign_posn: %d\n"</span><span class="token punctuation">,</span>lc<span class="token operator">-></span>int_p_sign_posn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"int_n_sign_posn: %d\n"</span><span class="token punctuation">,</span>lc<span class="token operator">-></span>int_n_sign_posn<span class="token punctuation">)</span><span class="token punctuation">;</span>
   
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="math-h"><a href="#math-h" class="headerlink" title="math.h"></a>math.h</h1><p><code>math.h</code>头文件提供了很多数学函数。</p>
<p>很多数学函数的返回值是 double 类型，但是同时提供 float 类型与 long double 类型的版本，比如<code>pow()</code>函数就还有<code>powf()</code>和<code>powl()</code>版本。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">double</span>      <span class="token function">pow</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">,</span> <span class="token keyword">double</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">float</span>       <span class="token function">powf</span><span class="token punctuation">(</span><span class="token keyword">float</span> x<span class="token punctuation">,</span> <span class="token keyword">float</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> <span class="token keyword">double</span> <span class="token function">powl</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">double</span> x<span class="token punctuation">,</span> <span class="token keyword">long</span> <span class="token keyword">double</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>为了简洁，下面就略去了函数的<code>f</code>后缀（float 类型）和<code>l</code>后缀（long double）版本。</p>
<h2 id="类型和宏"><a href="#类型和宏" class="headerlink" title="类型和宏"></a>类型和宏</h2><p>math.h 新定义了两个类型别名。</p>
<ul>
<li>float_t：（当前系统）最有效执行 float 运算的类型，宽度至少与 float 一样。</li>
<li>double_t`：（当前系统）最有效执行 double 运算的类型，宽度至少与 double 一样。</li>
</ul>
<p>它们的具体类型可以通过宏<code>FLT_EVAL_METHOD</code>来了解。</p>
<table>
<thead>
<tr>
<th>FLT_EVAL_METHOD 的值</th>
<th>float_t 对应的类型</th>
<th>double_t 对应的类型</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>float</td>
<td>double</td>
</tr>
<tr>
<td>1</td>
<td>double</td>
<td>double</td>
</tr>
<tr>
<td>2</td>
<td>long double</td>
<td>long double</td>
</tr>
<tr>
<td>其他</td>
<td>由实现决定</td>
<td>由实现决定</td>
</tr>
</tbody></table>
<p>math.h 还定义了一些宏。</p>
<ul>
<li><code>INFINITY</code>：表示正无穷，返回一个 float 类型的值。</li>
<li><code>NAN</code>：表示非数字（Not-A-Number），返回一个 float 类型的值。</li>
</ul>
<h2 id="错误类型"><a href="#错误类型" class="headerlink" title="错误类型"></a>错误类型</h2><p>数学函数的报错有以下类型。</p>
<ul>
<li>Range errors：运算结果不能用函数返回类型表示。</li>
<li>Domain errors：函数参数不适用当前函数。</li>
<li>Pole errors：参数导致函数的极限值变成无限。</li>
<li>Overflow errors：运算结果太大，导致溢出。</li>
<li>Underflow errors：运算结果太小，导致溢出。</li>
</ul>
<p>变量<code>math_errhandling</code>提示了当前系统如何处理数学运算错误。</p>
<table>
<thead>
<tr>
<th>math_errhandling 的值</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>MATH_ERRNO</td>
<td>系统使用 errno 表示数学错误</td>
</tr>
<tr>
<td>MATH_ERREXCEPT</td>
<td>系统使用异常表示数学错误</td>
</tr>
<tr>
<td>MATH_ERRNO</td>
<td>MATH_ERREXCEPT</td>
</tr>
</tbody></table>
<h2 id="数值类型"><a href="#数值类型" class="headerlink" title="数值类型"></a>数值类型</h2><p>数学函数的参数可以分成以下几类：正常值，无限值，有限值和非数字。</p>
<p>下面的函数用来判断一个值的类型。</p>
<ul>
<li>fpclassify()：返回给定浮点数的分类。</li>
<li>isfinite()：如果参数不是无限或 NaN，则为真。</li>
<li>isinf()：如果参数是无限的，则为真。</li>
<li>isnan()：如果参数不是数字，则为真。</li>
<li>isnormal()：如果参数是正常数字，则为真。</li>
</ul>
<p>下面是一个例子。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">isfinite</span><span class="token punctuation">(</span><span class="token number">1.23</span><span class="token punctuation">)</span>    <span class="token comment">// 1</span>
<span class="token function">isinf</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span><span class="token function">tan</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">// 1</span>
<span class="token function">isnan</span><span class="token punctuation">(</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">// 1</span>
<span class="token function">isnormal</span><span class="token punctuation">(</span><span class="token number">1e-310</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="signbit"><a href="#signbit" class="headerlink" title="signbit()"></a>signbit()</h2><p><code>signbit()</code>判断参数是否带有符号。如果参数为负值，则返回1，否则返回0。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">signbit</span><span class="token punctuation">(</span><span class="token number">3490.0</span><span class="token punctuation">)</span> <span class="token comment">// 0</span>
<span class="token function">signbit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">37.0</span><span class="token punctuation">)</span>  <span class="token comment">// 1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="三角函数"><a href="#三角函数" class="headerlink" title="三角函数"></a>三角函数</h2><p>以下是三角函数，参数为弧度值。</p>
<ul>
<li>acos()：反余弦。</li>
<li>asin()：反正弦。</li>
<li>atan()：反正切</li>
<li>atan2()：反正切。</li>
<li>cos()：余弦。</li>
<li>sin()：正弦。</li>
<li>tan()：正切。</li>
</ul>
<p>不要忘了，上面所有函数都有 float 版本（函数名加上 f 后缀）和 long double 版本（函数名加上 l 后缀）。</p>
<p>下面是一个例子。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">cos</span><span class="token punctuation">(</span>PI<span class="token operator">/</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment">// 0.707107</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="双曲函数"><a href="#双曲函数" class="headerlink" title="双曲函数"></a>双曲函数</h2><p>以下是双曲函数，参数都为浮点数。</p>
<ul>
<li>acosh()：反双曲余弦。 </li>
<li>asinh()：反双曲正弦。</li>
<li>atanh()：反双曲正切。</li>
<li>cosh()：双曲余弦。</li>
<li>tanh()：双曲正切。</li>
<li>sinh()：双曲正弦。 </li>
</ul>
<h2 id="指数函数和对数函数"><a href="#指数函数和对数函数" class="headerlink" title="指数函数和对数函数"></a>指数函数和对数函数</h2><p>以下是指数函数和对数函数，它们的返回值都是 double 类型。</p>
<ul>
<li>exp()：计算欧拉数 e 的乘方，即 e<sup>x</sup>。</li>
<li>exp2()：计算 2 的乘方，即 2<sup>x</sup>。</li>
<li>expm1()：计算 e<sup>x</sup> - 1。</li>
<li>log()：计算自然对数，<code>exp()</code>的逆运算。</li>
<li>log2()：计算以2为底的对数。</li>
<li>log10()：计算以10为底的对数。</li>
<li>logp1()：计算一个数加 1 的自然对数，即<code>ln(x + 1)</code>。</li>
<li>logb()：计算以宏<code>FLT_RADIX</code>（一般为2）为底的对数，但只返回整数部分。</li>
</ul>
<p>下面是一些例子。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">exp</span><span class="token punctuation">(</span><span class="token number">3.0</span><span class="token punctuation">)</span> <span class="token comment">// 20.085500</span>
<span class="token function">log</span><span class="token punctuation">(</span><span class="token number">20.0855</span><span class="token punctuation">)</span> <span class="token comment">// 3.000000</span>
<span class="token function">log10</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span> <span class="token comment">// 3.000000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>如果结果值超出了 C 语言可以表示的最大值，函数将返回<code>HUGE_VAL</code>，它是一个在<code>math.h</code>中定义的 double 类型的值。</p>
<p>如果结果值太小，无法用 double 值表示，函数将返回0。以上这两种情况都属于出错。</p>
<h2 id="frexp"><a href="#frexp" class="headerlink" title="frexp()"></a>frexp()</h2><p><code>frexp()</code>将参数分解成浮点数和指数部分（2为底数），比如 1234.56 可以写成 0.6028125 * 2<sup>11</sup>，这个函数就能分解出 0.6028125 和 11。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">double</span> <span class="token function">frexp</span><span class="token punctuation">(</span><span class="token keyword">double</span> value<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">*</span> exp<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>它接受两个参数，第一个参数是用来分解的浮点数，第二个参数是一个整数变量指针。</p>
<p>它返回小数部分，并将指数部分放入变量<code>exp</code>。如果参数为<code>0</code>，则返回的小数部分和指数部分都为<code>0</code>。</p>
<p>下面是一个例子。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">double</span> frac<span class="token punctuation">;</span>
<span class="token keyword">int</span> expt<span class="token punctuation">;</span>

<span class="token comment">// expt 的值是 11</span>
frac <span class="token operator">=</span> <span class="token function">frexp</span><span class="token punctuation">(</span><span class="token number">1234.56</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>expt<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 输出 1234.56 = 0.6028125 x 2^11</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"1234.56 = %.7f x 2^%d\n"</span><span class="token punctuation">,</span> frac<span class="token punctuation">,</span> expt<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="ilogb"><a href="#ilogb" class="headerlink" title="ilogb()"></a>ilogb()</h2><p><code>ilogb()</code>返回一个浮点数的指数部分，指数的基数是宏<code>FLT_RADIX</code>（一般是<code>2</code>）。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">ilogb</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>它的参数为<code>x</code>，返回值是 log<sub>r</sub>|x|，其中<code>r</code>为宏<code>FLT_RADIX</code>。</p>
<p>下面是用法示例。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">ilogb</span><span class="token punctuation">(</span><span class="token number">257</span><span class="token punctuation">)</span> <span class="token comment">// 8</span>
<span class="token function">ilogb</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span> <span class="token comment">// 8</span>
<span class="token function">ilogb</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token comment">// 7</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="ldexp"><a href="#ldexp" class="headerlink" title="ldexp()"></a>ldexp()</h2><p><code>ldexp()</code>将一个数乘以2的乘方。它可以看成是<code>frexp()</code>的逆运算，将小数部分和指数部分合成一个<code>f * 2^n</code>形式的浮点数。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">double</span> <span class="token function">ldexp</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> exp<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>它接受两个参数，第一个参数是乘数<code>x</code>，第二个参数是2的指数部分<code>exp</code>，返回“x * 2<sup>exp</sup>”。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">ldexp</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment">// 1024.000000</span>
<span class="token function">ldexp</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// 12.000000</span>
<span class="token function">ldexp</span><span class="token punctuation">(</span><span class="token number">0.75</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment">// 12.000000</span>
<span class="token function">ldexp</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 0.250000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="modf"><a href="#modf" class="headerlink" title="modf()"></a>modf()</h2><p><code>modf()</code>函数提取一个数的整数部分和小数部分。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">double</span> <span class="token function">modf</span><span class="token punctuation">(</span><span class="token keyword">double</span> value<span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> iptr<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>它接受两个参数，第一个参数<code>value</code>表示待分解的数值，第二个参数是浮点数变量<code>iptr</code>。返回值是<code>value</code>的小数部分，整数部分放入变量<code>double</code>。</p>
<p>下面是一个例子。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// int_part 的值是 3.0</span>
<span class="token function">modf</span><span class="token punctuation">(</span><span class="token number">3.14159</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>int_part<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回 0.14159</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="scalbn"><a href="#scalbn" class="headerlink" title="scalbn()"></a>scalbn()</h2><p><code>scalbn()</code>用来计算“x * r<sup>n</sup>”，其中<code>r</code>是宏<code>FLT_RADIX</code>。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">double</span> <span class="token function">scalbn</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>它接受两个参数，第一个参数<code>x</code>是乘数部分，第二个参数<code>n</code>是指数部分，返回值是“x * r<sup>n</sup>”。</p>
<p>下面是一些例子。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">scalbn</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token comment">// 512.000000</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>这个函数有多个版本。</p>
<ul>
<li>scalbn()：指数 n 是 int 类型。</li>
<li>scalbnf()：float 版本的 scalbn()。</li>
<li>scalbnl()：long double 版本的 scalbn()。</li>
<li>scalbln()：指数 n 是 long int 类型。</li>
<li>scalblnf()：float 版本的 scalbln()。</li>
<li>scalblnl()：long double 版本的 scalbln()。</li>
</ul>
<h2 id="round"><a href="#round" class="headerlink" title="round()"></a>round()</h2><p><code>round()</code>函数以传统方式进行四舍五入，比如<code>1.5</code>舍入到<code>2</code>，<code>-1.5</code>舍入到<code>-2</code>。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">double</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>它返回一个浮点数。</p>
<p>下面是一些例子。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">round</span><span class="token punctuation">(</span><span class="token number">3.14</span><span class="token punctuation">)</span>  <span class="token comment">// 3.000000</span>
<span class="token function">round</span><span class="token punctuation">(</span><span class="token number">3.5</span><span class="token punctuation">)</span>   <span class="token comment">// 4.000000</span>
<span class="token function">round</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1.5</span><span class="token punctuation">)</span>  <span class="token comment">// -2.000000</span>
<span class="token function">round</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1.14</span><span class="token punctuation">)</span> <span class="token comment">// -1.000000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>它还有一些其他版本。</p>
<ul>
<li>lround()：返回值是 long int 类型。</li>
<li>llround()：返回值是 long long int 类型。</li>
</ul>
<h2 id="trunc"><a href="#trunc" class="headerlink" title="trunc()"></a>trunc()</h2><p><code>trunc()</code>用来截去一个浮点数的小数部分，将剩下的整数部分以浮点数的形式返回。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">double</span> <span class="token function">trunc</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>下面是一些例子。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">trunc</span><span class="token punctuation">(</span><span class="token number">3.14</span><span class="token punctuation">)</span>  <span class="token comment">// 3.000000</span>
<span class="token function">trunc</span><span class="token punctuation">(</span><span class="token number">3.8</span><span class="token punctuation">)</span>   <span class="token comment">// 3.000000</span>
<span class="token function">trunc</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1.5</span><span class="token punctuation">)</span>  <span class="token comment">// -1.000000</span>
<span class="token function">trunc</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1.14</span><span class="token punctuation">)</span> <span class="token comment">// -1.000000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="ceil"><a href="#ceil" class="headerlink" title="ceil()"></a>ceil()</h2><p><code>ceil()</code>返回不小于其参数的最小整数（double 类型），属于“向上舍入”。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">double</span> <span class="token function">ceil</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>下面是一些例子。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token number">7.1</span><span class="token punctuation">)</span> <span class="token comment">// 8.0</span>
<span class="token function">ceil</span><span class="token punctuation">(</span><span class="token number">7.9</span><span class="token punctuation">)</span> <span class="token comment">// 8.0</span>
<span class="token function">ceil</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">7.1</span><span class="token punctuation">)</span> <span class="token comment">// -7.0</span>
<span class="token function">ceil</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">7.9</span><span class="token punctuation">)</span> <span class="token comment">// -7.0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="floor"><a href="#floor" class="headerlink" title="floor()"></a>floor()</h2><p><code>floor()</code>返回不大于其参数的最大整数，属于“向下舍入”。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">double</span> <span class="token function">floor</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>下面是一些例子。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">floor</span><span class="token punctuation">(</span><span class="token number">7.1</span><span class="token punctuation">)</span> <span class="token comment">// 7.0</span>
<span class="token function">floor</span><span class="token punctuation">(</span><span class="token number">7.9</span><span class="token punctuation">)</span> <span class="token comment">// 7.0</span>
<span class="token function">floor</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">7.1</span><span class="token punctuation">)</span> <span class="token comment">// -8.0</span>
<span class="token function">floor</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">7.9</span><span class="token punctuation">)</span> <span class="token comment">// -8.0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>下面的函数可以实现“四舍五入”。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">double</span> <span class="token function">round_nearest</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> x <span class="token operator">&lt;</span> <span class="token number">0.0</span> <span class="token operator">?</span> <span class="token function">ceil</span><span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">floor</span><span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="fmod"><a href="#fmod" class="headerlink" title="fmod()"></a>fmod()</h2><p><code>fmod()</code>返回第一个参数除以第二个参数的余数，就是余值运算符<code>%</code>的浮点数版本，因为<code>%</code>只能用于整数运算。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">double</span> <span class="token function">fmod</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">,</span> <span class="token keyword">double</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>它在幕后执行的计算是<code>x - trunc(x / y) * y</code>，返回值的符号与<code>x</code>的符号相同。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">fmod</span><span class="token punctuation">(</span><span class="token number">5.5</span><span class="token punctuation">,</span> <span class="token number">2.2</span><span class="token punctuation">)</span>  <span class="token comment">//  1.100000</span>
<span class="token function">fmod</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">9.2</span><span class="token punctuation">,</span> <span class="token number">5.1</span><span class="token punctuation">)</span> <span class="token comment">// -4.100000</span>
<span class="token function">fmod</span><span class="token punctuation">(</span><span class="token number">9.2</span><span class="token punctuation">,</span> <span class="token number">5.1</span><span class="token punctuation">)</span>  <span class="token comment">//  4.100000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="浮点数比较函数"><a href="#浮点数比较函数" class="headerlink" title="浮点数比较函数"></a>浮点数比较函数</h2><p>以下函数用于两个浮点数的比较，返回值的类型是整数。</p>
<ul>
<li>isgreater()：返回<code>x &gt; y</code>的结果。</li>
<li>isgreaterequal()：返回<code>x &gt;= y</code>的结果。</li>
<li>isless()：返回<code>x &lt; y</code>的结果。</li>
<li>islessequal()：返回<code>x &lt;= y</code>的结果。</li>
<li>islessgreater()：返回<code>(x &lt; y) || (x &gt; y)</code>的结果。</li>
</ul>
<p>下面是一些例子。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">isgreater</span><span class="token punctuation">(</span><span class="token number">10.0</span><span class="token punctuation">,</span> <span class="token number">3.0</span><span class="token punctuation">)</span>   <span class="token comment">// 1</span>
<span class="token function">isgreaterequal</span><span class="token punctuation">(</span><span class="token number">10.0</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">)</span>   <span class="token comment">// 1</span>
<span class="token function">isless</span><span class="token punctuation">(</span><span class="token number">10.0</span><span class="token punctuation">,</span> <span class="token number">3.0</span><span class="token punctuation">)</span>  <span class="token comment">// 0</span>
<span class="token function">islessequal</span><span class="token punctuation">(</span><span class="token number">10.0</span><span class="token punctuation">,</span> <span class="token number">3.0</span><span class="token punctuation">)</span>   <span class="token comment">// 0</span>
<span class="token function">islessgreater</span><span class="token punctuation">(</span><span class="token number">10.0</span><span class="token punctuation">,</span> <span class="token number">3.0</span><span class="token punctuation">)</span>   <span class="token comment">// 1</span>
<span class="token function">islessgreater</span><span class="token punctuation">(</span><span class="token number">10.0</span><span class="token punctuation">,</span> <span class="token number">30.0</span><span class="token punctuation">)</span>   <span class="token comment">// 1</span>
<span class="token function">islessgreater</span><span class="token punctuation">(</span><span class="token number">10.0</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">)</span>   <span class="token comment">// 0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="isunordered"><a href="#isunordered" class="headerlink" title="isunordered()"></a>isunordered()</h2><p><code>isunordered()</code>返回两个参数之中，是否存在 NAN。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">isunordered</span><span class="token punctuation">(</span>any_floating_type x<span class="token punctuation">,</span> any_floating_type y<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>下面是一些例子。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">isunordered</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">)</span>    <span class="token comment">// 0</span>
<span class="token function">isunordered</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 1</span>
<span class="token function">isunordered</span><span class="token punctuation">(</span>NAN<span class="token punctuation">,</span> <span class="token number">30.0</span><span class="token punctuation">)</span>  <span class="token comment">// 1</span>
<span class="token function">isunordered</span><span class="token punctuation">(</span>NAN<span class="token punctuation">,</span> NAN<span class="token punctuation">)</span>   <span class="token comment">// 1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="其他函数"><a href="#其他函数" class="headerlink" title="其他函数"></a>其他函数</h2><p>下面是 math.h 包含的其它函数。</p>
<ul>
<li>pow()：计算参数<code>x</code>的<code>y</code>次方。</li>
<li>sqrt()：计算一个数的平方根。</li>
<li>cbrt()：计算立方根。</li>
<li>fabs()：计算绝对值。</li>
<li>hypot()：根据直角三角形的两条直角边，计算斜边。</li>
<li>fmax()：返回两个参数之中的最大值。</li>
<li>fmin()：返回两个参数之中的最小值。</li>
<li>remainder()：返回 IEC 60559 标准的余数，类似于<code>fmod()</code>，但是余数范围是从<code>-y/2</code>到<code>y/2</code>，而不是从<code>0</code>到<code>y</code>。</li>
<li>remquo()：同时返回余数和商，余数的计算方法与<code>remainder()</code>相同。</li>
<li>copysign()：返回一个大小等于第一个参数、符号等于第二个参数的值。</li>
<li>nan()：返回 NAN。  </li>
<li>nextafter()：获取下一个（或者上一个，具体方向取决于第二个参数<code>y</code>）当前系统可以表示的浮点值。</li>
<li>nextoward()：与<code>nextafter()</code>相同，除了第二个参数是 long double 类型。</li>
<li>fdim()：如果第一个参数减去第二个参数大于<code>0</code>，则返回差值，否则返回<code>0</code>。</li>
<li>fma()：以快速计算的方式，返回<code>x * y + z</code>的结果。</li>
<li>nearbyint()：在当前舍入方向上，舍入到最接近的整数。当前舍入方向可以使用<code>fesetround()</code>函数设定。</li>
<li>rint()：在当前舍入方向上，舍入到最接近的整数，与<code>nearbyint()</code>相同。不同之处是，它会触发浮点数的<code>INEXACT</code>异常。</li>
<li>lrint()：在当前舍入方向上，舍入到最接近的整数，与<code>rint()</code>相同。不同之处是，返回值是一个整数，而不是浮点数。</li>
<li>erf()：计算一个值的误差函数。</li>
<li>erfc()：计算一个值的互补误差函数。</li>
<li>tgamma()：计算 Gamma 函数。</li>
<li>lgamma()：计算 Gamma 函数绝对值的自然对数。</li>
</ul>
<p>下面是一些例子。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment">// 81.000000</span>
<span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">3.0</span><span class="token punctuation">)</span> <span class="token comment">// 1.73205</span>
<span class="token function">cbrt</span><span class="token punctuation">(</span><span class="token number">1729.03</span><span class="token punctuation">)</span> <span class="token comment">// 12.002384</span>
<span class="token function">fabs</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3490.0</span><span class="token punctuation">)</span> <span class="token comment">// 3490.000000</span>
<span class="token function">hypot</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment">// 5.000000</span>
<span class="token function">fmax</span><span class="token punctuation">(</span><span class="token number">3.0</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">)</span> <span class="token comment">// 10.000000</span>
<span class="token function">fmin</span><span class="token punctuation">(</span><span class="token number">10.0</span><span class="token punctuation">,</span> <span class="token number">3.0</span><span class="token punctuation">)</span> <span class="token comment">//  3.000000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="signal-h"><a href="#signal-h" class="headerlink" title="signal.h"></a>signal.h</h1><h2 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h2><p><code>signal.h</code>提供了信号（即异常情况）的处理工具。所谓“信号”（signal），可以理解成系统与程序之间的短消息，主要用来表示运行时错误，或者发生了异常事件。</p>
<p>头文件<code>signal.h</code>定义了一系列宏，表示不同的信号。</p>
<ul>
<li>SIGABRT：异常中止（可能由于调用了 abort() 方法）。</li>
<li>SIGFPE：算术运算发生了错误（可能是除以 0 或者溢出）。</li>
<li>SIGILL：无效指令。</li>
<li>SIGINT：中断。</li>
<li>SIGSEGV：无效内存访问。</li>
<li>SIGTERM：终止请求。</li>
</ul>
<p>上面每个宏的值都是一个正整数常量。</p>
<h2 id="signal"><a href="#signal" class="headerlink" title="signal()"></a>signal()</h2><p>头文件<code>signal.h</code>还定义了一个<code>signal()</code>函数，用来指定某种信号的处理函数。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">signal</span><span class="token punctuation">(</span>SIGINT<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><code>signal()</code>接受两个参数，第一个参数是某种信号的宏，第二个参数是处理这个信号的函数指针<code>handler</code>。</p>
<p>信号处理函数<code>handler</code>接受一个 int 类型的参数，表示信号类型。它的原型如下。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>func<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><code>handler</code>函数体内部可以根据这个整数，判断到底接受到了哪种信号，因为多个信号可以共用同一个处理函数。一旦处理函数执行完成，程序会从信号发生点恢复执行。但是，如果遇到 SIGABRT 信号，处理函数执行完成，系统会让程序中止。</p>
<p>当系统向程序发送信号时，程序可以忽略信号，即不指定处理函数。</p>
<p><code>signal()</code>的返回值是前一个处理函数的指针，常常把它保存在变量之中，当新的处理函数执行完，再恢复以前的处理函数。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>orig_handler<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
orig_handler <span class="token operator">=</span> <span class="token function">signal</span><span class="token punctuation">(</span>SIGINT<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// SIGINT 信号发生之后</span>
<span class="token function">signal</span><span class="token punctuation">(</span>SIGINT<span class="token punctuation">,</span> orig_handler<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面示例中，<code>signal()</code>为信号<code>SIGINT</code>指定了新的处理函数<code>handler</code>，把原来的处理函数保存在变量<code>orig_handler</code>里面。等到<code>handler</code>这个函数用过之后，再恢复原来的处理函数。</p>
<h2 id="信号相关的宏"><a href="#信号相关的宏" class="headerlink" title="信号相关的宏"></a>信号相关的宏</h2><p><code>signal.h</code>还提供了信号相关的宏。</p>
<p>（1）SIG_DFL</p>
<p>SIG_DFL 表示默认的处理函数。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">signal</span><span class="token punctuation">(</span>SIGINT<span class="token punctuation">,</span> SIG_IGN<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>上面示例中，SIGINT 的处理函数是默认处理函数，由当前实现决定。</p>
<p>（2）SIG_IGN</p>
<p>SIG_IGN 表示忽略该信号。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">signal</span><span class="token punctuation">(</span>SIGINT<span class="token punctuation">,</span> SIG_IGN<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>上面示例表示不对 SIGINT 信号进行处理。由于程序运行时按下 Ctrl + c 是发出 SIGINT 信号，所以使用该语句后，程序无法用 Ctrl + c 终止。</p>
<p>（3）SIG_ERR</p>
<p>SIG_ERR 是信号处理函数发生错误时，<code>signal()</code>的返回值。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">signal</span><span class="token punctuation">(</span>SIGINT<span class="token punctuation">,</span> handler<span class="token punctuation">)</span> <span class="token operator">==</span> SIG_ERR<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"signal(SIGINT, handler) failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面示例可以判断<code>handler</code>处理 SIGINT 时，是否发生错误。</p>
<h2 id="raise"><a href="#raise" class="headerlink" title="raise()"></a>raise()</h2><p><code>raise()</code>函数用来在程序中发出信号。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">raise</span><span class="token punctuation">(</span><span class="token keyword">int</span> sig<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>它接受一个信号值作为参数，表示发出该信号。它的返回值是一个整数，可以用来判断信号发出是否成功，0 表示成功，非 0 表示失败。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">int</span> sig<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Handler called for signal %d\n"</span><span class="token punctuation">,</span> sig<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">signal</span><span class="token punctuation">(</span>SIGINT<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">raise</span><span class="token punctuation">(</span>SIGINT<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面示例中，<code>raise()</code>触发 SIGINT 信号，导致 handler 函数执行。</p>
<h1 id="stdarg-h"><a href="#stdarg-h" class="headerlink" title="stdarg.h"></a>stdarg.h</h1><p><code>stdarg.h</code>定义于函数的可变参数相关的一些方法。</p>
<ul>
<li>va_list 类型</li>
<li>va_start()</li>
<li>va_arg()：获取当前参数</li>
<li>va_end()。</li>
</ul>
<p>va_copy()：it makes a copy of your va_list variable in the exact same state.<br>va_copy() can be useful if you need to scan ahead through the arguments but need to also remember your current place.</p>
<p>接受可变函数作为参数的一些方法。</p>
<ul>
<li>vprintf()</li>
<li>vfprintf()</li>
<li>vsprintf()</li>
<li>vsnprintf()</li>
</ul>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdarg.h></span></span>

<span class="token keyword">int</span> <span class="token function">my_printf</span><span class="token punctuation">(</span><span class="token keyword">int</span> serial<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>format<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    va_list va<span class="token punctuation">;</span>

    <span class="token comment">// Do my custom work</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The serial number is: %d\n"</span><span class="token punctuation">,</span> serial<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Then pass the rest off to vprintf()</span>
    <span class="token function">va_start</span><span class="token punctuation">(</span>va<span class="token punctuation">,</span> format<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> rv <span class="token operator">=</span> <span class="token function">vprintf</span><span class="token punctuation">(</span>format<span class="token punctuation">,</span> va<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">va_end</span><span class="token punctuation">(</span>va<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> rv<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> y <span class="token operator">=</span> <span class="token number">3.2</span><span class="token punctuation">;</span>

    <span class="token function">my_printf</span><span class="token punctuation">(</span><span class="token number">3490</span><span class="token punctuation">,</span> <span class="token string">"x is %d, y is %f\n"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="stdbool-h"><a href="#stdbool-h" class="headerlink" title="stdbool.h"></a>stdbool.h</h1><p><code>stdbool.h</code>头文件定义了4个宏。</p>
<ul>
<li><code>bool</code>：定义为<code>_Bool</code>。</li>
<li><code>true</code>：定义为1。</li>
<li><code>false</code>：定义为0。</li>
<li><code>__bool_true_false_are_defined</code>：定义为1。</li>
</ul>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">bool <span class="token function">isEven</span><span class="token punctuation">(</span><span class="token keyword">int</span> number<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>number <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> true<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> false<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdbool.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">long</span> num<span class="token punctuation">;</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">long</span> div<span class="token punctuation">;</span>
  bool isPrime <span class="token operator">=</span> true<span class="token punctuation">;</span>

  num <span class="token operator">=</span> <span class="token number">64457</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span>div <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token punctuation">(</span>div <span class="token operator">*</span> div<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> num<span class="token punctuation">;</span> div<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>num <span class="token operator">%</span> div <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> isPrime <span class="token operator">=</span> false<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>isPrime<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%lu is prime.\n"</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%lu is not prime.\n"</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="stddef-h"><a href="#stddef-h" class="headerlink" title="stddef.h"></a>stddef.h</h1><p><code>stddef.h</code>提供了常用类型和宏的定义，但没有声明任何函数。</p>
<p>这个头文件定义的类型如下。</p>
<ul>
<li>ptrdiff_t：指针相减运算时，返回结果的数据类型。</li>
<li>size_t：<code>sizeof</code>运算符返回的类型。</li>
<li>wchar_t：一种足够大、能容纳各种字符的类型。</li>
</ul>
<p>以上三个类型都是整数类型，其中<code>ptrdiff_t</code>是有符号整数，<code>size_t</code>是无符号整数。</p>
<p><code>stddef.h</code>定义了两个宏。</p>
<ul>
<li>NULL：空指针。</li>
<li>offsetof()</li>
</ul>
<h2 id="offsetof"><a href="#offsetof" class="headerlink" title="offsetof()"></a>offsetof()</h2><p><code>offsetof()</code>是<code>stddef.h</code>定义的一个宏，用来返回某个属性在 Struct 结构内部的起始位置。由于系统为了字节对齐，可能会在 Struct 结构的属性之间插入空字节，这个宏对于确定某个属性的内存位置很有用。</p>
<p>它是一个带参数的宏，接受两个参数。第一个参数是 Struct 结构，第二个参数是该结构的一个属性，返回 Struct 起始位置到该属性之间的字节数。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">s</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">char</span> a<span class="token punctuation">;</span>
  <span class="token keyword">int</span> b<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">float</span> c<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%zu\n"</span><span class="token punctuation">,</span> <span class="token function">offsetof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">s</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%zu\n"</span><span class="token punctuation">,</span> <span class="token function">offsetof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">s</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%zu\n"</span><span class="token punctuation">,</span> <span class="token function">offsetof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">s</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 12</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>对于上面这个 Struct 结构，<code>offsetof(struct s, a)</code>一定等于<code>0</code>，因为<code>a</code>属性是第一个属性，与 Struct 结构自身的地址相同。</p>
<p>系统为了字节对齐，在<code>a</code>属性后面分配了3个空字节，导致<code>b</code>属性存储在第4个字节，所以<code>offsetof(struct s, b)</code>和<code>offsetof(struct s, c)</code>分别是4和12。</p>
<h1 id="stdint-h"><a href="#stdint-h" class="headerlink" title="stdint.h"></a>stdint.h</h1><h2 id="固定宽度的整数类型"><a href="#固定宽度的整数类型" class="headerlink" title="固定宽度的整数类型"></a>固定宽度的整数类型</h2><p>stdint.h 定义了一些固定宽度的整数类型别名，主要有下面三类。</p>
<ul>
<li>宽度完全确定的整数<code>intN_t</code>，比如<code>int32_t</code>。</li>
<li>宽度不小少于某个大小的整数<code>int_leastN_t</code>，比如<code>int_least8_t</code>。</li>
<li>宽度不小于某个大小、并且处理速度尽可能快的整数<code>int_fastN_t</code>，比如<code>int_fast64_t</code>。</li>
</ul>
<p>上面所有类型都是有符号的，类型名前面可以加一个前缀<code>u</code>，表示无符号类型，比如<code>uint16_t</code>。</p>
<p>C 语言标准要求至少定义以下类型。</p>
<ul>
<li>int8_t      uint8_t</li>
<li>int16_t     uint16_t</li>
<li>int32_t     uint32_t</li>
<li>int64_t     uint64_t</li>
<li>int_least8_t      uint_least8_t</li>
<li>int_least16_t     uint_least16_t</li>
<li>int_least32_t     uint_least32_t</li>
<li>int_least64_t     uint_least64_t</li>
<li>int_fast8_t       uint_fast8_t</li>
<li>int_fast16_t      uint_fast16_t</li>
<li>int_fast32_t      uint_fast32_t</li>
<li>int_fast64_t      uint_fast64_t</li>
</ul>
<h2 id="最大宽度的整数类型"><a href="#最大宽度的整数类型" class="headerlink" title="最大宽度的整数类型"></a>最大宽度的整数类型</h2><p>以下两个类型表示当前系统可用的最大宽度整数。</p>
<ul>
<li>intmax_t</li>
<li>uintmax_t</li>
</ul>
<p>如果想要尽可能大的整数时，可以使用上面类型。</p>
<h2 id="固定宽度的整数常量"><a href="#固定宽度的整数常量" class="headerlink" title="固定宽度的整数常量"></a>固定宽度的整数常量</h2><p>以下一些带参数的宏，可以生成固定宽度的整数常量。</p>
<ul>
<li>INT8_C(x)     UINT8_C(x)</li>
<li>INT16_C(x)    UINT16_C(x)</li>
<li>INT32_C(x)    UINT32_C(x)</li>
<li>INT64_C(x)    UINT64_C(x)</li>
<li>INTMAX_C(x)   UINTMAX_C(x)</li>
</ul>
<p>下面是用法示例。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">uint16_t x <span class="token operator">=</span> <span class="token function">UINT16_C</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
intmax_t y <span class="token operator">=</span> <span class="token function">INTMAX_C</span><span class="token punctuation">(</span><span class="token number">3490</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="固定宽度的整数极限值"><a href="#固定宽度的整数极限值" class="headerlink" title="固定宽度的整数极限值"></a>固定宽度的整数极限值</h2><p>下面一些宏代表了固定宽度的整数最大值和最小值。</p>
<ul>
<li>INT8_MAX           INT8_MIN           UINT8_MAX</li>
<li>INT16_MAX          INT16_MIN          UINT16_MAX</li>
<li>INT32_MAX          INT32_MIN          UINT32_MAX</li>
<li>INT64_MAX          INT64_MIN          UINT64_MAX</li>
<li>INT_LEAST8_MAX     INT_LEAST8_MIN     UINT_LEAST8_MAX</li>
<li>INT_LEAST16_MAX    INT_LEAST16_MIN    UINT_LEAST16_MAX</li>
<li>INT_LEAST32_MAX    INT_LEAST32_MIN    UINT_LEAST32_MAX</li>
<li>INT_LEAST64_MAX    INT_LEAST64_MIN    UINT_LEAST64_MAX</li>
<li>INT_FAST8_MAX      INT_FAST8_MIN      UINT_FAST8_MAX</li>
<li>INT_FAST16_MAX     INT_FAST16_MIN     UINT_FAST16_MAX</li>
<li>INT_FAST32_MAX     INT_FAST32_MIN     UINT_FAST32_MAX</li>
<li>INT_FAST64_MAX     INT_FAST64_MIN     UINT_FAST64_MAX</li>
<li>INTMAX_MAX         INTMAX_MIN         UINTMAX_MAX</li>
</ul>
<p>注意，所有无符号整数类型的最小值都为0，所以没有对应的宏。</p>
<h2 id="占位符"><a href="#占位符" class="headerlink" title="占位符"></a>占位符</h2><p>C 语言还在头文件 inttypes.h 里面，为上面类型定义了<code>printf()</code>和<code>scanf()</code>的占位符，参见《inttypes.h》一章。</p>
<h1 id="stdio-h"><a href="#stdio-h" class="headerlink" title="stdio.h"></a>stdio.h</h1><p><code>stdio.h</code>是 C 语言的标准 I/O 库，用于读取和写入文件，也用于控制台的输入和输出。</p>
<h2 id="标准-I-O-函数"><a href="#标准-I-O-函数" class="headerlink" title="标准 I/O 函数"></a>标准 I/O 函数</h2><p>以下函数用于控制台的输入和输出。</p>
<ul>
<li>printf()：输出到控制台，详见《基本语法》一章。</li>
<li>scanf()：从控制台读取输入，详见《I/O 函数》一章。</li>
<li>getchar()：从控制台读取一个字符，详见《I/O 函数》一章。</li>
<li>putchar()：向控制台写入一个字符，详见《I/O 函数》一章。</li>
<li>gets()：从控制台读取整行输入（已废除），详见《I/O 函数》一章。</li>
<li>puts()：向控制台写入一个字符串，详见《I/O 函数》一章。</li>
</ul>
<h2 id="文件操作函数"><a href="#文件操作函数" class="headerlink" title="文件操作函数"></a>文件操作函数</h2><p>以下函数用于文件操作，详见《文件操作》一章。</p>
<ul>
<li>fopen()：打开文件。</li>
<li>fclose()：关闭文件。</li>
<li>freopen()：打开一个新文件，关联一个已经打开的文件指针。</li>
<li>fprintf()：输出到文件。</li>
<li>fscanf()：从文件读取数据。</li>
<li>getc()：从文件读取一个字符。</li>
<li>fgetc()：从文件读取一个字符。</li>
<li>putc()：向文件写入一个字符。</li>
<li>fputc()：向文件写入一个字符。</li>
<li>fgets()：从文件读取整行。</li>
<li>fputs()：向文件写入字符串。</li>
<li>fread()：从文件读取二进制数据。</li>
<li>fwrite()：向文件写入二进制数据。</li>
<li>fseek()：将文件内部指针移到指定位置。</li>
<li>ftell()：获取文件内部指针的当前位置。</li>
<li>rewind()：将文件内部指针重置到文件开始处。</li>
<li>fgetpos()：获取文件内部指针的当前位置。</li>
<li>fsetpos()：设置文件内部指针的当前位置。</li>
<li>feof()：判断文件内部指针是否指向文件结尾。</li>
<li>ferror()：返回文件错误指示器的状态。</li>
<li>clearerr()：重置文件错误指示器。</li>
<li>remove()：删除文件。</li>
<li>rename()：文件改名，以及移动文件。</li>
</ul>
<h2 id="字符串操作函数"><a href="#字符串操作函数" class="headerlink" title="字符串操作函数"></a>字符串操作函数</h2><p>以下函数用于操作字符串，详见《字符串操作》一章。</p>
<ul>
<li>sscanf()：从字符串读取数据，详见《I/O 函数》一章。</li>
<li>sprintf()：输出到字符串。</li>
<li>snprintf()：输出到字符串的更安全版本，指定了输出字符串的数量。</li>
</ul>
<h2 id="tmpfile"><a href="#tmpfile" class="headerlink" title="tmpfile()"></a>tmpfile()</h2><p><code>tmpfile()</code>函数创建一个临时文件，该文件只在程序运行期间存在，除非手动关闭它。它的原型如下。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">FILE<span class="token operator">*</span> <span class="token function">tmpfile</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><code>tmpfile()</code>返回一个文件指针，可以用于访问该函数创建的临时文件。如果创建失败，返回一个空指针 NULL。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">FILE<span class="token operator">*</span> tempptr<span class="token punctuation">;</span>
tempptr <span class="token operator">=</span> <span class="token function">tmpfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>调用<code>close()</code>方法关闭临时文件后，该文件将被自动删除。</p>
<p><code>tmpfile()</code>有两个缺点。一是无法知道临时文件的文件名，二是无法让该文件成为永久文件。</p>
<h2 id="tmpnam"><a href="#tmpnam" class="headerlink" title="tmpnam()"></a>tmpnam()</h2><p><code>tmpname()</code>函数为临时文件生成一个名字，确保不会与其他文件重名。它的原型如下。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">tmpname</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>它的参数是一个字符串变量，<code>tmpnam()</code>会把临时文件的文件名复制到这个变量里面，并返回指向该字符串变量的指针。如果生成文件名失败，<code>tmpnam()</code>返回空指针 NULL。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">char</span> filename<span class="token punctuation">[</span>L_tmpname<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">tmpnam</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
  <span class="token comment">// 输出诸如 /tmp/filew9PMuZ 的文件名</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s\n"</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">else</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Something wrong!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面示例中，<code>L_tmpname</code>是<code>stdio.h</code>定义的一个宏，指定了临时文件的文件名长度。</p>
<p><code>tmpname()</code>的参数也可以是一个空指针 NULL，同样返回指向文件名字符串的指针。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">char</span><span class="token operator">*</span> filename<span class="token punctuation">;</span>
filename <span class="token operator">=</span> <span class="token function">tmpnam</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>上面示例中，变量<code>filename</code>就是<code>tmpnam()</code>生成的文件名。</p>
<p>该函数只是生成一个文件名，稍后可以使用<code>fopen()</code>打开该文件并使用它。</p>
<h2 id="fflush"><a href="#fflush" class="headerlink" title="fflush()"></a>fflush()</h2><p><code>fflush()</code>用于清空缓存区。它接受一个文件指针作为参数，将缓存区内容写入该文件。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">fflush</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>如果不需要保存缓存区内容，则可以传入空指针 NULL。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">fflush</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>如果清空成功，<code>fflush()</code>返回0，否则返回 EOF。</p>
<p>注意，<code>fflush()</code>一般只用来清空输出缓存区（比如写文件）。如果使用它来清空输入缓存区（比如读文件），属于未定义行为。</p>
<p><code>fflush()</code>的一个用途是不等回车键，就强迫输出缓存区。大多数系统都是行缓存，这意味着只有遇到回车键（或者缓存区满了，或者文件读到结尾），缓存区的内容才会输出，<code>fflush()</code>可以不等回车键，立即输出。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\r%d"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">fflush</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面示例是一个倒计时效果，<code>\r</code>是回车键，表示每轮循环都会回到当前行的行首，等于删除上一轮循环的输出。<code>fflush(stdout)</code>表示立即将缓存输出到显示器，这一行是必需的，否则由于上一行的输出没有回车键，不会触发缓存输出，屏幕上不会显示任何内容，只会等到程序运行结束再一次性输出。</p>
<h2 id="setvbuf"><a href="#setvbuf" class="headerlink" title="setvbuf()"></a>setvbuf()</h2><p><code>setvbuf()</code>函数用于定义某个字节流应该如何缓存。它可以接受四个参数。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">setvbuf</span><span class="token punctuation">(</span>FILE<span class="token operator">*</span> stream<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> buffer<span class="token punctuation">,</span> <span class="token keyword">int</span> mode<span class="token punctuation">,</span> size_t size<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>第一个参数<code>stream</code>是文件流。</p>
<p>第二个参数<code>buffer</code>是缓存区的地址。</p>
<p>第三个参数<code>mode</code>指定缓存的行为模式，它是下面三个宏之一，这些宏都定义在<code>stdio.h</code>。</p>
<ul>
<li><code>_IOFBF</code>：满缓存。当缓存为空时，才从流读入数据；当缓存满了，才向流写入数据。一般情况下，这是默认设置。</li>
<li><code>_IOLBF</code>：行缓存。每次从流读入一行数据，或向流写入一行数据，即以行为单位读写缓存。</li>
<li><code>_IONBF</code>：无缓存。不使用缓存区，直接读写设备。</li>
</ul>
<p>第四个参数<code>size</code>指定缓存区的大小。较大的缓存区提供更好的性能，而较小的缓存区可以节省空间。<code>stdio.h</code>提供了一个宏<code>BUFSIZ</code>，表示系统默认的缓存区大小。</p>
<p>它的意义在于，使得用户可以在打开一个文件之前，定义自己的文件缓冲区，而不必使用<code>fopen()</code>函数打开文件时设定的默认缓冲区。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">char</span> buffer<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token function">setvbuf</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> _IOFBF<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>上面示例设置文件流<code>stream</code>的缓存区从地址<code>buffer</code>开始，大小为<code>N</code>，模式为<code>_IOFBF</code>。</p>
<p><code>setvbuf()</code>的第二个参数可以为空指针 NULL。这样的话，<code>setvbuf()</code>会自己创建一个缓存区。</p>
<p>注意，<code>setvbuf()</code>的调用必须在对文件流执行任何操作之前。</p>
<p>如果调用成功，<code>setvbuf()</code>的返回值为<code>0</code>，否则返回非零值。</p>
<p>下面的例子是将缓存区调整为行缓存。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">FILE <span class="token operator">*</span>fp<span class="token punctuation">;</span>
<span class="token keyword">char</span> lineBuf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"somefile.txt"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setvbuf</span><span class="token punctuation">(</span>fp<span class="token punctuation">,</span> lineBuf<span class="token punctuation">,</span> _IOLBF<span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="setbuf"><a href="#setbuf" class="headerlink" title="setbuf()"></a>setbuf()</h2><p><code>setbuf()</code>是<code>setvbuf()</code>的早期版本，可以视为后者的简化版本，也用来定义某个字节流的缓存区。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">setbuf</span><span class="token punctuation">(</span>FILE<span class="token operator">*</span> stream<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>它的第一个参数<code>stream</code>是文件流，第二个参数<code>buffer</code>是缓存区的地址。</p>
<p>它总是可以改写成<code>setvbuf()</code>。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">char</span> buffer<span class="token punctuation">[</span>BUFSIZ<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token function">setbuf</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 等同于</span>
<span class="token function">setvbuf</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> _IOFBF<span class="token punctuation">,</span> BUFSIZ<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面示例中，<code>BUFSIZ</code>是<code>stdio.h</code>定义的宏，表示系统默认的缓存区大小。</p>
<p><code>setbuf()</code>函数没有返回值。</p>
<p><code>setbuf()</code>的第二个参数如果设置为 NULL，表示不进行缓存。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">setbuf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 等同于</span>
<span class="token function">setvbuf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> _IONBF<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="ungetc"><a href="#ungetc" class="headerlink" title="ungetc()"></a>ungetc()</h2><p><code>ungetc()</code>将从缓存里面读取的上一个字符，重新放回缓存，下一个读取缓存的操作会从这个字符串开始。有些操作需要了解下一个字符是什么，再决定应该怎么处理，这时这个函数就很有用。</p>
<p>它的原型如下。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">ungetc</span><span class="token punctuation">(</span><span class="token keyword">int</span> c<span class="token punctuation">,</span> FILE <span class="token operator">*</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>它的第一个参数是一个字符变量，第二个参数是一个打开的文件流。它的返回值是放回缓存的那个字符，操作失败时，返回 EOF。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> ch <span class="token operator">=</span> <span class="token function">fgetc</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isdigit</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  ch <span class="token operator">=</span> <span class="token function">fgetd</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">ungetc</span><span class="token punctuation">(</span>ch<span class="token punctuation">,</span> fp<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面示例中，如果读取的字符不是数字，就将其放回缓存。</p>
<h2 id="perror"><a href="#perror" class="headerlink" title="perror()"></a>perror()</h2><p><code>perror()</code>用于在 stderr 的错误信息之前，添加一个自定义字符串。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">perror</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>该函数的参数就是在报错信息前添加的字符串。它没有返回值。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;math.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;errno.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

  errno <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">float</span> y <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>errno <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"sqrt error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面示例中，求<code>-1</code>的平方根，导致报错。头文件<code>errno.h</code>提供宏<code>errno</code>，只要上一步操作出错，这个宏就会设置成非零值。<code>perror()</code>用来在报错信息前，加上<code>sqrt error</code>的自定义字符串。</p>
<p>执行上面的程序，就会得到下面的报错信息。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ gcc test.c -lm
$ ./a.out
sqrt error: Numerical argument out of domain<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="可变参数操作函数"><a href="#可变参数操作函数" class="headerlink" title="可变参数操作函数"></a>可变参数操作函数</h2><p>（1）输出函数</p>
<p>下面是<code>printf()</code>的变体函数，用于按照给定格式，输出函数的可变参数列表（va_list）。</p>
<ul>
<li>vprintf()：按照给定格式，输出到控制台，默认是显示器。</li>
<li>vfprintf()：按照给定格式，输出到文件。</li>
<li>vsprintf()：按照给定格式，输出到字符串。</li>
<li>vsnprintf()：按照给定格式，输出到字符串的安全版本。</li>
</ul>
<p>它们的原型如下，基本与对应的<code>printf()</code>系列函数一致，除了最后一个参数是可变参数对象。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdarg.h></span></span>
    
<span class="token keyword">int</span> <span class="token function">vprintf</span><span class="token punctuation">(</span>
  <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> restrict format<span class="token punctuation">,</span>
  va_list arg
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">vfprintf</span><span class="token punctuation">(</span>
  FILE <span class="token operator">*</span> restrict stream<span class="token punctuation">,</span>
  <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> restrict format<span class="token punctuation">,</span>
  va_list arg
<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token keyword">int</span> <span class="token function">vsprintf</span><span class="token punctuation">(</span>
  <span class="token keyword">char</span> <span class="token operator">*</span> restrict s<span class="token punctuation">,</span>
  <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> restrict format<span class="token punctuation">,</span>
  va_list arg
<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token keyword">int</span> <span class="token function">vsnprintf</span><span class="token punctuation">(</span>
  <span class="token keyword">char</span> <span class="token operator">*</span> restrict s<span class="token punctuation">,</span>
  size_t n<span class="token punctuation">,</span>
  <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> restrict format<span class="token punctuation">,</span>
  va_list arg
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>它们的返回值都为输出的字符数，如果出错，返回负值。</p>
<p><code>vsprintf()</code>和<code>vsnprintf()</code>的第一个参数可以为 NULL，用来查看多少个字符会被写入。</p>
<p>下面是一个例子。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">logger</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>format<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  va_list va<span class="token punctuation">;</span>
  <span class="token function">va_start</span><span class="token punctuation">(</span>va<span class="token punctuation">,</span> format<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token function">vprintf</span><span class="token punctuation">(</span>format<span class="token punctuation">,</span> va<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">va_end</span><span class="token punctuation">(</span>va<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 输出 x = 12 and y = 3.20</span>
<span class="token function">logger</span><span class="token punctuation">(</span><span class="token string">"x = %d and y = %.2f"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>（2）输入函数</p>
<p>下面是<code>scanf()</code>的变体函数，用于按照给定格式，输入可变参数列表 (va_list)。</p>
<ul>
<li>vscanf()：按照给定格式，从控制台读取（默认为键盘）。</li>
<li>vfscanf()：按照给定格式，从文件读取。</li>
<li>vsscanf()：按照给定格式，从字符串读取。</li>
</ul>
<p>它们的原型如下，跟对应的<code>scanf()</code>函数基本一致，除了最后一个参数是可变参数对象。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdarg.h></span></span>
    
<span class="token keyword">int</span> <span class="token function">vscanf</span><span class="token punctuation">(</span>
  <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> restrict format<span class="token punctuation">,</span>
  va_list arg
<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token keyword">int</span> <span class="token function">vfscanf</span><span class="token punctuation">(</span>
  FILE <span class="token operator">*</span> restrict stream<span class="token punctuation">,</span>
  <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> restrict format<span class="token punctuation">,</span>
  va_list arg
<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token keyword">int</span> <span class="token function">vsscanf</span><span class="token punctuation">(</span>
  <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> restrict s<span class="token punctuation">,</span>
  <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> restrict format<span class="token punctuation">,</span>
  va_list arg
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>它们返回成功读取的项数，遇到文件结尾或错误，则返回 EOF。</p>
<p>下面是一个例子。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">error_check_scanf</span><span class="token punctuation">(</span><span class="token keyword">int</span> expected_count<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>format<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  va_list va<span class="token punctuation">;</span>

  <span class="token function">va_start</span><span class="token punctuation">(</span>va<span class="token punctuation">,</span> format<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token function">vscanf</span><span class="token punctuation">(</span>format<span class="token punctuation">,</span> va<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">va_end</span><span class="token punctuation">(</span>va<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">assert</span><span class="token punctuation">(</span>count <span class="token operator">==</span> expected_count<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> count<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">error_check_scanf</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"%d, %d/%f"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>a<span class="token punctuation">,</span> <span class="token operator">&amp;</span>b<span class="token punctuation">,</span> <span class="token operator">&amp;</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="stdlib-h"><a href="#stdlib-h" class="headerlink" title="stdlib.h"></a>stdlib.h</h1><h2 id="类型别名和宏"><a href="#类型别名和宏" class="headerlink" title="类型别名和宏"></a>类型别名和宏</h2><p>stdlib.h 定义了下面的类型别名。</p>
<ul>
<li>size_t：sizeof 的返回类型。</li>
<li>wchar_t：宽字符类型。</li>
</ul>
<p>stdlib.h 定义了下面的宏。</p>
<ul>
<li>NULL：空指针。</li>
<li>EXIT_SUCCESS：函数运行成功时的退出状态。</li>
<li>EXIT_FAILURE：函数运行错误时的退出状态。</li>
<li>RAND_MAX：rand() 函数可以返回的最大值。</li>
<li>MB_CUR_MAX：当前语言环境中，多字节字符占用的最大字节数。</li>
</ul>
<h2 id="abs-，labs-，llabs"><a href="#abs-，labs-，llabs" class="headerlink" title="abs()，labs()，llabs()"></a>abs()，labs()，llabs()</h2><p>这三个函数用于计算整数的绝对值。<code>abs()</code>用于 int 类型，<code>labs()</code>用于 long int 类型，<code>llabs()</code>用于 long long int 类型。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> <span class="token keyword">int</span> <span class="token function">labs</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">int</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> <span class="token keyword">long</span> <span class="token keyword">int</span> <span class="token function">llabs</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">long</span> <span class="token keyword">int</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>下面是用法示例。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// 输出 |-2| = 2</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|-2| = %d\n"</span><span class="token punctuation">,</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 输出 |4|  = 4</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|4|  = %d\n"</span><span class="token punctuation">,</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="div-，ldiv-，lldiv"><a href="#div-，ldiv-，lldiv" class="headerlink" title="div()，ldiv()，lldiv()"></a>div()，ldiv()，lldiv()</h2><p>这三个函数用来计算两个参数的商和余数。<code>div()</code>用于 int 类型的相除，<code>ldiv()</code>用于 long int 类型的相除，<code>lldiv()</code>用于 long long int 类型的相除。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">div_t <span class="token function">div</span><span class="token punctuation">(</span><span class="token keyword">int</span> numer<span class="token punctuation">,</span> <span class="token keyword">int</span> denom<span class="token punctuation">)</span><span class="token punctuation">;</span>
ldiv_t <span class="token function">ldiv</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">int</span> numer<span class="token punctuation">,</span> <span class="token keyword">long</span> <span class="token keyword">int</span> denom<span class="token punctuation">)</span><span class="token punctuation">;</span>
lldiv_t <span class="token function">lldiv</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">long</span> <span class="token keyword">int</span> numer<span class="token punctuation">,</span> <span class="token keyword">long</span> <span class="token keyword">long</span> <span class="token keyword">int</span> denom<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>这些函数把第2个参数（分母）除以第1个参数（分子），产生商和余数。这两个值通过一个数据结构返回，<code>div()</code>返回 div_t 结构，<code>ldiv()</code>返回 ldiv_t 结构，<code>lldiv()</code>返回 lldiv_t 结构。</p>
<p>这些结构都包含下面两个字段，</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span>　quot<span class="token punctuation">;</span>　 <span class="token comment">//　商</span>
<span class="token keyword">int</span>　rem<span class="token punctuation">;</span>　 <span class="token comment">//　余数</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>它们完整的定义如下。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">int</span> quot<span class="token punctuation">,</span> rem<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> div_t<span class="token punctuation">;</span>
    
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">long</span> <span class="token keyword">int</span> quot<span class="token punctuation">,</span> rem<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> ldiv_t<span class="token punctuation">;</span>
    
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">long</span> <span class="token keyword">long</span> <span class="token keyword">int</span> quot<span class="token punctuation">,</span> rem<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> lldiv_t<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>下面是一个例子。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">div_t d <span class="token operator">=</span> <span class="token function">div</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 输出 64 / -7 = -9</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"64 / -7 = %d\n"</span><span class="token punctuation">,</span> d<span class="token punctuation">.</span>quot<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 输出 64 % -7 = 1</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"64 %% -7 = %d\n"</span><span class="token punctuation">,</span> d<span class="token punctuation">.</span>rem<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="字符串转成数值"><a href="#字符串转成数值" class="headerlink" title="字符串转成数值"></a>字符串转成数值</h2><h3 id="a-系列函数"><a href="#a-系列函数" class="headerlink" title="a 系列函数"></a>a 系列函数</h3><p><code>stdlib.h</code>定义了一系列函数，可以将字符串转为数组。</p>
<ul>
<li>atoi()：字符串转成 int 类型。</li>
<li>atof()：字符串转成 double 类型。</li>
<li>atol()：字符串转成 long int 类型。</li>
<li>atoll()：字符串转成 long long int 类型。</li>
</ul>
<p>它们的原型如下。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">atoi</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> nptr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> <span class="token function">atof</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> nptr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> <span class="token keyword">int</span> <span class="token function">atol</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> nptr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> <span class="token keyword">long</span> <span class="token keyword">int</span> <span class="token function">atoll</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> nptr<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面函数的参数都是一个字符串指针，字符串开头的空格会被忽略，转换到第一个无效字符处停止。函数名称里面的<code>a</code>代表 ASCII，所以<code>atoi()</code>的意思是“ASCII to int”。</p>
<p>它们返回转换后的数值，如果字符串无法转换，则返回<code>0</code>。</p>
<p>下面是用法示例。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">atoi</span><span class="token punctuation">(</span><span class="token string">"3490"</span><span class="token punctuation">)</span>   <span class="token comment">// 3490</span>
<span class="token function">atof</span><span class="token punctuation">(</span><span class="token string">"3.141593"</span><span class="token punctuation">)</span>   <span class="token comment">// 3.141593</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>如果参数是数字开头的字符串，<code>atoi()</code>会只转换数字部分，比如<code>atoi(&quot;42regular&quot;)</code>会返回整数<code>42</code>。如果首字符不是数字，比如“hello world”，则会返回<code>0</code>。</p>
<h3 id="str-系列函数（浮点数转换）"><a href="#str-系列函数（浮点数转换）" class="headerlink" title="str 系列函数（浮点数转换）"></a>str 系列函数（浮点数转换）</h3><p><code>stdlib.h</code>还定义了一些更强功能的浮点数转换函数。</p>
<ul>
<li>strtof()：字符串转成 float 类型。</li>
<li>strtod()：字符串转成 double 类型。</li>
<li>strtold()：字符串转成 long double 类型。</li>
</ul>
<p>它们的原型如下。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">float</span> <span class="token function">strtof</span><span class="token punctuation">(</span>
  <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> restrict nptr<span class="token punctuation">,</span>
  <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> restrict endptr
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">double</span> <span class="token function">strtod</span><span class="token punctuation">(</span>
  <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> restrict nptr<span class="token punctuation">,</span>
  <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> restrict endptr
<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token keyword">long</span> <span class="token keyword">double</span> <span class="token function">strtold</span><span class="token punctuation">(</span>
  <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> restrict nptr<span class="token punctuation">,</span>
  <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> restrict endptr
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>它们都接受两个参数，第一个参数是需要转换的字符串，第二个参数是一个指针，指向原始字符串里面无法转换的部分。</p>
<ul>
<li><code>nptr</code>：待转换的字符串（起首的空白字符会被忽略）。</li>
<li><code>endprt</code>：一个指针，指向不能转换部分的第一个字符。如果字符串可以完全转成数值，该指针指向字符串末尾的终止符<code>\0</code>。这个参数如果设为 NULL，就表示不需要处理字符串剩余部分。</li>
</ul>
<p>它们的返回值是已经转换后的数值。如果字符串无法转换，则返回<code>0</code>。如果转换结果发生溢出，errno 会被设置为 ERANGE。如果值太大（无论是正数还是负数），函数返回<code>HUGE_VAL</code>；如果值太小，函数返回零。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">char</span> <span class="token operator">*</span>inp <span class="token operator">=</span> <span class="token string">"   123.4567abdc"</span><span class="token punctuation">;</span>
<span class="token keyword">char</span> <span class="token operator">*</span>badchar<span class="token punctuation">;</span>

<span class="token keyword">double</span> val <span class="token operator">=</span> <span class="token function">strtod</span><span class="token punctuation">(</span>inp<span class="token punctuation">,</span> <span class="token operator">&amp;</span>badchar<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%f\n"</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 123.456700</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s\n"</span><span class="token punctuation">,</span> badchar<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// abdc</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>字符串可以完全转换的情况下，第二个参数指向<code>\0</code>，因此可以用下面的写法判断是否完全转换。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>endptr <span class="token operator">==</span> <span class="token string">'\0'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 完全转换</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 存在无法转换的字符</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>如果不关心没有转换的部分，则可以将 endptr 设置为 NULL。</p>
<p>这些函数还可以将字符串转换为特殊值 Infinity 和 NaN。如果字符串包含 INF 或 INFINITY（大写或小写皆可），则将转换为 Infinity；如果字符串包含 NAN，则将返回 NaN。</p>
<h3 id="str-系列函数（整数转换）"><a href="#str-系列函数（整数转换）" class="headerlink" title="str 系列函数（整数转换）"></a>str 系列函数（整数转换）</h3><p>str 系列函数也有整数转换的对应函数。</p>
<ul>
<li>strtol()：字符串转成 long int 类型。</li>
<li>strtoll()：字符串转成 long long int 类型。</li>
<li>strtoul()：字符串转成 unsigned long int 类型。</li>
<li>strtoull()：字符串转成 unsigned long long int 类型。</li>
</ul>
<p>它们的原型如下。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">long</span> <span class="token keyword">int</span> <span class="token function">strtol</span><span class="token punctuation">(</span>
  <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> restrict nptr<span class="token punctuation">,</span>
  <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> restrict endptr<span class="token punctuation">,</span>
  <span class="token keyword">int</span> base
<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token keyword">long</span> <span class="token keyword">long</span> <span class="token keyword">int</span> <span class="token function">strtoll</span><span class="token punctuation">(</span>
  <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> restrict nptr<span class="token punctuation">,</span>
  <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> restrict endptr<span class="token punctuation">,</span>
  <span class="token keyword">int</span> base
<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token keyword">int</span> <span class="token function">strtoul</span><span class="token punctuation">(</span>
  <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> restrict nptr<span class="token punctuation">,</span>
  <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> restrict endptr<span class="token punctuation">,</span>
  <span class="token keyword">int</span> base
<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token keyword">long</span> <span class="token keyword">int</span> <span class="token function">strtoull</span><span class="token punctuation">(</span>
  <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> restrict nptr<span class="token punctuation">,</span>
  <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> restrict endptr<span class="token punctuation">,</span> <span class="token keyword">int</span> base
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>它们接受三个参数。</p>
<p>（1）<code>nPtr</code>：待转换的字符串（起首的空白字符会被忽略）。</p>
<p>（2）<code>endPrt</code>：一个指针，指向不能转换部分的第一个字符。如果字符串可以完全转成数值，该指针指向字符串末尾的终止符<code>\0</code>。这个参数如果设为 NULL，就表示不需要处理字符串剩余部分。</p>
<p>（3）<code>base</code>：待转换整数的进制。这个值应该是<code>2</code>到<code>36</code>之间的整数，代表相应的进制，如果是特殊值<code>0</code>，表示让函数根据数值的前缀，自己确定进制，即如果数字有前缀<code>0</code>，则为八进制，如果数字有前缀<code>0x</code>或<code>0X</code>，则为十六进制。</p>
<p>它们的返回值是转换后的数值，如果转换不成功，返回<code>0</code>。</p>
<p>下面是转换十进制整数的例子。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">char</span><span class="token operator">*</span> s <span class="token operator">=</span> <span class="token string">"3490"</span><span class="token punctuation">;</span>
<span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token function">strtoul</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%lu\n"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3490</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>下面是转换十六进制整数的例子。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">char</span><span class="token operator">*</span> end<span class="token punctuation">;</span>

<span class="token keyword">long</span> value <span class="token operator">=</span> <span class="token function">strtol</span><span class="token punctuation">(</span><span class="token string">"0xff"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>end<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%ld\n"</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 255</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s\n"</span><span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 无内容</span>

value <span class="token operator">=</span> <span class="token function">strtol</span><span class="token punctuation">(</span><span class="token string">"0xffxx"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>end<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%ld\n"</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 255</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s\n"</span><span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// xx</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面示例中，<code>strtol()</code>可以指定字符串包含的是16进制整数。不能转换的部分，可以使用指针<code>end</code>进行访问。</p>
<p>下面是转换二进制整数的例子。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">char</span><span class="token operator">*</span> s <span class="token operator">=</span> <span class="token string">"101010"</span><span class="token punctuation">;</span>
<span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token function">strtoul</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%lu\n"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 42</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>下面是让函数自行判断整数进制的例子。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> string <span class="token operator">=</span> <span class="token string">"-1234567abc"</span><span class="token punctuation">;</span>
  <span class="token keyword">char</span><span class="token operator">*</span> remainderPtr<span class="token punctuation">;</span>
  <span class="token keyword">long</span> x <span class="token operator">=</span> <span class="token function">strtol</span><span class="token punctuation">(</span>string<span class="token punctuation">,</span> <span class="token operator">&amp;</span>remainderPtr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s\"%s\"\n%s%ld\n%s\"%s\"\n"</span><span class="token punctuation">,</span>
    <span class="token string">"The original string is "</span><span class="token punctuation">,</span>
    string<span class="token punctuation">,</span>
    <span class="token string">"The converted value is "</span><span class="token punctuation">,</span>
    x<span class="token punctuation">,</span>
    <span class="token string">"The remainder of the original string is "</span><span class="token punctuation">,</span>
    remainderPtr
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面代码的输出结果如下。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">The original string is <span class="token string">"-1234567abc"</span>
The converted value is <span class="token operator">-</span><span class="token number">1234567</span>
The remainder of the original string is <span class="token string">"abc"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>如果被转换的值太大，<code>strtol()</code>函数在<code>errno</code>中存储<code>ERANGE</code>这个值，并返回<code>LONG_MIN</code>（原值为负数）或<code>LONG_MAX</code>（原值为正数），<code>strtoul()</code>则返回<code>ULONG_MAX</code>。</p>
<h2 id="rand"><a href="#rand" class="headerlink" title="rand()"></a>rand()</h2><p><code>rand()</code>函数用来生成 0～RAND_MAX 之间的随机整数。<code>RAND_MAX</code>是一个定义在<code>stdlib.h</code>里面的宏，通常等于 INT_MAX。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// 原型</span>
<span class="token keyword">int</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 示例</span>
<span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>如果希望获得整数 N 到 M 之间的随机数（包括 N 和 M 两个端点值），可以使用下面的写法。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> （M <span class="token operator">-</span> N <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> N<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>比如，1 到 6 之间的随机数，写法如下。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">6</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>获得浮点数的随机值，可以使用下面的写法。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// 0 到 0.999999 之间的随机数</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"0 to 0.99999: %f\n"</span><span class="token punctuation">,</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>RAND_MAX <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// n 到 m 之间的随机数：</span>
<span class="token comment">// n + m * (rand() / (float)RAND_MAX)</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"10.5 to 15.7: %f\n"</span><span class="token punctuation">,</span> <span class="token number">10.5</span> <span class="token operator">+</span> <span class="token number">5.2</span> <span class="token operator">*</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>RAND_MAX<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面示例中，由于<code>rand()</code>和<code>RAND_MAX</code>都是 int 类型，要用显示的类型转换转为浮点数。</p>
<h2 id="srand"><a href="#srand" class="headerlink" title="srand()"></a>srand()</h2><p><code>rand()</code>是伪随机数函数，为了增加随机性，必须在调用它之前，使用<code>srand()</code>函数重置一下种子值。</p>
<p><code>srand()</code>函数接受一个无符号整数（unsigned int）作为种子值，没有返回值。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">srand</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> seed<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>通常使用<code>time(NULL)</code>函数返回当前距离时间纪元的秒数，作为<code>srand()</code>的参数。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;time.h></span></span>
<span class="token function">srand</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>上面代码中，<code>time()</code>的原型定义在头文件<code>time.h</code>里面，返回值的类型是类型别名<code>time_t</code>，具体的类型与系统有关，所以要强制转换一下类型。<code>time()</code>的参数是一个指针，指向一个具体的 time_t 类型的时间值，这里传入空指针<code>NULL</code>作为参数，由于 NULL 一般是<code>0</code>，所以也可以写成<code>time(0)</code>。</p>
<h2 id="abort"><a href="#abort" class="headerlink" title="abort()"></a>abort()</h2><p><code>abort()</code>用于不正常地终止一个正在执行的程序。使用这个函数的目的，主要是它会触发 SIGABRT 信号，开发者可以在程序中为这个信号设置一个处理函数。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">abort</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>该函数没有参数。</p>
<h2 id="exit-，quick-exit-，-Exit"><a href="#exit-，quick-exit-，-Exit" class="headerlink" title="exit()，quick_exit()，_Exit()"></a>exit()，quick_exit()，_Exit()</h2><p>这三个函数都用来退出当前正在执行的程序。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">exit</span><span class="token punctuation">(</span><span class="token keyword">int</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">quick_exit</span><span class="token punctuation">(</span><span class="token keyword">int</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">_Exit</span><span class="token punctuation">(</span><span class="token keyword">int</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>它们都接受一个整数，表示程序的退出状态，<code>0</code>是正常退出，非零值表示发生错误，可以使用宏<code>EXIT_SUCCESS</code>和<code>EXIT_FAILURE</code>当作参数。它们本身没有返回值。</p>
<p>它们的区别是，退出时所做的清理工作不同。<code>exit()</code>是正常退出，系统会做完整的清理，比如更新所有文件流，并且删除临时文件。<code>quick_exit()</code>是快速退出，系统的清理工作稍微少一点。<code>_Exit()</code>是立即退出，不做任何清理工作。</p>
<p>下面是一些用法示例。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">exit</span><span class="token punctuation">(</span>EXIT_SUCCESS<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">quick_exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">_Exit</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="atexit-，at-quick-exit"><a href="#atexit-，at-quick-exit" class="headerlink" title="atexit()，at_quick_exit()"></a>atexit()，at_quick_exit()</h2><p><code>atexit()</code>用来登记当前程序退出时（调用<code>exit()</code>或<code>main()</code>正常退出），所要执行的其他函数。</p>
<p><code>at_quick_exit()</code>则是登记使用<code>quick_exit()</code>方法退出当前程序时，所要执行的其他函数。</p>
<p><code>exit()</code>只能触发<code>atexit()</code>登记的函数，<code>quick_exit()</code>只能触发<code>at_quick_exit()</code>登记的函数。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">atexit</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>func<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">at_quick_exit</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>func<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>它们的参数是要执行的函数地址，即函数名。它们的返回值都是调用成功时返回<code>0</code>，调用失败时返回非零值。</p>
<p>下面是一个例子。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">sign_off</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">too_bad</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token keyword">int</span> n<span class="token punctuation">;</span>
  <span class="token function">atexit</span><span class="token punctuation">(</span>sign_off<span class="token punctuation">)</span><span class="token punctuation">;</span>　　 <span class="token comment">/* 注册 sign_off()函数 */</span>

  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Enter an integer:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>n<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"That's no integer!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">atexit</span><span class="token punctuation">(</span>too_bad<span class="token punctuation">)</span><span class="token punctuation">;</span>　<span class="token comment">/* 注册 too_bad()函数 */</span>
    <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d is %s.\n"</span><span class="token punctuation">,</span> n<span class="token punctuation">,</span> <span class="token punctuation">(</span>n <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">"even"</span> <span class="token operator">:</span> <span class="token string">"odd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">void</span> <span class="token function">sign_off</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"sign_off"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">void</span> <span class="token function">too_bad</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"too bad"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面示例中，用户输入失败时，会调用<code>sign_off()</code>和<code>too_bad()</code>函数；但是输入成功时只会调用<code>sign_off()</code>。因为只有输入失败时，才会进入<code>if</code>语句登记<code>too_bad()</code>。</p>
<p>另外，如果有多条<code>atexit()</code>语句，函数退出时最先调用的，是最后一个登记的函数。</p>
<p><code>atexit()</code>登记的函数（如上例的<code>sign_off</code>和<code>too_bad</code>）应该不带任何参数且返回类型为<code>void</code>。通常，这些函数会执行一些清理任务，例如删除临时文件或重置环境变量。</p>
<p><code>at_quick_exit()</code>也是同样的规则，下面是一个例子。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">exit_handler_1</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"1\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">void</span> <span class="token function">exit_handler_2</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"2\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">at_quick_exit</span><span class="token punctuation">(</span>exit_handler_1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">at_quick_exit</span><span class="token punctuation">(</span>exit_handler_2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">quick_exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>执行上面的示例，命令行会先输出2，再输出1。</p>
<h2 id="getenv"><a href="#getenv" class="headerlink" title="getenv()"></a>getenv()</h2><p><code>getenv()</code>用于获取环境变量的值。环境变量是操作系统提供的程序之外的一些环境参数。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">getenv</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>它的参数是一个字符串，表示环境变量名。返回值也是一个字符串，表示环境变量的值。如果指定的环境变量不存在，则返回 NULL。</p>
<p>下面是输出环境变量<code>$PATH</code>的值的例子。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"PATH is %s\n"</span><span class="token punctuation">,</span> <span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">"PATH"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="system"><a href="#system" class="headerlink" title="system()"></a>system()</h2><p><code>system()</code>函数用于执行外部程序。它会把它的参数字符串传递给操作系统，让操作系统的命令处理器来执行。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">system</span><span class="token punctuation">(</span> <span class="token keyword">char</span> <span class="token keyword">const</span> <span class="token operator">*</span> command <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>这个函数的返回值因编译器而异。但是标准规定，如果 NULL 作为参数，表示询问操作系统，是否有可用的命令处理器，如果有的话，返回一个非零值，否则返回零。</p>
<p>下面是执行<code>ls</code>命令的例子。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"ls -l"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="内存管理函数"><a href="#内存管理函数" class="headerlink" title="内存管理函数"></a>内存管理函数</h2><p>stdlib.h 提供了一些内存操作函数，下面几个函数详见《内存管理》一章，其余在本节介绍。</p>
<ul>
<li>malloc()：分配内存区域</li>
<li>calloc()：分配内存区域。</li>
<li>realloc()：调节内存区域大小。</li>
<li>free()：释放内存区域。</li>
</ul>
<h3 id="aligned-alloc"><a href="#aligned-alloc" class="headerlink" title="aligned_alloc()"></a>aligned_alloc()</h3><p>很多系统有内存对齐的要求，即内存块的大小必须是某个值（比如64字节）的倍数，这样有利于提高处理速度。<code>aligned_alloc()</code>就用于分配满足内存对齐要求的内存块，它的原型如下。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">aligned_alloc</span><span class="token punctuation">(</span>size_t alignment<span class="token punctuation">,</span> size_t size<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>它接受两个参数。</p>
<ul>
<li>alignment：整数，表示内存对齐的单位大小，一般是2的整数次幂（2、4、8、16……）。</li>
<li>size：整数，表示内存块的大小。</li>
</ul>
<p>分配成功时，它返回一个无类型指针，指向新分配的内存块。分配失败时，返回 NULL。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">char</span><span class="token operator">*</span> p <span class="token operator">=</span> <span class="token function">aligned_alloc</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>上面示例中，<code>aligned_alloc()</code>分配的内存块，单位大小是64字节，要分配的字节数是256字节。</p>
<h2 id="qsort"><a href="#qsort" class="headerlink" title="qsort()"></a>qsort()</h2><p><code>qsort()</code>用来快速排序一个数组。它对数组成员的类型没有要求，任何类型数组都可以用这个函数排序。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">qsort</span><span class="token punctuation">(</span>
  <span class="token keyword">void</span> <span class="token operator">*</span>base<span class="token punctuation">,</span>
  size_t nmemb<span class="token punctuation">,</span> 
  size_t size<span class="token punctuation">,</span>
  <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>compar<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>该函数接受四个参数。</p>
<ul>
<li>base：指向要排序的数组开始位置的指针。</li>
<li>nmemb：数组成员的数量。</li>
<li>size：数组每个成员占用的字节长度。</li>
<li>compar：一个函数指针，指向一个比较两个成员的函数。</li>
</ul>
<p>比较函数<code>compar</code>将指向数组两个成员的指针作为参数，并比较两个成员。如果第一个参数小于第二个参数，该函数应该返回一个负值；如果两个函数相等，返回<code>0</code>；如果第一个参数大于第二个参数，应该返回一个正数。</p>
<p>下面是一个用法示例。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>

<span class="token keyword">int</span> <span class="token function">compar</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">void</span><span class="token operator">*</span> elem0<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span><span class="token operator">*</span> elem1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">*</span> x <span class="token operator">=</span> elem0<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">*</span> y <span class="token operator">=</span> elem1<span class="token punctuation">;</span> 
  
  <span class="token keyword">return</span> <span class="token operator">*</span>x <span class="token operator">-</span> <span class="token operator">*</span>y<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">int</span> a<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

  <span class="token function">qsort</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">,</span> compar<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">9</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d "</span><span class="token punctuation">,</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>执行上面示例，会输出排序好的数组“1 2 3 6 8 10 13 14 17”。</p>
<h2 id="bsearch"><a href="#bsearch" class="headerlink" title="bsearch()"></a>bsearch()</h2><p><code>bsearch()</code>使用二分法搜索，在数组中搜索一个值。它对数组成员的类型没有要求，任何类型数组都可以用这个函数搜索值。</p>
<p>注意，该方法只对已经排序好的数组有效。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">bsearch</span><span class="token punctuation">(</span>
  <span class="token keyword">const</span> <span class="token keyword">void</span><span class="token operator">*</span> key<span class="token punctuation">,</span>
  <span class="token keyword">const</span> <span class="token keyword">void</span><span class="token operator">*</span> base<span class="token punctuation">,</span>
  size_t nmemb<span class="token punctuation">,</span>
  size_t size<span class="token punctuation">,</span>
  <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>compar<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这个函数接受5个参数。</p>
<ul>
<li>key：指向要查找的值的指针。</li>
<li>base：指向数组开始位置的指针，数组必须已经排序。</li>
<li>nmemb：数组成员的数量。</li>
<li>size：数组每个成员占用的字节长度。</li>
<li>compar：指向一个将待查找值与其他值进行比较的函数的指针。</li>
</ul>
<p>比较函数<code>compar</code>将待查找的值作为第一个参数，将要比较的值作为第二个参数。如果第一个参数小于第二个参数，该函数应该返回一个负值；如果两个参数相等，返回<code>0</code>；如果第一个参数大于第二个参数，返回一个正值。</p>
<p>如果找到待查找的值，<code>bsearch()</code>返回指向该值的指针，如果找不到，返回 NULL。</p>
<p>下面是一个用法示例。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>

<span class="token keyword">int</span> <span class="token function">compar</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>key<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">*</span> k <span class="token operator">=</span> key<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">*</span> v <span class="token operator">=</span> value<span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token operator">*</span>k <span class="token operator">-</span> <span class="token operator">*</span>v<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">int</span> a<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

  <span class="token keyword">int</span><span class="token operator">*</span> r<span class="token punctuation">;</span>
  <span class="token keyword">int</span> key<span class="token punctuation">;</span>

  key <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span> <span class="token comment">// 包括在数组中</span>
  r <span class="token operator">=</span> <span class="token function">bsearch</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>key<span class="token punctuation">,</span> a<span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">,</span> compar<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Found %d\n"</span><span class="token punctuation">,</span> <span class="token operator">*</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>

  key <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>  <span class="token comment">// 不包括在数组中</span>
  r <span class="token operator">=</span> <span class="token function">bsearch</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>key<span class="token punctuation">,</span> a<span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">,</span> compar<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Didn't find 30\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>执行上面的示例，会输出下面的结果。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Found <span class="token number">12</span>
Didn't <span class="token function">find</span> <span class="token number">30</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="多字节字符函数"><a href="#多字节字符函数" class="headerlink" title="多字节字符函数"></a>多字节字符函数</h2><p>stdlib.h 提供了下面的函数，用来操作多字节字符，详见《多字节字符》一章。</p>
<ul>
<li>mblen()：多字节字符的字节长度。</li>
<li>mbtowc()：将多字节字符转换为宽字符。</li>
<li>wctomb()：将宽字符转换为多字节字符。</li>
<li>mbstowcs()：将多字节字符串转换为宽字符串。</li>
<li>wcstombs()：将宽字符串转换为多字节字符串。</li>
</ul>
<h1 id="string-h"><a href="#string-h" class="headerlink" title="string.h"></a>string.h</h1><p><code>string.h</code>主要定义了字符串处理函数和内存操作函数。</p>
<h2 id="字符串处理函数"><a href="#字符串处理函数" class="headerlink" title="字符串处理函数"></a>字符串处理函数</h2><p>以下字符串处理函数，详见《字符串》一章。</p>
<ul>
<li>strcpy()：复制字符串。</li>
<li>strncpy()：复制字符串，有长度限制。</li>
<li>strcat()：连接两个字符串。</li>
<li>strncat()：连接两个字符串，有长度限制。</li>
<li>strcmp()：比较两个字符串。</li>
<li>strncmp()：比较两个字符串，有长度限制。</li>
<li>strlen()：返回字符串的字节数。</li>
</ul>
<h3 id="strchr-，strrchr"><a href="#strchr-，strrchr" class="headerlink" title="strchr()，strrchr()"></a>strchr()，strrchr()</h3><p><code>strchr()</code>和<code>strrchr()</code>都用于在字符串中查找指定字符。不同之处是，<code>strchr()</code>从字符串开头开始查找，<code>strrchr()</code>从字符串结尾开始查找，函数名里面多出来的那个<code>r</code>表示 reverse（反向）。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">strchr</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> str<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">strrchr</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>str<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>它们都接受两个参数，第一个参数是字符串指针，第二个参数是所要查找的字符。</p>
<p>一旦找到该字符，它们就会停止查找，并返回指向该字符的指针。如果没有找到，则返回 NULL。</p>
<p>下面是一个例子。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">char</span> <span class="token operator">*</span>str <span class="token operator">=</span> <span class="token string">"Hello, world!"</span><span class="token punctuation">;</span>
<span class="token keyword">char</span> <span class="token operator">*</span>p<span class="token punctuation">;</span>

p <span class="token operator">=</span> <span class="token function">strchr</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// p 指向逗号的位置</span>
p <span class="token operator">=</span> <span class="token function">strrchr</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token string">'o'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// p 指向 world 里面 o 的位置</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="strspn-，strcspn"><a href="#strspn-，strcspn" class="headerlink" title="strspn()，strcspn()"></a>strspn()，strcspn()</h3><p><code>strspn()</code>用来查找属于指定字符集的字符串长度，<code>strcspn()</code>正好相反，用来查找不属于指定字符集的字符串长度。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">size_t <span class="token function">strspn</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> str<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> accept<span class="token punctuation">)</span><span class="token punctuation">;</span>
size_t <span class="token function">strcspn</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>str<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>reject<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>这两个函数接受两个参数，第一个参数是源字符串，第二个参数是由指定字符组成的字符串。</p>
<p><code>strspn()</code>从第一个参数的开头开始查找，一旦发现第一个不属于指定字符集范围的字符，就停止查找，返回到目前为止的字符串长度。如果始终没有不在指定字符集的字符，则返回第一个参数字符串的长度。</p>
<p><code>strcspn()</code>则是一旦发现第一个属于指定字符集范围的字符，就停止查找，返回到目前为止的字符串长度。如果始终没有发现指定字符集的字符，则返回第一个参数字符串的长度。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">char</span> str<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"hello world"</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> n<span class="token punctuation">;</span>

n <span class="token operator">=</span> <span class="token function">strspn</span><span class="token punctuation">(</span>str1<span class="token punctuation">,</span> <span class="token string">"aeiou"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// n == 0</span>

n <span class="token operator">=</span> <span class="token function">strcspn</span><span class="token punctuation">(</span>str1<span class="token punctuation">,</span> <span class="token string">"aeiou"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// n == 1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面示例中，第一个<code>n</code>等于0，因为0号位置的字符<code>h</code>就不属于指定字符集<code>aeiou</code>，可以理解为开头有0个字符属于指定字符集。第二个<code>n</code>等于1，因为1号位置的字符<code>e</code>属于指定字符集<code>aeiou</code>，可以理解为开头有1个字符不属于指定字符集。</p>
<h3 id="strpbrk"><a href="#strpbrk" class="headerlink" title="strpbrk()"></a>strpbrk()</h3><p><code>strpbrk()</code>在字符串中搜索指定字符集的任一个字符。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">strpbrk</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> s1<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>它接受两个参数，第一个参数是源字符串，第二个参数是由指定字符组成的字符串。</p>
<p>它返回一个指向第一个匹配字符的指针，如果未找到匹配字符，则返回 NULL。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">char</span><span class="token operator">*</span> s1 <span class="token operator">=</span> <span class="token string">"Hello, world!"</span><span class="token punctuation">;</span>
<span class="token keyword">char</span><span class="token operator">*</span> s2 <span class="token operator">=</span> <span class="token string">"dow!"</span><span class="token punctuation">;</span>

<span class="token keyword">char</span><span class="token operator">*</span> p <span class="token operator">=</span> <span class="token function">strpbrk</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s\n"</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// "o, world!"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面示例中，指定字符集是“dow!”，那么<code>s1</code>里面第一个匹配字符是“Hello”的“o”，所以指针<code>p</code>指向这个字符。输出的话，就会输出从这个字符直到字符串末尾的“o, world!”。</p>
<h3 id="strstr"><a href="#strstr" class="headerlink" title="strstr()"></a>strstr()</h3><p><code>strstr()</code>在一个字符串里面，查找另一个字符串。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">strstr</span><span class="token punctuation">(</span>
  <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> str<span class="token punctuation">,</span>
  <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> substr
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>它接受两个参数，第一个参数是源字符串，第二个参数是所要查找的子字符串。</p>
<p>如果匹配成功，就返回一个指针，指向源字符串里面的子字符串。如果匹配失败，就返回 NULL，表示无法找到子字符串。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">char</span><span class="token operator">*</span> str <span class="token operator">=</span> <span class="token string">"The quick brown fox jumped over the lazy dogs."</span><span class="token punctuation">;</span>
<span class="token keyword">char</span><span class="token operator">*</span> p <span class="token operator">=</span> <span class="token function">strstr</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token string">"lazy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s\n"</span><span class="token punctuation">,</span> p <span class="token operator">==</span> <span class="token constant">NULL</span> <span class="token operator">?</span> <span class="token string">"null"</span><span class="token operator">:</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "lazy dogs."</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面示例中，<code>strstr()</code>用来在源字符串<code>str</code>里面，查找子字符串<code>lazy</code>。从返回的指针到字符串结尾，就是“lazy dogs.”。</p>
<h3 id="strtok"><a href="#strtok" class="headerlink" title="strtok()"></a>strtok()</h3><p><code>strtok()</code>用来将一个字符串按照指定的分隔符（delimiter），分解成一系列词元（tokens）。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">strtok</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> str<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> delim<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>它接受两个参数，第一个参数是待拆分的字符串，第二个参数是指定的分隔符。</p>
<p>它返回一个指针，指向分解出来的第一个词元，并将词元结束之处的分隔符替换成字符串结尾标志<code>\0</code>。如果没有待分解的词元，它返回 NULL。</p>
<p>如果要遍历所有词元，就必须循环调用，参考下面的例子。</p>
<p><code>strtok()</code>的第一个参数如果是 NULL，则表示从上一次<code>strtok()</code>分解结束的位置，继续往下分解。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">char</span> string<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"This is a sentence with 7 tokens"</span><span class="token punctuation">;</span>
  <span class="token keyword">char</span><span class="token operator">*</span> tokenPtr <span class="token operator">=</span> <span class="token function">strtok</span><span class="token punctuation">(</span>string<span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">while</span> <span class="token punctuation">(</span>tokenPtr <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s\n"</span><span class="token punctuation">,</span> tokenPtr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    tokenPtr <span class="token operator">=</span> <span class="token function">strtok</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面示例将源字符串按照空格，分解词元。它的输出结果如下。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">This
is
a
sentence
with
<span class="token number">7</span>
tokens<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>注意，<code>strtok()</code>会修改原始字符串，将所有分隔符都替换成字符串结尾符号<code>\0</code>。因此，最好生成一个原始字符串的拷贝，然后再对这个拷贝执行<code>strtok()</code>。</p>
<h3 id="strcoll"><a href="#strcoll" class="headerlink" title="strcoll()"></a>strcoll()</h3><p><code>strcoll()</code>用于比较两个启用了本地化设置的字符串，用法基本与<code>strcmp()</code>相同。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">strcoll</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>s1<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>请看下面的示例。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">setlocale</span><span class="token punctuation">(</span>LC_ALL<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 报告 é > f</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> <span class="token function">strcmp</span><span class="token punctuation">(</span><span class="token string">"é"</span><span class="token punctuation">,</span> <span class="token string">"f"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  

<span class="token comment">// 报告 é &lt; f</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> <span class="token function">strcoll</span><span class="token punctuation">(</span><span class="token string">"é"</span><span class="token punctuation">,</span> <span class="token string">"f"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面示例比较带重音符号的<code>é</code>与<code>f</code>，<code>strcmp()</code>会返回<code>é</code>大于<code>f</code>，而<code>strcoll()</code>就会正确识别<code>é</code>排在<code>f</code>前面，所以小于<code>f</code>。注意，在比较之前，需要使用<code>setlocale(LC_ALL, &quot;&quot;)</code>，启用本地化设置。</p>
<h3 id="strxfrm"><a href="#strxfrm" class="headerlink" title="strxfrm()"></a>strxfrm()</h3><p><code>strxfrm()</code>将一个本地化字符串转成可以使用<code>strcmp()</code>进行比较的形式，相当于<code>strcoll()</code>内部的第一部分操作。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">size_t <span class="token function">strxfrm</span><span class="token punctuation">(</span>
  <span class="token keyword">char</span> <span class="token operator">*</span> restrict s1<span class="token punctuation">,</span> 
  <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> restrict s2<span class="token punctuation">,</span> 
  size_t n
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>它接受三个参数，将第二个参数<code>s2</code>转为可以使用<code>strcmp()</code>比较的形式，并将结果存入第一个参数<code>s1</code>。第三个参数<code>n</code>用来限定写入的字符数，防止超出<code>s1</code>的边界。</p>
<p>它返回转换后的字符串长度，不包括结尾的终止符。</p>
<p>如果第一个参数是 NULL，第三个参数是0，则不进行实际的转换，只返回转换后所需的字符串长度。</p>
<p>下面的示例是用这个函数自己实现一个<code>strcoll()</code>。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">my_strcoll</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> s1<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> s2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">int</span> len1 <span class="token operator">=</span> <span class="token function">strxfrm</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> s1<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> len2 <span class="token operator">=</span> <span class="token function">strxfrm</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> s2<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>

  <span class="token keyword">char</span> <span class="token operator">*</span>d1 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span>len1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>d2 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span>len2<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">strxfrm</span><span class="token punctuation">(</span>d1<span class="token punctuation">,</span> s1<span class="token punctuation">,</span> len1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">strxfrm</span><span class="token punctuation">(</span>d2<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> len2<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token function">strcmp</span><span class="token punctuation">(</span>d1<span class="token punctuation">,</span> d2<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">free</span><span class="token punctuation">(</span>d2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">free</span><span class="token punctuation">(</span>d1<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面示例中，先为两个进行比较的本地化字符串，分配转换后的存储空间，使用<code>strxfrm()</code>将它们转为可比较的形式，再用<code>strcmp()</code>进行比较。</p>
<h3 id="strerror"><a href="#strerror" class="headerlink" title="strerror()"></a>strerror()</h3><p><code>strerror()</code>函数返回特定错误的说明字符串。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">strerror</span><span class="token punctuation">(</span><span class="token keyword">int</span> errornum<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>它的参数是错误的编号，由<code>errno.h</code>定义。返回值是一个指向说明字符串的指针。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// 输出 No such file or directory</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s\n"</span><span class="token punctuation">,</span> <span class="token function">strerror</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>上面示例输出2号错误的说明字符“No such file or directory“。</p>
<p>下面的例子是自定义报错信息。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;errno.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  FILE<span class="token operator">*</span> fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"NONEXISTENT_FILE.TXT"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>fp <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">char</span><span class="token operator">*</span> errmsg <span class="token operator">=</span> <span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Error %d opening file: %s\n"</span><span class="token punctuation">,</span> errno<span class="token punctuation">,</span> errmsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面示例中，通过<code>strerror(errno)</code>拿到当前的默认报错信息，其中<code>errno</code>是<code>errno.h</code>定义的宏，表示当前的报错编号。然后，再输出一条自定义的报错信息。</p>
<h2 id="内存操作函数"><a href="#内存操作函数" class="headerlink" title="内存操作函数"></a>内存操作函数</h2><p>以下内存操作函数，详见《内存管理》一章。</p>
<ul>
<li>memcpy()：内存复制函数。</li>
<li>memmove()：内存复制函数（允许重叠）。</li>
<li>memcmp()：比较两个内存区域。</li>
</ul>
<h3 id="memchr"><a href="#memchr" class="headerlink" title="memchr()"></a>memchr()</h3><p><code>memchr()</code>用于在内存区域中查找指定字符。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">memchr</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">void</span><span class="token operator">*</span> s<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">,</span> size_t n<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>它接受三个参数，第一个参数是内存区域的指针，第二个参数是所要查找的字符，第三个参数是内存区域的字节长度。</p>
<p>一旦找到，它就会停止查找，并返回指向该位置的指针。如果直到检查完指定的字节数，依然没有发现指定字符，则返回 NULL。</p>
<p>下面是一个例子。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">char</span> <span class="token operator">*</span>str <span class="token operator">=</span> <span class="token string">"Hello, world!"</span><span class="token punctuation">;</span>
<span class="token keyword">char</span> <span class="token operator">*</span>p<span class="token punctuation">;</span>

p <span class="token operator">=</span> <span class="token function">memchr</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token string">'!'</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// p 指向感叹号的位置</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="memset"><a href="#memset" class="headerlink" title="memset()"></a>memset()</h3><p><code>memset()</code>将一段内存全部格式化为指定值。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">memset</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> s<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">,</span> size_t n<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>它的第一个参数是一个指针，指向内存区域的开始位置，第二个参数是待写入的字符值，第三个参数是一个整数，表示需要格式化的字节数。它返回第一个参数（指针）。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">memset</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>上面示例中，p 是一个指针，指向一个长度为 N 个字节的内存区域。<code>memset()</code>将该块内存区域的每个字节，都改写为空格字符。</p>
<p>下面是另一个例子。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">char</span> string1<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"BBBBBBBBBBBBBB"</span><span class="token punctuation">;</span>

<span class="token comment">// 输出 bbbbbbbBBBBBBB</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token function">memset</span><span class="token punctuation">(</span>string1<span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>memset()</code>的一个重要用途，就是将数组成员全部初始化为0。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">memset</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>下面是将 Struct 结构都初始化为0的例子。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">banana</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">float</span> ripeness<span class="token punctuation">;</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>peel_color<span class="token punctuation">;</span>
  <span class="token keyword">int</span> grams<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">banana</span> b<span class="token punctuation">;</span>

<span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>

b<span class="token punctuation">.</span>ripeness <span class="token operator">==</span> <span class="token number">0.0</span><span class="token punctuation">;</span>     <span class="token comment">// True</span>
b<span class="token punctuation">.</span>peel_color <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>  <span class="token comment">// True</span>
b<span class="token punctuation">.</span>grams <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>          <span class="token comment">// True</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面示例，将 Struct banana 的实例 b 的所有属性都初始化为0。</p>
<h2 id="其他函数-1"><a href="#其他函数-1" class="headerlink" title="其他函数"></a>其他函数</h2><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">memset</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">,</span> size_t n<span class="token punctuation">)</span><span class="token punctuation">;</span>

size_t <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h1 id="time-h"><a href="#time-h" class="headerlink" title="time.h"></a>time.h</h1><h2 id="time-t"><a href="#time-t" class="headerlink" title="time_t"></a>time_t</h2><p>time_t 是一个表示时间的类型别名，可以视为国际标准时 UTC。它可能是浮点数，也可能是整数，Unix 系统一般是整数。</p>
<p>许多系统上，time_t 表示自时间纪元（time epoch）以来的秒数。Unix 的时间纪元是国际标准时 UTC 的1970年1月1日的零分零秒。time_t 如果为负数，则表示时间纪元之前的时间。</p>
<p>time_t 一般是32位或64位整数类型的别名，具体类型取决于当前系统。如果是32位带符号整数，time_t 可以表示的时间到 2038年1月19日03:14:07 UTC 为止；如果是32位无符号整数，则表示到2106年。如果是64位带符号整数，可以表示<code>-2930</code>亿年到<code>+2930</code>亿年的时间范围。</p>
<h2 id="struct-tm"><a href="#struct-tm" class="headerlink" title="struct tm"></a>struct tm</h2><p>struct tm 是一个数据结构，用来保存时间的各个组成部分，比如小时、分钟、秒、日、月、年等。下面是它的结构。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">tm</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">int</span> tm_sec<span class="token punctuation">;</span>    <span class="token comment">// 秒数 [0, 60]</span>
  <span class="token keyword">int</span> tm_min<span class="token punctuation">;</span>    <span class="token comment">// 分钟 [0, 59]</span>
  <span class="token keyword">int</span> tm_hour<span class="token punctuation">;</span>   <span class="token comment">// 小时 [0, 23]</span>
  <span class="token keyword">int</span> tm_mday<span class="token punctuation">;</span>   <span class="token comment">// 月份的天数 [1, 31]</span>
  <span class="token keyword">int</span> tm_mon<span class="token punctuation">;</span>    <span class="token comment">// 月份 [0, 11]，一月用 0 表示</span>
  <span class="token keyword">int</span> tm_year<span class="token punctuation">;</span>   <span class="token comment">// 距离 1900 的年数</span>
  <span class="token keyword">int</span> tm_wday<span class="token punctuation">;</span>   <span class="token comment">// 星期几 [0, 6]，星期天用 0 表示</span>
  <span class="token keyword">int</span> tm_yday<span class="token punctuation">;</span>   <span class="token comment">// 距离1月1日的天数 [0, 365]</span>
  <span class="token keyword">int</span> tm_isdst<span class="token punctuation">;</span>  <span class="token comment">// 是否采用夏令时，1 表示采用，0 表示未采用</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="time"><a href="#time" class="headerlink" title="time()"></a>time()</h2><p><code>time()</code>函数返回从时间纪元到现在经过的秒数。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">time_t <span class="token function">time</span><span class="token punctuation">(</span>time_t<span class="token operator">*</span> returned_value<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><code>time()</code>接受一个 time_t 指针作为参数，返回值会写入指针地址。参数可以是空指针 NULL。</p>
<p><code>time()</code>的返回值是 time_t 类型的当前时间。 如果计算机无法提供当前的秒数，或者返回值太大，无法用<code>time_t</code>类型表示，<code>time()</code>函数就返回<code>-1</code>。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">time_t now<span class="token punctuation">;</span>

<span class="token comment">// 写法一    </span>
now <span class="token operator">=</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 写法二    </span>
<span class="token function">time</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>now<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面示例展示了将当前时间存入变量<code>now</code>的两种写法。</p>
<p>如果要知道某个操作耗费的精确时间，需要调用两次<code>time()</code>，再将两次的返回值相减。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">time_t begin <span class="token operator">=</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ... 执行某些操作</span>

time_t end <span class="token operator">=</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> end <span class="token operator">-</span> begin<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>注意，上面的方法只能精确到秒。</p>
<h2 id="ctime"><a href="#ctime" class="headerlink" title="ctime()"></a>ctime()</h2><p><code>ctime()</code>用来将 time_t 类型的值直接输出为人类可读的格式。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">ctime</span><span class="token punctuation">(</span> time_t <span class="token keyword">const</span> <span class="token operator">*</span> time_value <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><code>ctime()</code>的参数是一个 time_t 指针，返回一个字符串指针。该字符串的格式类似“Sun Jul 4 04:02:48 1976\n\0”，尾部包含换行符和字符串终止标志。</p>
<p>下面是一个例子。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">time_t now<span class="token punctuation">;</span> 

now <span class="token operator">=</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 输出 Sun Feb 28 18:47:25 2021</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> <span class="token function">ctime</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>now<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>注意，<code>ctime()</code>会在字符串尾部自动添加换行符。</p>
<h2 id="localtime-，gmtime"><a href="#localtime-，gmtime" class="headerlink" title="localtime()，gmtime()"></a>localtime()，gmtime()</h2><p><code>localtime()</code>函数用来将 time_t 类型的时间，转换为当前时区的 struct tm 结构。</p>
<p><code>gmtime()</code>函数用来将 time_t 类型的时间，转换为 UTC 时间的 struct tm 结构。</p>
<p>它们的区别就是返回值，前者是本地时间，后者是 UTC 时间。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">tm</span><span class="token operator">*</span> <span class="token function">localtime</span><span class="token punctuation">(</span><span class="token keyword">const</span> time_t<span class="token operator">*</span> timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">tm</span><span class="token operator">*</span> <span class="token function">gmtime</span><span class="token punctuation">(</span><span class="token keyword">const</span> time_t<span class="token operator">*</span> timer<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>下面是一个例子。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">time_t now <span class="token operator">=</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 输出 Local: Sun Feb 28 20:15:27 2021</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Local: %s"</span><span class="token punctuation">,</span> <span class="token function">asctime</span><span class="token punctuation">(</span><span class="token function">localtime</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>now<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 输出 UTC  : Mon Mar  1 04:15:27 2021</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"UTC  : %s"</span><span class="token punctuation">,</span> <span class="token function">asctime</span><span class="token punctuation">(</span><span class="token function">gmtime</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>now<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="asctime"><a href="#asctime" class="headerlink" title="asctime()"></a>asctime()</h2><p><code>asctime()</code>函数用来将 struct tm 结构，直接输出为人类可读的格式。该函数会自动在输出的尾部添加换行符。</p>
<p>用法示例参考上一小节。</p>
<h2 id="mktime"><a href="#mktime" class="headerlink" title="mktime()"></a>mktime()</h2><p><code>mktime()</code>函数用于把一个 struct tm 结构转换为 time_t 值。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">time_t　<span class="token function">mktime</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">tm</span><span class="token operator">*</span> tm_ptr<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><code>mktime()</code>的参数是一个 struct tm 指针。</p>
<p><code>mktime()</code>会自动设置 struct tm 结构里面的<code>tm_wday</code>属性和<code>tm_yday</code>属性，开发者自己不必填写这两个属性。所以，这个函数常用来获得指定时间是星期几（<code>tm_wday</code>）。</p>
<p>struct tm 结构的<code>tm_isdst</code>属性也可以设为<code>-1</code>，让<code>mktime()</code>决定是否应该采用夏令时。</p>
<p>下面是一个例子。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">tm</span> some_time <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">.</span>tm_year<span class="token operator">=</span><span class="token number">82</span><span class="token punctuation">,</span>   <span class="token comment">// 距离 1900 的年数</span>
  <span class="token punctuation">.</span>tm_mon<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>     <span class="token comment">// 月份 [0, 11]</span>
  <span class="token punctuation">.</span>tm_mday<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">,</span>   <span class="token comment">// 天数 [1, 31]</span>
  <span class="token punctuation">.</span>tm_hour<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">,</span>   <span class="token comment">// 小时 [0, 23]</span>
  <span class="token punctuation">.</span>tm_min<span class="token operator">=</span><span class="token number">00</span><span class="token punctuation">,</span>    <span class="token comment">// 分钟 [0, 59]</span>
  <span class="token punctuation">.</span>tm_sec<span class="token operator">=</span><span class="token number">04</span><span class="token punctuation">,</span>    <span class="token comment">// 秒数 [0, 60]</span>
  <span class="token punctuation">.</span>tm_isdst<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment">// 夏令时</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    
time_t some_time_epoch<span class="token punctuation">;</span>
some_time_epoch <span class="token operator">=</span> <span class="token function">mktime</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>some_time<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token comment">// 输出 Mon Apr 12 12:00:04 1982</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> <span class="token function">ctime</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>some_time_epoch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 输出 Is DST: 0</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Is DST: %d\n"</span><span class="token punctuation">,</span> some_time<span class="token punctuation">.</span>tm_isdst<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="difftime"><a href="#difftime" class="headerlink" title="difftime()"></a>difftime()</h2><p><code>difftime()</code>用来计算两个时间之间的差异。Unix 系统上，直接相减两个 time_t 值，就可以得到相差的秒数，但是为了程序的可移植性，最好还是使用这个函数。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">double</span> <span class="token function">difftime</span><span class="token punctuation">(</span> time_t time1<span class="token punctuation">,</span> time_t time2 <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><code>difftime()</code>函数接受两个 time_t 类型的时间作为参数，计算 time1 - time2 的差，并把结果转换为秒。</p>
<p>注意它的返回值是 double 类型。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;time.h></span></span>
    
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">struct</span> <span class="token class-name">tm</span> time_a <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token punctuation">.</span>tm_year<span class="token operator">=</span><span class="token number">82</span><span class="token punctuation">,</span> 
    <span class="token punctuation">.</span>tm_mon<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>   
    <span class="token punctuation">.</span>tm_mday<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">,</span> 
    <span class="token punctuation">.</span>tm_hour<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>  
    <span class="token punctuation">.</span>tm_min<span class="token operator">=</span><span class="token number">00</span><span class="token punctuation">,</span>  
    <span class="token punctuation">.</span>tm_sec<span class="token operator">=</span><span class="token number">04</span><span class="token punctuation">,</span>  
    <span class="token punctuation">.</span>tm_isdst<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    
  <span class="token keyword">struct</span> <span class="token class-name">tm</span> time_b <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token punctuation">.</span>tm_year<span class="token operator">=</span><span class="token number">120</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span>tm_mon<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>  
    <span class="token punctuation">.</span>tm_mday<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">,</span> 
    <span class="token punctuation">.</span>tm_hour<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span> 
    <span class="token punctuation">.</span>tm_min<span class="token operator">=</span><span class="token number">27</span><span class="token punctuation">,</span>  
    <span class="token punctuation">.</span>tm_sec<span class="token operator">=</span><span class="token number">00</span><span class="token punctuation">,</span>  
    <span class="token punctuation">.</span>tm_isdst<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    
  time_t cal_a <span class="token operator">=</span> <span class="token function">mktime</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>time_a<span class="token punctuation">)</span><span class="token punctuation">;</span>
  time_t cal_b <span class="token operator">=</span> <span class="token function">mktime</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>time_b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
  <span class="token keyword">double</span> diff <span class="token operator">=</span> <span class="token function">difftime</span><span class="token punctuation">(</span>cal_b<span class="token punctuation">,</span> cal_a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
  <span class="token keyword">double</span> years <span class="token operator">=</span> diff <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">/</span> <span class="token number">24</span> <span class="token operator">/</span> <span class="token number">365.2425</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 输出 1217996816.000000 seconds (38.596783 years) between events</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%f seconds (%f years) between events\n"</span><span class="token punctuation">,</span> diff<span class="token punctuation">,</span> years<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面示例中，折算年份时，为了尽量准确，使用了一年的准确长度 365.2425 天，这样可以抵消闰年的影响。</p>
<h2 id="strftime"><a href="#strftime" class="headerlink" title="strftime()"></a>strftime()</h2><p><code>strftime()</code>函数用来将 struct tm 结构转换为一个指定格式的字符串，并复制到指定地址。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">size_t <span class="token function">strftime</span><span class="token punctuation">(</span>
  <span class="token keyword">char</span><span class="token operator">*</span> str<span class="token punctuation">,</span> 
  size_t maxsize<span class="token punctuation">,</span> 
  <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> format<span class="token punctuation">,</span> 
  <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">tm</span><span class="token operator">*</span> timeptr
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>strftime()</code>接受四个参数。</p>
<ul>
<li>第一个参数：目标字符串的指针。</li>
<li>第二个参数：目标字符串可以接受的最大长度。</li>
<li>第三个参数：格式字符串。</li>
<li>第四个参数：struct tm 结构。</li>
</ul>
<p>如果执行成功（转换并复制），<code>strftime()</code>函数返回复制的字符串长度；如果执行失败，返回<code>-1</code>。</p>
<p>下面是一个例子。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;time.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">char</span> s<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  time_t now <span class="token operator">=</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// %c: 本地时间</span>
  <span class="token function">strftime</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token keyword">sizeof</span> s<span class="token punctuation">,</span> <span class="token string">"%c"</span><span class="token punctuation">,</span> <span class="token function">localtime</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>now<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Sun Feb 28 22:29:00 2021</span>

  <span class="token comment">// %A: 完整的星期日期的名称</span>
  <span class="token comment">// %B: 完整的月份名称</span>
  <span class="token comment">// %d: 月份的天数</span>
  <span class="token function">strftime</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token keyword">sizeof</span> s<span class="token punctuation">,</span> <span class="token string">"%A, %B %d"</span><span class="token punctuation">,</span> <span class="token function">localtime</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>now<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Sunday, February 28</span>

  <span class="token comment">// %I: 小时（12小时制）</span>
  <span class="token comment">// %M: 分钟</span>
  <span class="token comment">// %S: 秒数</span>
  <span class="token comment">// %p: AM 或 PM</span>
  <span class="token function">strftime</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token keyword">sizeof</span> s<span class="token punctuation">,</span> <span class="token string">"It's %I:%M:%S %p"</span><span class="token punctuation">,</span> <span class="token function">localtime</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>now<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// It's 10:29:00 PM</span>

  <span class="token comment">// %F: ISO 8601 yyyy-mm-dd 格式</span>
  <span class="token comment">// %T: ISO 8601 hh:mm:ss 格式</span>
  <span class="token comment">// %z: ISO 8601 时区</span>
  <span class="token function">strftime</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token keyword">sizeof</span> s<span class="token punctuation">,</span> <span class="token string">"ISO 8601: %FT%T%z"</span><span class="token punctuation">,</span> <span class="token function">localtime</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>now<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// ISO 8601: 2021-02-28T22:29:00-0800</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>下面是常用的格式占位符。</p>
<ul>
<li>%%：输出 % 字符。</li>
<li>%a：星期几的简写形式，以当地时间计算。</li>
<li>%A：星期几的完整形式，以当地时间计算。</li>
<li>%b：月份的简写形式，以当地时间计算。</li>
<li>%B：月份的完整形式，以当地时间计算。</li>
<li>%c：日期和时间，使用“%x %X”。</li>
<li>%d：月份的天数（01-31）。</li>
<li>%H：小时，采用24小时制（00-23）。</li>
<li>%I：小时，采用12小时制（00-12）。</li>
<li>%J：一年的第几天（001-366）。</li>
<li>%m：月数（01-12）。</li>
<li>%M：分钟（00～59）。</li>
<li>%P：AM 或 PM。</li>
<li>%R：相当于”%H:%M”。</li>
<li>%S：秒（00-61）。</li>
<li>%U：一年的第几星期（00-53），以星期日为第1天。</li>
<li>%w：一星期的第几天，星期日为第0天。</li>
<li>%W：一年的第几星期(00-53)，以星期一为第1天。</li>
<li>%x：完整的年月日的日期，以当地时间计算。</li>
<li>%X：完整的时分秒的时间，以当地时间计算。</li>
<li>%y：两位数年份（00-99）。</li>
<li>%Y：四位数年份（例如 1984）。</li>
<li>%Z：时区的简写。</li>
</ul>
<h2 id="timespec-get"><a href="#timespec-get" class="headerlink" title="timespec_get()"></a>timespec_get()</h2><p><code>timespec_get()</code>用来将当前时间转成距离时间纪元的纳秒数（十亿分之一秒）。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">timespec_get</span> <span class="token punctuation">(</span> <span class="token keyword">struct</span> <span class="token class-name">timespec</span><span class="token operator">*</span> ts<span class="token punctuation">,</span> <span class="token keyword">int</span> base <span class="token punctuation">)</span> <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><code>timespec_get()</code>接受两个参数。</p>
<p>第一个参数是 struct timespec 结构指针，用来保存转换后的时间信息。struct timespec 的结构如下。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">timespec</span> <span class="token punctuation">&#123;</span>
  time_t tv_sec<span class="token punctuation">;</span>   <span class="token comment">// 秒数</span>
  <span class="token keyword">long</span>   tv_nsec<span class="token punctuation">;</span>  <span class="token comment">// 纳秒</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>第二个参数是一个整数，表示时间计算的起点。标准只给出了宏 TIME_UTC 这一个可能的值，表示返回距离时间纪元的秒数。</p>
<p>下面是一个例子。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">timespec</span> ts<span class="token punctuation">;</span>
    
<span class="token function">timespec_get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ts<span class="token punctuation">,</span> TIME_UTC<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token comment">// 1614581530 s, 806325800 ns</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%ld s, %ld ns\n"</span><span class="token punctuation">,</span> ts<span class="token punctuation">.</span>tv_sec<span class="token punctuation">,</span> ts<span class="token punctuation">.</span>tv_nsec<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token keyword">double</span> float_time <span class="token operator">=</span> ts<span class="token punctuation">.</span>tv_sec <span class="token operator">+</span> ts<span class="token punctuation">.</span>tv_nsec<span class="token operator">/</span><span class="token number">1000000000.0</span><span class="token punctuation">;</span>

<span class="token comment">// 1614581530.806326 seconds since epoch</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%f seconds since epoch\n"</span><span class="token punctuation">,</span> float_time<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="clock"><a href="#clock" class="headerlink" title="clock()"></a>clock()</h2><p><code>clock()</code>函数返回从程序开始执行到当前的 CPU 时钟周期。一个时钟周期等于 CPU 频率的倒数，比如 CPU 的频率如果是 1G Hz，表示1秒内时钟信号可以变化 10^9 次，那么每个时钟周期就是 10^-9 秒。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">clock_t　<span class="token function">clock</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><code>clock()</code>函数返回一个数字，表示从程序开始到现在的 CPU 时钟周期的次数。这个值的类型是 clock_t，一般是 long int 类型。 </p>
<p>为了把这个值转换为秒，应该把它除以常量<code>CLOCKS_PER_SEC</code>（每秒的时钟周期），这个常量也由<code>time.h</code>定义。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"CPU time: %f\n"</span><span class="token punctuation">,</span> <span class="token function">clock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>CLOCKS_PER_SEC<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>上面示例可以输出程序从开始到运行到这一行所花费的秒数。</p>
<p>如果计算机无法提供 CPU 时间，或者返回值太大，无法用<code>clock_t</code>类型表示，<code>clock()</code>函数就返回<code>-1</code>。</p>
<p>为了知道某个操作所耗费的精确时间，需要调用两次<code>clock()</code>，然后将两次的返回值相减。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">clock_t start <span class="token operator">=</span> <span class="token function">clock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ... 执行某些操作</span>

clock_t end <span class="token operator">=</span> <span class="token function">clock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">long</span> <span class="token keyword">double</span> seconds <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span> <span class="token operator">/</span> CLOCKS_PER_SEC<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul>
<li><a target="_blank" rel="noopener" href="https://serhack.me/articles/measure-execution-time-program/">How to Measure Execution Time of a Program</a></li>
</ul>
<h1 id="wchar-h"><a href="#wchar-h" class="headerlink" title="wchar.h"></a>wchar.h</h1><p>宽字符使用两个或四个字节表示一个字符，导致 C 语言常规的字符处理函数都会失效。wchar.h 定义了许多宽字符专用的处理函数。</p>
<h2 id="类型别名和宏-1"><a href="#类型别名和宏-1" class="headerlink" title="类型别名和宏"></a>类型别名和宏</h2><p>wchar.h 定义了一个类型别名 wint_t，表示宽字符对应整数值。</p>
<p>wchar.h 还定义了一个宏 WEOF，表示文件结束字符 EOF 的宽字符版。</p>
<h2 id="btowc-，wctob"><a href="#btowc-，wctob" class="headerlink" title="btowc()，wctob()"></a>btowc()，wctob()</h2><p><code>btowc()</code>将单字节字符转换为宽字符，<code>wctob()</code>将宽字符转换为单字节字符。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">wint_t <span class="token function">btowc</span><span class="token punctuation">(</span><span class="token keyword">int</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">wctob</span><span class="token punctuation">(</span>wint_t c<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><code>btowc()</code>返回一个宽字符。如果参数是 EOF，或转换失败，则返回 WEOF。</p>
<p><code>wctob()</code>返回一个单字节字符。如果参数是 WEOF，或者参数宽字符无法对应单个的单字节字符，则返回 EOF。</p>
<p>下面是用法示例。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">wint_t wc <span class="token operator">=</span> <span class="token function">btowc</span><span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token comment">// 输出宽字符 B</span>
<span class="token function">wprintf</span><span class="token punctuation">(</span>L<span class="token string">"Wide character: %lc\n"</span><span class="token punctuation">,</span> wc<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">unsigned</span> <span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token function">wctob</span><span class="token punctuation">(</span>wc<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 输出单字节字符 B</span>
<span class="token function">wprintf</span><span class="token punctuation">(</span>L<span class="token string">"Single-byte character: %c\n"</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="fwide"><a href="#fwide" class="headerlink" title="fwide()"></a>fwide()</h2><p><code>fwide()</code>用来设置一个字节流是宽字符流，还是多字节字符流。</p>
<p>如果使用宽字符专用函数处理字节流，就会默认设置字节流为宽字符流，否则就需要使用<code>fwide()</code>显式设置。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">fwide</span><span class="token punctuation">(</span>FILE<span class="token operator">*</span> stream<span class="token punctuation">,</span> <span class="token keyword">int</span> mode<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>它接受两个参数，第一个参数是文件指针，第二个参数是字节流模式，有三种选择。</p>
<ul>
<li>0：字节流模式保持原样。</li>
<li>-1（或其他负值）：设为多字节字符流。</li>
<li>1（或其他正值）：设为宽字符流。</li>
</ul>
<p><code>fwide()</code>的返回值也分成三种情况：如果是宽字符流，返回一个正值；如果是多字节字符流，返回一个负值；如果是普通字符流，返回<code>0</code>。</p>
<p>一旦设置了字节流模式，就无法再更改。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;wchar.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">wprintf</span><span class="token punctuation">(</span>L<span class="token string">"Hello world!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> mode <span class="token operator">=</span> <span class="token function">fwide</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">wprintf</span><span class="token punctuation">(</span>L<span class="token string">"Stream is %ls-oriented\n"</span><span class="token punctuation">,</span> mode <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> L<span class="token string">"byte"</span> <span class="token operator">:</span> L<span class="token string">"wide"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面示例中，<code>wprintf()</code>将字节流隐式设为宽字符模式，所以<code>fwide(stdout, 0)</code>的返回值大于零。</p>
<h2 id="宽字符专用函数"><a href="#宽字符专用函数" class="headerlink" title="宽字符专用函数"></a>宽字符专用函数</h2><p>下面这些函数基本都是 stdio.h 里面的字符处理函数的宽字符版本，必须使用这些函数来操作宽字符。</p>
<ul>
<li>fgetwc()    从宽字符流中获取宽字符，对应 fgetc()。</li>
<li>fgetws()    从宽字符流中读取宽字符串，对应 fgets()。</li>
<li>fputwc()    将宽字符写入宽字符流，对应 fputc()。</li>
<li>fputws()    将宽字符串写入宽字符流，对应 fputs()。</li>
<li>fwprintf()    格式化宽输出到宽字符流，对应 fprintf()。</li>
<li>fwscanf()    来自宽字符流的格式化宽字符输入，对应 fscanf()。</li>
<li>getwchar()    从 stdin 获取一个宽字符，对应 getchar()。</li>
<li>getwc()    从 stdin 获取一个宽字符，对应 getc()。</li>
<li>putwchar()    写一个宽字符到 stdout，对应 putchar()。</li>
<li>putwc()    写一个宽字符到 stdout，对应 putc()。</li>
<li>swprintf()    格式化宽输出到宽字符串，对应 sprintf()。</li>
<li>swscanf()    来自宽字符串的格式化宽输入，对应 sscanf()。</li>
<li>ungetwc()    将宽字符推回输入流，对应 ungetc()。</li>
<li>vfwprintf()    可变参数的格式化宽字符输出到宽字符流，对应 vfprintf()。</li>
<li>vfwscanf()    来自宽字符流的可变参数格式化宽字符输入，对应 vfscanf()。</li>
<li>vswprintf()    可变参数的格式化宽字符输出到宽字符串，对应 vswprintf()。</li>
<li>vswscanf()    来自宽字符串的可变参数格式化宽字符输入，对应 vsscanf()。</li>
<li>vwprintf()    可变参数格式化宽字符输出，对应 vprintf()。</li>
<li>vwscanf()    可变参数的格式化宽字符输入，对应 vscanf()。</li>
<li>wcscat()    危险地连接宽字符串，对应 strcat()。</li>
<li>wcschr()    在宽字符串中查找宽字符，对应 strchr()。</li>
<li>wcscmp()    比较宽字符串，对应 strcmp()。</li>
<li>wcscoll()    比较两个考虑语言环境的宽字符串，对应 strcoll()。</li>
<li>wcscpy()    危险地复制宽字符串，对应 strcpy()。</li>
<li>wcscspn()    不是从宽字符串前面开始计算字符，对应 strcspn()。</li>
<li>wcsftime()    格式化的日期和时间输出，对应 strftime()。</li>
<li>wcslen()    返回宽字符串的长度，对应 strlen()。</li>
<li>wcsncat()    更安全地连接宽字符串，对应 strncat()。</li>
<li>wcsncmp()    比较宽字符串，长度有限，对应 strncmp()。</li>
<li>wcsncpy()    更安全地复制宽字符串，对应 strncpy()。</li>
<li>wcspbrk()    在宽字符串中搜索一组宽字符中的一个，对应 strpbrk()。</li>
<li>wcsrchr()    从末尾开始在宽字符串中查找宽字符，对应 strrchr()。</li>
<li>wcsspn()    从宽字符串前面的集合中计算字符，对应 strspn()。</li>
<li>wcsstr()    在另一个宽字符串中找到一个宽字符串，对应 strstr()。</li>
<li>wcstod()    将宽字符串转换为 double，对应 strtod()。</li>
<li>wcstof()    将宽字符串转换为 float，对应 strtof()。</li>
<li>wcstok()    标记一个宽字符串，对应 strtok()。</li>
<li>wcstold()    将宽字符串转换为 long double，对应 strtold()。</li>
<li>wcstoll()    将宽字符串转换为 long long，对应 strtoll()。</li>
<li>wcstol()    将宽字符串转换为 long，对应 strtol()。</li>
<li>wcstoull()    将宽字符串转换为 unsigned long long，对应 strtoull()。</li>
<li>wcstoul()    将宽字符串转换为 unsigned long，对应 strtoul()。</li>
<li>wcsxfrm()    转换宽字符串以根据语言环境进行比较，对应 strxfrm()。</li>
<li>wmemcmp()    比较内存中的宽字符，对应 memcmp()。</li>
<li>wmemcpy()    复制宽字符内存，对应 memcpy()。</li>
<li>wmemmove()    复制宽字符内存，可能重叠，对应 memmove()。</li>
<li>wprintf()    格式化宽输出，对应 printf()。</li>
<li>wscanf()    格式化宽输入，对应 scanf()。</li>
</ul>
<h2 id="多字节字符专用函数"><a href="#多字节字符专用函数" class="headerlink" title="多字节字符专用函数"></a>多字节字符专用函数</h2><p>wchar.h 也定义了一些多字节字符的专用函数。</p>
<ul>
<li>mbsinit() 判断 mbstate_t 是否处于初始转换状态。</li>
<li>mbrlen()    给定转换状态时，计算多字节字符串的字节数，对应 mblen()。</li>
<li>mbrtowc()    给定转换状态时，将多字节字符转换为宽字符，对应 mbtowc()。</li>
<li>wctombr()    给定转换状态时，将宽字符转换为多字节字符，对应 wctomb()。</li>
<li>mbsrtowcs()    给定转换状态时，将多字节字符串转换为宽字符串，对应 mbstowcs()。</li>
<li>wcsrtombs() 给定转换状态时，将宽字符串转换为多字节字符串，对应 wcstombs()。</li>
</ul>
<h1 id="wctype-h"><a href="#wctype-h" class="headerlink" title="wctype.h"></a>wctype.h</h1><p>wctype.h 提供 ctype.h 里面函数的宽字符版本。</p>
<h2 id="宽字符类型判断函数"><a href="#宽字符类型判断函数" class="headerlink" title="宽字符类型判断函数"></a>宽字符类型判断函数</h2><p>下面函数判断宽字符的类型。</p>
<ul>
<li>iswalnum()    测试宽字符是否为字母数字</li>
<li>iswalpha()    测试宽字符是否为字母</li>
<li>iswblank()    测试这是否是一个宽空白字符</li>
<li>iswcntrl()    测试这是否是一个宽控制字符。</li>
<li>iswdigit()    测试这个宽字符是否是数字</li>
<li>iswgraph()    测试宽字符是否是可打印的非空格字符</li>
<li>iswlower()    测试宽字符是否为小写</li>
<li>iswprint()    测试宽字符是否可打印</li>
<li>iswpunct()    测试宽字符是否为标点符号</li>
<li>iswspace()    测试宽字符是否为空格</li>
<li>iswupper()    测试宽字符是否为大写</li>
<li>iswxdigit()    测试宽字符是否为十六进制数字</li>
</ul>
<h2 id="wctype-，iswctype"><a href="#wctype-，iswctype" class="headerlink" title="wctype()，iswctype()"></a>wctype()，iswctype()</h2><p><code>iswctype()</code>是上一节各种宽字符类型判断函数的通用版本，必须与<code>wctype()</code>配合使用。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">iswctype</span><span class="token punctuation">(</span>wint_t wc<span class="token punctuation">,</span> wctype_t desc<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><code>iswctype()</code>接受两个参数，第一个参数是一个需要判断类型的宽字符，第二个参数是宽字符类型描述，来自<code>wctype()</code>的返回值。</p>
<p>如果宽字符属于指定类型，<code>iswctype()</code>返回一个非零值，否则返回零。</p>
<p><code>wctype()</code>用来获取某个种类宽字符的类型描述。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">wctype_t <span class="token function">wctype</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> property<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><code>wctype()</code>的参数是一个给定的字符串，可用的值如下：alnum、alpha、blank、cntrl、digit、graph、lower、print、punct、space、upper、xdigit。</p>
<p><code>wctype()</code>的返回值的类型为 wctype_t，通常是一个整数。如果参数是一个无效值，则返回<code>0</code>。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">iswctype</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token function">wctype</span><span class="token punctuation">(</span><span class="token string">"digit"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 相当于</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">iswdigit</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>上面示例用来判断宽字符<code>c</code>是否为数值，相当于<code>iswdigit()</code>。</p>
<p><code>iswctype()</code>的完整类型判断如下。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">iswctype</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token function">wctype</span><span class="token punctuation">(</span><span class="token string">"alnum"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>	<span class="token comment">// 相当于 iswalnum(c)</span>
<span class="token function">iswctype</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token function">wctype</span><span class="token punctuation">(</span><span class="token string">"alpha"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>	<span class="token comment">// 相当于 iswalpha(c)</span>
<span class="token function">iswctype</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token function">wctype</span><span class="token punctuation">(</span><span class="token string">"blank"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>	<span class="token comment">// 相当于 iswblank(c)</span>
<span class="token function">iswctype</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token function">wctype</span><span class="token punctuation">(</span><span class="token string">"cntrl"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>	<span class="token comment">// 相当于 iswcntrl(c)</span>
<span class="token function">iswctype</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token function">wctype</span><span class="token punctuation">(</span><span class="token string">"digit"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>	<span class="token comment">// 相当于 iswdigit(c)</span>
<span class="token function">iswctype</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token function">wctype</span><span class="token punctuation">(</span><span class="token string">"graph"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>	<span class="token comment">// 相当于 iswgraph(c)</span>
<span class="token function">iswctype</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token function">wctype</span><span class="token punctuation">(</span><span class="token string">"lower"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>	<span class="token comment">// 相当于 iswlower(c)</span>
<span class="token function">iswctype</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token function">wctype</span><span class="token punctuation">(</span><span class="token string">"print"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>	<span class="token comment">// 相当于 iswprint(c)</span>
<span class="token function">iswctype</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token function">wctype</span><span class="token punctuation">(</span><span class="token string">"punct"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>	<span class="token comment">// 相当于 iswpunct(c)</span>
<span class="token function">iswctype</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token function">wctype</span><span class="token punctuation">(</span><span class="token string">"space"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>	<span class="token comment">// 相当于 iswspace(c)</span>
<span class="token function">iswctype</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token function">wctype</span><span class="token punctuation">(</span><span class="token string">"upper"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>	<span class="token comment">// 相当于 iswupper(c)</span>
<span class="token function">iswctype</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token function">wctype</span><span class="token punctuation">(</span><span class="token string">"xdigit"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>	<span class="token comment">// 相当于 iswxdigit(c)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="大小写转换函数"><a href="#大小写转换函数" class="headerlink" title="大小写转换函数"></a>大小写转换函数</h2><p>wctype.h 提供以下宽字符大小写转换函数。</p>
<ul>
<li>towlower()    将大写宽字符转换为小写</li>
<li>towupper()    将小写宽字符转换为大写</li>
<li>towctrans()    宽字符大小写转换的通用函数</li>
<li>wctrans()    大小写转换的辅助函数，配合 towctrans() 使用</li>
</ul>
<p>先看<code>towlower()</code>和<code>towupper()</code>的用法示例。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">towlower</span><span class="token punctuation">(</span>L<span class="token string">'B'</span><span class="token punctuation">)</span> <span class="token comment">// b</span>
<span class="token function">towupper</span><span class="token punctuation">(</span>L<span class="token string">'e'</span><span class="token punctuation">)</span> <span class="token comment">// E</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><code>towctrans()</code>和<code>wctrans()</code>的原型如下。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">wint_t <span class="token function">towctrans</span><span class="token punctuation">(</span>wint_t wc<span class="token punctuation">,</span> wctrans_t desc<span class="token punctuation">)</span><span class="token punctuation">;</span>
wctrans_t <span class="token function">wctrans</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> property<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>下面是它们的用法示例。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">towctrans</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token function">wctrans</span><span class="token punctuation">(</span><span class="token string">"toupper"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>	<span class="token comment">// 相当于 towupper(c)</span>
<span class="token function">towctrans</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token function">wctrans</span><span class="token punctuation">(</span><span class="token string">"tolower"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>	<span class="token comment">// 相当于 towlower(c)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="followme">
  <span>欢迎关注我的其它发布渠道</span>

  <div class="social-list">

      <div class="social-item">
        <a target="_blank" class="social-link" href="https://twitter.com/zheyizhifeng">
          <span class="icon">
            <i class="fab fa-twitter"></i>
          </span>

          <span class="label">Twitter</span>
        </a>
      </div>

      <div class="social-item">
        <a target="_blank" class="social-link" href="https://t.me/zheyizhifeng">
          <span class="icon">
            <i class="fab fa-telegram"></i>
          </span>

          <span class="label">Telegram</span>
        </a>
      </div>

      <div class="social-item">
        <a target="_blank" class="social-link" href="/images/wechat.jpg">
          <span class="icon">
            <i class="fab fa-weixin"></i>
          </span>

          <span class="label">WeChat</span>
        </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/Programming/" rel="tag"><i class="fa fa-tag"></i> Programming</a>
              <a href="/tags/C-%E8%AF%AD%E8%A8%80/" rel="tag"><i class="fa fa-tag"></i> C 语言</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/10/11/C%20%E8%AF%AD%E8%A8%80%E6%95%99%E7%A8%8B/" rel="prev" title="C 语言——教程 && 自查文档">
                  <i class="fa fa-chevron-left"></i> C 语言——教程 && 自查文档
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/10/12/SSH%20%E6%95%99%E7%A8%8B/" rel="next" title="SSH 教程">
                  SSH 教程 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lucida</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div><script color="0,0,255" opacity="0.5" zIndex="-1" count="99" src="https://cdn.jsdelivr.net/npm/canvas-nest.js@1/dist/canvas-nest.js"></script>

    </div>
  </footer>

  
  <script size="300" alpha="0.6" zIndex="-1" src="https://cdn.jsdelivr.net/npm/ribbon.js@1.0.2/dist/ribbon.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/pace.js"></script>

  





</body>
</html>
