<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)">
<meta name="generator" content="Hexo 5.1.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans+Simplified+Chinese:300,300italic,400,400italic,700,700italic%7CCousine:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/green/pace-theme-minimal.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"zheyizhifeng.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/db.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>
<meta name="description" content="文质彬彬，然后君子">
<meta property="og:type" content="website">
<meta property="og:title" content="Lucida&#39;s Blog">
<meta property="og:url" content="https://zheyizhifeng.github.io/index.html">
<meta property="og:site_name" content="Lucida&#39;s Blog">
<meta property="og:description" content="文质彬彬，然后君子">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="lucida">
<meta property="article:tag" content="Programing">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://zheyizhifeng.github.io/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Lucida's Blog</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Lucida's Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Stay Hungry, Stay Foolish</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">51</span></a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">21</span></a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">31</span></a></li>
        <li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="lucida"
      src="/images/avatar.jpeg">
  <p class="site-author-name" itemprop="name">lucida</p>
  <div class="site-description" itemprop="description">文质彬彬，然后君子</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">31</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">51</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/zheyizhifeng" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zheyizhifeng" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:zheyizhifeng@126.com" title="E-Mail → mailto:zheyizhifeng@126.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/zheyizhifeng" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;zheyizhifeng" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/zheyizhifeng" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;zheyizhifeng" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.facebook.com/zheyizhifeng" title="FB Page → https:&#x2F;&#x2F;www.facebook.com&#x2F;zheyizhifeng" rel="noopener" target="_blank"><i class="fab fa-facebook fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="skype:zheyizhifeng?call|chat" title="Skype → skype:zheyizhifeng?call|chat" rel="noopener" target="_blank"><i class="fab fa-skype fa-fw"></i></a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/zheyizhifeng" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zheyizhifeng.github.io/2022/07/14/H5%E5%B0%8F%E8%AF%B4%E9%98%85%E8%AF%BB%E5%99%A8%E4%B9%8B%E7%BF%BB%E9%A1%B5%E7%AF%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="lucida">
      <meta itemprop="description" content="文质彬彬，然后君子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucida's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/07/14/H5%E5%B0%8F%E8%AF%B4%E9%98%85%E8%AF%BB%E5%99%A8%E4%B9%8B%E7%BF%BB%E9%A1%B5%E7%AF%87/" class="post-title-link" itemprop="url">H5 小说阅读器-翻页篇</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-14 17:21:37" itemprop="dateCreated datePublished" datetime="2022-07-14T17:21:37+08:00">2022-07-14</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-11-11 13:35:42" itemprop="dateModified" datetime="2022-11-11T13:35:42+08:00">2022-11-11</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>参照客户端的众多小说阅读APP，实现类似的多种翻页效果。</p>
<h1 id="数据源格式"><a href="#数据源格式" class="headerlink" title="数据源格式"></a>数据源格式</h1><p><a target="_blank" rel="noopener" href="https://story-s.usicdn.com/sz2/fiction/b1034A/b_cRxWP.txt">某小说某章节内容</a></p>
<p>此处以服务端返回的HTML格式作为章节内容数据源，对其进行分页计算和渲染。</p>
<h1 id="常规分页方式"><a href="#常规分页方式" class="headerlink" title="常规分页方式"></a>常规分页方式</h1><p><img src="http://wimg.973.com/u/c/0308105618284.png" alt="全民小说怎么设置翻页全民小说设置翻页教程"></p>
<ul>
<li>纵向上下滚动翻页</li>
<li>横向仿真翻页</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/4756715-1f66a73fcab57ba4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/367/format/webp" alt="img"></p>
<ul>
<li>横向覆盖</li>
</ul>
<p><img src="http://wimg.973.com/u/c/0202105634738.png" alt="掌阅怎么设置翻页方式掌阅设置翻页方式方法"></p>
<ul>
<li>横向平移</li>
</ul>
<p><img src="http://wimg.973.com/u/c/0319153112128.png" alt="纵横小说怎么设置翻页模式纵横小说设置翻页模式教程"></p>
<ul>
<li><p>淡入淡出 [横向]</p>
<p>……</p>
</li>
</ul>
<h1 id="分页算法实现"><a href="#分页算法实现" class="headerlink" title="分页算法实现"></a>分页算法实现</h1><h2 id="纵向分页"><a href="#纵向分页" class="headerlink" title="纵向分页"></a>纵向分页</h2><p>纵向分页场景下实现无太大难度</p>
<ol>
<li><code>v-html </code> 或者 <code> dom.innerHTML</code> 直接展示章节内容。</li>
<li>监听纵向范围内上拉和下拉的事件，更新新的章节。</li>
</ol>
<h2 id="横向分页"><a href="#横向分页" class="headerlink" title="横向分页"></a>横向分页</h2><p>横向分页场景下通常需要对文本内容计算出每一页的内容，实际开发过程中也应用到了CSS columns【多列】的方案。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/EKEEcPV68BLHun7lqcQ_kQ">CSS columns</a></li>
</ul>
<blockquote>
<ul>
<li><p>一次性需要将所有内容全部排列并渲染，内容过多时会影响页面性能；****</p>
</li>
<li><p>分页不可人为控制，不方便扩展（在某一页后面增加广告页）；****</p>
</li>
<li><p>翻页只能支持滑动效果，并不能支持“覆盖”、“仿真翻页”效果。**</p>
</li>
</ul>
</blockquote>
<ul>
<li>文本计算<ul>
<li>粗暴的 line-height * font-size</li>
<li>频繁渲染的 <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_37306468/article/details/115862638?spm=1001.2101.3001.6650.14&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~default-14-115862638-blog-109504210.pc_relevant_multi_platform_whitelistv1">https://blog.csdn.net/qq_37306468/article/details/115862638?spm=1001.2101.3001.6650.14&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Edefault-14-115862638-blog-109504210.pc_relevant_multi_platform_whitelistv1</a></li>
</ul>
</li>
<li>Canvas measureText 方案</li>
</ul>
<p>从html =&gt; text</p>
<h1 id="分页效果实现"><a href="#分页效果实现" class="headerlink" title="分页效果实现"></a>分页效果实现</h1><ul>
<li>仿真翻页<ul>
<li><a target="_blank" rel="noopener" href="http://www.turnjs.com/">turn.js</a></li>
<li><a target="_blank" rel="noopener" href="https://nodlik.github.io/StPageFlip/">page-flip</a></li>
</ul>
</li>
<li>水平覆盖翻页<ul>
<li>swiper</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zheyizhifeng.github.io/2022/02/27/chrome%20extension%20with%20manifest%20V3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="lucida">
      <meta itemprop="description" content="文质彬彬，然后君子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucida's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/02/27/chrome%20extension%20with%20manifest%20V3/" class="post-title-link" itemprop="url">Chrome Extension With Manifest V3</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-02-27 17:21:37" itemprop="dateCreated datePublished" datetime="2022-02-27T17:21:37+08:00">2022-02-27</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-11-11 13:29:04" itemprop="dateModified" datetime="2022-11-11T13:29:04+08:00">2022-11-11</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Chrome/" itemprop="url" rel="index"><span itemprop="name">Chrome</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Chrome-Extension-With-Manifest-V3"><a href="#Chrome-Extension-With-Manifest-V3" class="headerlink" title="Chrome Extension With Manifest V3"></a>Chrome Extension With Manifest V3</h1><h2 id="What-Extension-Is"><a href="#What-Extension-Is" class="headerlink" title="What Extension Is"></a>What Extension Is</h2><blockquote>
<p> Extensions are software programs, built on web technologies (such as HTML, CSS, and JavaScript) that enable users to customize the Chrome browsing experience.</p>
<p> 扩展程序是基于 Web 技术（例如 HTML、CSS 和 JavaScript）构建的软件程序，可让用户自定义 Chrome 浏览体验。</p>
</blockquote>
<p>以上是对chrome extension的官方介绍，个人理解就是：</p>
<blockquote>
<p>Chrome Extension 是能通过『当前选项卡』『插件弹出页』『全局js脚本』『devtools信息』等合作通信去实现特定功能的后台程序。</p>
</blockquote>
<h2 id="What-Manifest-Is"><a href="#What-Manifest-Is" class="headerlink" title="What Manifest Is"></a>What Manifest Is</h2><h3 id="About-manifest-json"><a href="#About-manifest-json" class="headerlink" title="About manifest.json"></a>About manifest.json</h3><blockquote>
<p>Each extender needs to have a **configuration checklist <code>manifest.json</code> document **, which provides basic information about the extension, such as required permissions, names, versions, and so on.</p>
<p>每一个扩展程序都需要有一个<strong>配置清单 <code>manifest.json</code> 文档</strong>，它提供了关于扩展程序的基本信息，例如所需的权限、名称、版本等。</p>
</blockquote>
<pre class="line-numbers language-json" data-language="json"><code class="language-json">  <span class="token punctuation">&#123;</span>
  <span class="token comment">// Required - 通俗易懂</span>
  <span class="token property">"manifest_version"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"My Extension"</span><span class="token punctuation">,</span>
  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"versionString"</span><span class="token punctuation">,</span>

   <span class="token comment">// 『重点』action配置项主要用于点击图标弹出框，对于弹出框接受的是html文件</span>
  <span class="token property">"action"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
     <span class="token property">"default_title"</span><span class="token operator">:</span> <span class="token string">"Click to view a popup"</span><span class="token punctuation">,</span>
   	 <span class="token property">"default_popup"</span><span class="token operator">:</span> <span class="token string">"popup.html"</span>
   <span class="token punctuation">&#125;</span>
    
  <span class="token comment">// 通俗易懂</span>
  <span class="token property">"default_locale"</span><span class="token operator">:</span> <span class="token string">"en"</span><span class="token punctuation">,</span>
  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"A plain text description"</span><span class="token punctuation">,</span>
  <span class="token property">"icons"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>...<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"author"</span><span class="token operator">:</span> ...<span class="token punctuation">,</span>

  <span class="token comment">// 『重点』下面将出现的background.js 配置service work</span>
  <span class="token property">"background"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// Required</span>
    <span class="token property">"service_worker"</span><span class="token operator">:</span> <span class="token string">"service-worker.js"</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>

    <span class="token comment">// 『重点』下面将出现content_script.js 应用于所有页面上下文的js</span>
  <span class="token property">"content_scripts"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
     <span class="token punctuation">&#123;</span>
       <span class="token property">"matches"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"https://*.google.com/*"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token property">"css"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"my-styles.css"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token property">"js"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"content-script.js"</span><span class="token punctuation">]</span>
     <span class="token punctuation">&#125;</span>
   <span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token comment">// 使用/添加devtools中的功能</span>
  <span class="token property">"devtools_page"</span><span class="token operator">:</span> <span class="token string">"devtools.html"</span><span class="token punctuation">,</span>


    <span class="token comment">/**
    * 三个permission
    * host_permissions - 允许使用扩展的域名
    * permissions - 包含已知字符串列表中的项目 【只需一次弹框要求允许】
    * optional_permissions - 与常规类似permissions，但由扩展的用户在运行时授予，而不是提前授予【安全】
    * 列出常见选项
    * &#123;
    *		activeTab: 当扩展卡选项被改变需要重新获取新的权限
    *		tabs: 操作选项卡api（改变位置等）
    *		downloads: 访问chrome.downloads API 的权限 便于下载但还是会受到跨域影响
    *		history: history api权限
    *		storage: 访问localstorage/sessionStorage权限
    * &#125;
    */</span>
  <span class="token property">"host_permissions"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"http://*/*"</span><span class="token punctuation">,</span> <span class="token string">"https://*/*"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"permissions"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"tabs"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"optional_permissions"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"downloads"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token comment">// 内部弹出可选页面 - 见fehelper操作页</span>
  <span class="token property">"options_page"</span><span class="token operator">:</span> <span class="token string">"options.html"</span><span class="token punctuation">,</span>
  <span class="token property">"options_ui"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"chrome_style"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"page"</span><span class="token operator">:</span> <span class="token string">"options.html"</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Why-Not-Manifest-V2"><a href="#Why-Not-Manifest-V2" class="headerlink" title="Why Not Manifest V2"></a>Why Not Manifest V2</h3><p><strong>当前配置清单类型最新的版本是 Manifest V3，MV3</strong>，遵循该配置清单版本的扩展程序，会更注重安全和用户的隐私保护，在性能方面也会得到提升，同时开发简易性和功能实现也会更佳。</p>
<p><img src="https://cdn.jsdelivr.net/gh/zheyizhifeng/picture_repo/images/image-20220217175042667.png" alt="image-20220217175042667"></p>
<p><img src="https://static.careerengine.us/api/aov2/https%3A_%7C__%7C_mmbiz.qpic.cn_%7C_mmbiz_png_%7C_dkwuWwLoRK95qOVpY72zicpWwLAHwxKPr7SrWicJERd9iaQklkZ0DpCKG2GMHOzS3AhicmVIur4pbMrcH5mbgyQKtw_%7C_640%3Fwx_fmt%3Dpng" alt="img"></p>
<h2 id="Build-A-MV3-Hello-Extension"><a href="#Build-A-MV3-Hello-Extension" class="headerlink" title="Build A MV3 Hello Extension"></a>Build A MV3 Hello Extension</h2><p><a target="_blank" rel="noopener" href="https://github.com/GoogleChrome/chrome-extensions-samples/tree/main/examples/hello-world">https://github.com/GoogleChrome/chrome-extensions-samples/tree/main/examples/hello-world</a></p>
<h3 id="Project-Structure"><a href="#Project-Structure" class="headerlink" title="Project Structure"></a>Project Structure</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">--hello
  --hello.html // 插件界面
  --background.js // service_worker
  --manifest.json // 配置文件<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token comment">// manifest.json</span>

<span class="token punctuation">&#123;</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Hello, World!"</span><span class="token punctuation">,</span>
  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0"</span><span class="token punctuation">,</span>
  <span class="token property">"manifest_version"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token property">"background"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"service_worker"</span><span class="token operator">:</span> <span class="token string">"background.js"</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"action"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// background.js</span>

chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>onInstalled<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> url <span class="token operator">=</span> chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token function">getURL</span><span class="token punctuation">(</span><span class="token string">'hello.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> tab <span class="token operator">=</span> <span class="token keyword">await</span> chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> url <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Created tab </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>tab<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token comment">&lt;!-- hello.html --></span>

<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Hello, World!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Hello, World!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Install-Run-Hello-Extension"><a href="#Install-Run-Hello-Extension" class="headerlink" title="Install / Run Hello Extension"></a>Install / Run Hello Extension</h3><p><img src="https://cdn.jsdelivr.net/gh/zheyizhifeng/picture_repo/images/image-20220217183003834.png" alt="image-20220217183003834"></p>
<p><img src="https://cdn.jsdelivr.net/gh/zheyizhifeng/picture_repo/images/image-20220217183440530.png" alt="image-20220217183440530"></p>
<blockquote>
<p>新版 Chrome 不再支持 <code>.crx</code> 形式的扩展程序，可以安装，但无法启用。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/zheyizhifeng/picture_repo/images/image-20220217184100318.png" alt="image-20220217184100318"></p>
<p><img src="https://cdn.jsdelivr.net/gh/zheyizhifeng/picture_repo/images/image-20220217184118220.png" alt="image-20220217184118220"></p>
<h3 id="Debug-Extension"><a href="#Debug-Extension" class="headerlink" title="Debug Extension"></a>Debug Extension</h3><p><img src="https://cdn.jsdelivr.net/gh/zheyizhifeng/picture_repo/images/image-20220217202754281.png" alt="image-20220217202754281"></p>
<h2 id="More-Extension"><a href="#More-Extension" class="headerlink" title="More Extension"></a>More Extension</h2><h3 id="page-render"><a href="#page-render" class="headerlink" title="page-render"></a>page-render</h3><p><a target="_blank" rel="noopener" href="https://github.com/GoogleChrome/chrome-extensions-samples/tree/main/examples/page-redder">https://github.com/GoogleChrome/chrome-extensions-samples/tree/main/examples/page-redder</a></p>
<h3 id="bookmarks"><a href="#bookmarks" class="headerlink" title="bookmarks"></a>bookmarks</h3><p><a target="_blank" rel="noopener" href="https://github.com/GoogleChrome/chrome-extensions-samples/tree/main/examples/bookmarks">https://github.com/GoogleChrome/chrome-extensions-samples/tree/main/examples/bookmarks</a></p>
<h2 id="Chrome-Extension-Basic-Composition"><a href="#Chrome-Extension-Basic-Composition" class="headerlink" title="Chrome Extension Basic Composition"></a>Chrome Extension Basic Composition</h2><p><img src="http://www.co-ding.com/assets/img/2019-10-18-chrome-1.png" alt="Keep coding, Keep thinking"></p>
<h3 id="service-worker-background-js"><a href="#service-worker-background-js" class="headerlink" title="service_worker(background.js)"></a>service_worker(background.js)</h3><blockquote>
<p>The <strong>background script</strong> is the extension’s event handler; it contains listeners for browser events that are important to the extension. It lies dormant until an event is fired then performs the instructed logic. An effective background script is only loaded when it is needed and unloaded when it goes idle.</p>
<p><strong>background script</strong>是扩展的事件处理程序; 它包含对扩展很重要的浏览器事件的侦听器。它处于休眠状态，直到触发事件，然后执行指示的逻辑。有效的后台脚本仅在需要时加载，并在空闲时卸载。</p>
</blockquote>
<p>要关注两点：</p>
<ul>
<li>不使用时终止，需要时重新启动（类似于事件页面）。</li>
<li>无权访问 DOM。（service worker 独立于页面）</li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>onMessage<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> tabId <span class="token operator">=</span> <span class="token function">getForegroundTabId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span>data <span class="token operator">===</span> <span class="token string">"setAlarm"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    chrome<span class="token punctuation">.</span>alarms<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>delayInMinutes<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span>data <span class="token operator">===</span> <span class="token string">"runLogic"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    chrome<span class="token punctuation">.</span>scripting<span class="token punctuation">.</span><span class="token function">executeScript</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>file<span class="token operator">:</span> <span class="token string">'logic.js'</span><span class="token punctuation">,</span> tabId<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span>data <span class="token operator">===</span> <span class="token string">"changeColor"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    chrome<span class="token punctuation">.</span>scripting<span class="token punctuation">.</span><span class="token function">executeScript</span><span class="token punctuation">(</span>
        <span class="token punctuation">&#123;</span><span class="token function-variable function">func</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundColor<span class="token operator">=</span><span class="token string">"orange"</span><span class="token punctuation">,</span> tabId<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="content-script"><a href="#content-script" class="headerlink" title="content_script"></a>content_script</h3><blockquote>
<p>Extensions that read or write to web pages utilize a <strong>content_script</strong>. The content script contains JavaScript that executes in the contexts of a page that has been loaded into the browser. Content scripts read and modify the DOM of web pages the browser visits.</p>
<p>Content scripts can communicate with their parent extension by exchanging <a href="https://link.juejin.cn/?target=https://developer.chrome.com/docs/extensions/mv3/messaging/">messages</a> and storing values using the <a href="https://link.juejin.cn/?target=https://developer.chrome.com/docs/extensions/reference/storage/">storage</a> API.</p>
<p>读取或写入网页的扩展程序使用 <strong>content_script</strong>。内容脚本包含在已加载到浏览器的页面上下文中执行的 JavaScript。内容脚本读取和修改浏览器访问的网页的 DOM。</p>
</blockquote>
<p><code>content_script</code>可以通过使用storage/message API来与扩展其他部分进行通信。</p>
<h4 id="注入方式"><a href="#注入方式" class="headerlink" title="注入方式"></a>注入方式</h4><ul>
<li><p>对于<code>manifest.json</code>来说</p>
<ul>
<li>可以配置静态声明去注入</li>
</ul>
</li>
<li><p>可以通过编程方式注入 需要获取<code>activeTab</code>权限</p>
</li>
</ul>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token comment">// manifest.json</span>
<span class="token punctuation">&#123;</span>
 <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"My extension"</span><span class="token punctuation">,</span>
 ...
 <span class="token property">"content_scripts"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
   <span class="token punctuation">&#123;</span>
     <span class="token comment">// 满足matches匹配的域名</span>
     <span class="token property">"matches"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"https://*.google.com/*"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
     <span class="token comment">// 注入css</span>
     <span class="token property">"css"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"my-styles.css"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
     <span class="token comment">// 注入js</span>
     <span class="token property">"js"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"content-script.js"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
     <span class="token property">"run_at"</span><span class="token operator">:</span> <span class="token string">"document_idle"</span> | <span class="token string">"document_start"</span> | <span class="token string">"document_end"</span>
   <span class="token punctuation">&#125;</span>
 <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"permissions"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"activeTab"</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>对于获取了权限的<code>content_script</code>通过代码执行注入</li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">chrome<span class="token punctuation">.</span>action<span class="token punctuation">.</span>onClicked<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">tab</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  chrome<span class="token punctuation">.</span>scripting<span class="token punctuation">.</span><span class="token function">executeScript</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    target<span class="token operator">:</span> <span class="token punctuation">&#123;</span> tabId<span class="token operator">:</span> tab<span class="token punctuation">.</span>id <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    files<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'content-script.js'</span><span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="popup"><a href="#popup" class="headerlink" title="popup"></a>popup</h3><p>运行于弹窗的html文件和JS脚本</p>
<p><img src="https://cdn.jsdelivr.net/gh/zheyizhifeng/picture_repo/images/image-20220217195734158.png" alt="image-20220217195734158"></p>
<h3 id="option"><a href="#option" class="headerlink" title="option"></a>option</h3><blockquote>
<p>Just as extensions allow users to customize the Chrome browser, the <a href="https://link.juejin.cn/?target=https://developer.chrome.com/docs/extensions/mv3/options/">options page</a> enables customization of the extension. Options can be used to enable features and allow users to choose what functionality is relevant to their needs.</p>
<p>正如扩展程序允许用户自定义 Chrome 浏览器一样，<a href="https://link.juejin.cn/?target=https://developer.chrome.com/docs/extensions/mv3/options/">选项页面</a>支持扩展程序的自定义。选项可用于启用功能并允许用户选择与其需求相关的功能。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/zheyizhifeng/picture_repo/images/image-20220217200117586.png" alt="image-20220217200117586"></p>
<h3 id="devtools"><a href="#devtools" class="headerlink" title="devtools"></a>devtools</h3><blockquote>
<p> A DevTools extension is structured like any other extension: it can have a background page, content scripts, and other items. In addition, each DevTools extension has a DevTools page, which has access to the DevTools APIs.</p>
<p>DevTools 扩展的结构与任何其他扩展一样：它可以有一个背景页面、内容脚本和其他项目。此外，每个 DevTools 扩展都有一个 DevTools 页面，可以访问 DevTools API。</p>
</blockquote>
<p><img src="https://wd.imgix.net/image/BrQidfK9jaQyIHwdw91aVpkPiib2/kcLMpTY6qtez03TVSqt4.png?auto=format" alt="Extending DevTools - Chrome Developers"></p>
<p>每次打开 DevTools 窗口时，都会创建一个扩展的 DevTools 页面实例。DevTools 页面在 DevTools 窗口的整个生命周期内都存在。DevTools 页面可以访问 DevTools API 和一组有限的扩展 API。devtools 可以提供能力：</p>
<ul>
<li>能自定义添加新的Devtools panel</li>
<li>能嵌入自定义的页面到自定义的panel中</li>
<li><em>devtools中的 elements &amp; sources两个面板中</em></li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/zheyizhifeng/picture_repo/images/image-20220217200944834.png" alt="image-20220217200944834"></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/826e09b59b2647679eef9f7b42be652a~tplv-k3u1fbpfcp-watermark.awebp" alt="image-20211020151945359"></p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1932d450523c4b19972a820a00d920f4~tplv-k3u1fbpfcp-watermark.awebp" alt="2.png"></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">chrome<span class="token punctuation">.</span>devtools<span class="token punctuation">.</span>panels<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>
  <span class="token string">'🔨 Beyla'</span><span class="token punctuation">,</span>
  <span class="token string">'images/128x128.png'</span><span class="token punctuation">,</span>
  <span class="token string">'html/devtools.html'</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">panel</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// panel loaded</span>
    panel<span class="token punctuation">.</span>onShown<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>onPanelShown<span class="token punctuation">)</span><span class="token punctuation">;</span>
    panel<span class="token punctuation">.</span>onHidden<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>onPanelHidden<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// [devtools].js</span>
chrome<span class="token punctuation">.</span>devtools<span class="token punctuation">.</span>panels<span class="token punctuation">.</span>elements<span class="token punctuation">.</span><span class="token function">createSidebarPane</span><span class="token punctuation">(</span>
	<span class="token string">"element pannel"</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span><span class="token parameter">sidebar</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
		sidebar<span class="token punctuation">.</span><span class="token function">setExpression</span><span class="token punctuation">(</span><span class="token string">"(() => &#123;return &#123;a:1&#125;&#125;)()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

chrome<span class="token punctuation">.</span>devtools<span class="token punctuation">.</span>panels<span class="token punctuation">.</span>sources<span class="token punctuation">.</span><span class="token function">createSidebarPane</span><span class="token punctuation">(</span>
	<span class="token string">"sources pannel"</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span><span class="token parameter">sidebar</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
		sidebar<span class="token punctuation">.</span><span class="token function">setPage</span><span class="token punctuation">(</span><span class="token string">"sources.html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Basic-Composition-Communication"><a href="#Basic-Composition-Communication" class="headerlink" title="Basic Composition Communication"></a>Basic Composition Communication</h2><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f890ba9522574bbda5a0223e22b01c71~tplv-k3u1fbpfcp-watermark.awebp" alt="组件间关系图"></p>
<table>
<thead>
<tr>
<th>JS种类</th>
<th>可访问的API</th>
<th>DOM访问情况</th>
<th>JS访问情况</th>
<th>直接跨域</th>
</tr>
</thead>
<tbody><tr>
<td>injected script</td>
<td>和普通JS无任何差别，不能访问任何扩展API</td>
<td>可以访问</td>
<td>可以访问</td>
<td>不可以</td>
</tr>
<tr>
<td>content script</td>
<td>只能访问 extension、runtime等部分API</td>
<td>可以访问</td>
<td>不可以</td>
<td>不可以</td>
</tr>
<tr>
<td>popup js</td>
<td>可访问绝大部分API，除了devtools系列</td>
<td>不可直接访问</td>
<td>不可以</td>
<td>可以</td>
</tr>
<tr>
<td>background js</td>
<td>可访问绝大部分API，除了devtools系列</td>
<td>不可直接访问</td>
<td>不可以</td>
<td>可以</td>
</tr>
<tr>
<td>devtools js</td>
<td>只能访问 devtools、extension、runtime等部分API</td>
<td>可以访问devtools</td>
<td>可以访问devtools</td>
<td>不可以</td>
</tr>
</tbody></table>
<h3 id="content-script-amp-amp-service-worker-popup"><a href="#content-script-amp-amp-service-worker-popup" class="headerlink" title="content script &amp;&amp; service worker/popup"></a>content script &amp;&amp; service worker/popup</h3><p>和 <code>content script</code> 有关的通信</p>
<ul>
<li>使用 <code>chrome.runtime.sendMessage</code> 发送信息</li>
<li>使用 <code>chrome.runtime.onMessage.addListener </code> 接收监听信息</li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// -----[content script].js-----</span>
<span class="token comment">// 发送信息</span>
chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> beylaDetected<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// -----[service worker].js-----</span>
<span class="token comment">// 监听消息</span>
chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>onMessage<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> sender</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>sender<span class="token punctuation">.</span>tab <span class="token operator">&amp;&amp;</span> req<span class="token punctuation">.</span>beylaDetected<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    chrome<span class="token punctuation">.</span>action<span class="token punctuation">.</span><span class="token function">setIcon</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
      tabId<span class="token operator">:</span> sender<span class="token punctuation">.</span>tab<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
      path<span class="token operator">:</span> <span class="token string">'../images/128x128.png'</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    chrome<span class="token punctuation">.</span>action<span class="token punctuation">.</span><span class="token function">setPopup</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
      tabId<span class="token operator">:</span> sender<span class="token punctuation">.</span>tab<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
      popup<span class="token operator">:</span> <span class="token string">'html/beyla-enable.html'</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="popup-amp-amp-service-worker"><a href="#popup-amp-amp-service-worker" class="headerlink" title="popup &amp;&amp; service worker"></a>popup &amp;&amp; service worker</h3><blockquote>
<p>当只有一对一关系时，可使用万能的<code>chrome.runtime.sendMessage</code> &amp; <code>chrome.runtime.onMessage.addListener</code></p>
</blockquote>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// -----[popup].js-----</span>
document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"#button"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">const</span> val1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"#input1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">||</span> <span class="token string">"0"</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> val2 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"#input2"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">||</span> <span class="token string">"0"</span><span class="token punctuation">;</span>
	chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>val1<span class="token punctuation">,</span> val2<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
		document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"#ans"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> response<span class="token punctuation">.</span>res<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// -----[service worker].js-----</span>
<span class="token keyword">const</span> <span class="token function-variable function">dealwithBigNumber</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">val1<span class="token punctuation">,</span> val2</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">BigInt</span><span class="token punctuation">(</span>val1<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">BigInt</span><span class="token punctuation">(</span>val2<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">""</span><span class="token punctuation">;</span>
chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>onMessage<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> sender<span class="token punctuation">,</span> sendResponse</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">const</span> <span class="token punctuation">&#123;</span>val1<span class="token punctuation">,</span> val2<span class="token punctuation">&#125;</span> <span class="token operator">=</span> request<span class="token punctuation">;</span>
	<span class="token function">sendResponse</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>res<span class="token operator">:</span> <span class="token function">dealwithBigNumber</span><span class="token punctuation">(</span>val1<span class="token punctuation">,</span> val2<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="popup-amp-amp-content-script"><a href="#popup-amp-amp-content-script" class="headerlink" title="popup &amp;&amp; content script"></a>popup &amp;&amp; content script</h3><blockquote>
<p>本demo中引用了jquery，想看怎么操作的请看 <a href="https://link.juejin.cn/?target=https://github.com/caifeng123/chrome-extension">源码</a> ~~</p>
</blockquote>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// -----[content script].js-----</span>
<span class="token comment">// 接收popup数据并修改dom</span>
chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>onMessage<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> sender<span class="token punctuation">,</span> sendResponse</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
	<span class="token comment">// document.querySelector("body").style.setProperty("background", request.color);</span>
	<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"body"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">"background"</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">sendResponse</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>name<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// -----[popup].js-----</span>
<span class="token comment">// 获取当前tab标签</span>
<span class="token keyword">const</span> <span class="token function-variable function">getCurrentTab</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">let</span> queryOptions <span class="token operator">=</span> <span class="token punctuation">&#123;</span>active<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> currentWindow<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
	<span class="token keyword">let</span> <span class="token punctuation">[</span>tab<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>queryOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> tab<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#background"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">paigusu</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>color<span class="token operator">:</span> <span class="token string">"#1926dc"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> obj</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
	<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#info"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">"修改中"</span><span class="token punctuation">;</span>
	<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#show"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">"background"</span><span class="token punctuation">,</span> <span class="token string">"#"</span> <span class="token operator">+</span> obj<span class="token punctuation">.</span>hex<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> tab <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getCurrentTab</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">await</span> chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>tab<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>color<span class="token operator">:</span> <span class="token string">"#"</span> <span class="token operator">+</span> obj<span class="token punctuation">.</span>hex<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#info"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">"修改成功"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="devtools-amp-amp-content-script"><a href="#devtools-amp-amp-content-script" class="headerlink" title="devtools &amp;&amp; content script"></a>devtools &amp;&amp; content script</h3><blockquote>
<p>同1 content script与service worker/popup的通信</p>
</blockquote>
<p>​    1对多通信 使用chrome.tabs去找对应页面</p>
<h3 id="devtools-amp-amp-popup"><a href="#devtools-amp-amp-popup" class="headerlink" title="devtools &amp;&amp; popup"></a>devtools &amp;&amp; popup</h3><blockquote>
<p>同2  content script与service worker/popup的通信</p>
</blockquote>
<p>​    1对1通信 使用chrome.runtime</p>
<h2 id="Beyla-Chrome-Extension"><a href="#Beyla-Chrome-Extension" class="headerlink" title="Beyla Chrome Extension"></a>Beyla Chrome Extension</h2><p>Repo 参考 <a target="_blank" rel="noopener" href="https://gitlab.ushareit.me/web/fe-workflow/h5/beyla-chrome-extension.git">https://gitlab.ushareit.me/web/fe-workflow/h5/beyla-chrome-extension.git</a></p>
<h2 id="Recommend-Extension"><a href="#Recommend-Extension" class="headerlink" title="Recommend Extension"></a>Recommend Extension</h2><p><img src="https://cdn.jsdelivr.net/gh/zheyizhifeng/picture_repo/images/image-20220224214333026.png" alt="image-20220224214333026"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zheyizhifeng.github.io/2022/01/20/%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8B%E5%8F%91ES6%E4%BB%A3%E7%A0%81%E5%8F%AF%E8%A1%8C%E6%80%A7%E6%8E%A2%E7%A9%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="lucida">
      <meta itemprop="description" content="文质彬彬，然后君子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucida's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/01/20/%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8B%E5%8F%91ES6%E4%BB%A3%E7%A0%81%E5%8F%AF%E8%A1%8C%E6%80%A7%E6%8E%A2%E7%A9%B6/" class="post-title-link" itemprop="url">Webview 下发 ES 6 代码可行吗？</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-01-20 17:21:37" itemprop="dateCreated datePublished" datetime="2022-01-20T17:21:37+08:00">2022-01-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-11-11 13:28:24" itemprop="dateModified" datetime="2022-11-11T13:28:24+08:00">2022-11-11</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/JavaScript/ES6/" itemprop="url" rel="index"><span itemprop="name">ES6</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="客户端-Webview-下发-ES-6-代码可行性探究"><a href="#客户端-Webview-下发-ES-6-代码可行性探究" class="headerlink" title="客户端 Webview 下发 ES 6 代码可行性探究"></a>客户端 Webview 下发 ES 6 代码可行性探究</h1><h2 id="先聊聊历史"><a href="#先聊聊历史" class="headerlink" title="先聊聊历史"></a>先聊聊历史</h2><ul>
<li>1999 年12 月<br>ECMAScript 3 (ES 3)</li>
<li>2009 年12 月<br>ECMAScript 5 (ES 5)</li>
<li>2015 年6 月<br>ECMAScript 2015 (ES 6)</li>
<li>……ES 7、ES 8、ES 9</li>
</ul>
<h3 id="现状"><a href="#现状" class="headerlink" title="现状"></a>现状</h3><p>大部分前端开发人员热衷于使用新的 JavaScript 语言特性来书写 JS 代码，例如 async 、 await 、 classes 、 arrow functions 等。然而，尽管目前所有的前沿浏览器都能运行 ES2015+ 代码（ES2015及俗称的ES6），但是为了兼容占有小比例的低版本浏览器用户，大部分的开发者仍然使用 polyfills 将代码编译成 ES5 语法。</p>
<p>当下标准的做法是：写 ES6 代码 → 将所有代码编译成 ES5 的（比如通过 Babel）→ 再将编译后的代码加载到浏览器执行。</p>
<p>这可能已经不再是<strong>最有效率</strong>的方式了。因为用这种方式，我们强制最新的浏览器运行旧代码，实际上它们完全可以运行最新的代码。它们支持 ES6，我们难道不能直接给它们 ES6 代码吗？</p>
<p><strong><a href="(https://kangax.github.io/compat-table/es6/)">ECMAScript 6 compatibility table</a></strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/zheyizhifeng/picture_repo/images/image-20210419235736321.png" alt="image-20210419235736321"></p>
<p>这个页面从 2010 年开始一直在更新，可以说完整地记录了现代浏览器对 ES6 特性支持的历史进程。中间最大这块绿色是桌面浏览器，最右边的是移动浏览器，中间有两列是 NodeJS 环境。是不是绿得很整齐？如果我们的用户恰好都在绿色这一块，代码是不是只需要转译到 ES6 就够了？</p>
<p>当然可以。但可以做不等于必须做，我们还需要更充分的理由。为了寻找这样的理由，谷歌工程师 Philip Walton 就 <a target="_blank" rel="noopener" href="https://philipwalton.com/articles/deploying-es2015-code-in-production-today/">用自己的博客做了实验</a>。他在构建自己的博客程序时，把 JS 代码分别转译为 ES5 和 ES6，结果很有意思。ES6 版本的文件尺寸和执行时间都只有 ES5 版本的一半不到！</p>
<h2 id="ES5-6-构建文件尺寸和执行时间对比"><a href="#ES5-6-构建文件尺寸和执行时间对比" class="headerlink" title="ES5/6 构建文件尺寸和执行时间对比"></a>ES5/6 构建文件尺寸和执行时间对比</h2><table>
<thead>
<tr>
<th>版本</th>
<th>文件尺寸</th>
<th>执行时间</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>编译压缩</td>
<td>Gzip 压缩</td>
<td>测量值</td>
<td>平均值</td>
<td></td>
</tr>
<tr>
<td>ES2015+</td>
<td>80K</td>
<td><strong>21K</strong></td>
<td>184ms、164ms、166ms</td>
<td><strong>172ms</strong></td>
</tr>
<tr>
<td>ES5</td>
<td>175K</td>
<td><strong>43K</strong></td>
<td>389ms、351ms、360ms</td>
<td><strong>367ms</strong></td>
</tr>
</tbody></table>
<p><img src="https://cdn.jsdelivr.net/gh/zheyizhifeng/picture_repo/images/image-20210420224919914.png" alt="image-20210420224919914"></p>
<p><img src="https://cdn.jsdelivr.net/gh/zheyizhifeng/picture_repo/images/image-20210420224928669.png" alt="image-20210420224928669"></p>
<p>这里面虽然有些背景交代得不清楚，可能存在夸大的成分，但这样的数字确实很吸引人。对于互联网行业来说，带宽和时间最终都是可以换算成钱的！</p>
<h2 id="收益在哪"><a href="#收益在哪" class="headerlink" title="收益在哪"></a>收益在哪</h2><p>程序员在进行技术决策的时候，通常的目的是为了<del>kpi</del>，<del>升值加薪</del>，<del>这个技术很流行</del>，不，当然是为了对业务产生价值。</p>
<p>不难发现，直接部署es 6代码可以带来的好处包括：</p>
<ul>
<li>代码体积减小</li>
<li>性能提升</li>
<li>缩短构建时间</li>
</ul>
<h3 id="代码体积减小"><a href="#代码体积减小" class="headerlink" title="代码体积减小"></a>代码体积减小</h3><p>首先，es6带来了新的语法和特性，这可以让代码更简洁，使得代码量减少。其次，babel转译之后，会产生一些<code>helper</code>，引入一些<code>polyfill</code>，而且有一些语法特性无法在运行时进行处理，必须在转译过程中修改源代码，这也会导致代码量增加。当然，部署es6代码也需要babel转译一部分更新的语法，并不是说完全不使用babel。</p>
<p>Google 工程师 es6代码的bundle size比es5代码减少了<strong>50%**，而我自己的实践的结果没有这么夸张，是</strong>25%左右**。</p>
<table>
<thead>
<tr>
<th align="center">version</th>
<th align="center">bundle size</th>
<th align="center">Gzipped</th>
</tr>
</thead>
<tbody><tr>
<td align="center">es5</td>
<td align="center">221kb</td>
<td align="center">39kb</td>
</tr>
<tr>
<td align="center">es6</td>
<td align="center">170kb</td>
<td align="center">29kb</td>
</tr>
</tbody></table>
<p>之所以我和他的测试结果差异较大，是因为最终的结果跟每个人的代码风格和代码内容有很大的关系。我用来进行测试的代码是一个线上项目的代码，我个人的代码风格是大量使用es6/7/8语法，不过项目本身大量是在写业务逻辑，并且项目使用了Vue，其实很多js代码是模板编译之后生成的渲染函数。</p>
<p>所以，大概的结论是es6的代码会比es5的代码体积减少**15% ~ 50%**，具体能减少多少，取决于代码风格以及代码内容。代码风格越现代，代码中”生成的代码”越少，收益越高。</p>
<h3 id="性能提升"><a href="#性能提升" class="headerlink" title="性能提升"></a>性能提升</h3><p>es6代码相对于es5代码，性能更高的原因我认为有2个</p>
<ul>
<li>代码量减少带来的解析时间减少，这个正比于代码体积的减少</li>
<li>运行性能的提高</li>
</ul>
<p>对于第一点，浏览器解析代码时间的减少应该占比较小，通过chrome的<code>Performance</code>面板可以看到，解析一个200kb的js文件Compile Script耗时为<strong>10ms</strong>。</p>
<p>对于第二点，运行时性能。在es6刚刚发布的时候，很多新特性的性能是比较低的，因为js引擎没有足够的时间去进行优化，相比较而言，es5以及更老的代码经过了浏览器的长时间优化，在es6刚出来的时候，很对人也对es6的性能有很大的担忧。</p>
<p>Github上有一个<a target="_blank" rel="noopener" href="http://incaseofstairs.com/six-speed/">仓库</a>，专门对es6和es5进行了性能对比。</p>
<p><img src="https://cdn.jsdelivr.net/gh/zheyizhifeng/picture_repo/images/image-20210421122126368.png" alt="image-20210421122126368"></p>
<p>从对比结果可以看出来，在chrome 72版本上，es6代码的性能优于babel转译成的es5代码，和手写的es5代码比起来各有千秋，基本算是55开。</p>
<p>针对运行时的es6代码和es5代码的性能对比，我也用一个线上项目进行了实验。实验方式如下</p>
<ol>
<li>利用<code>performance API</code>在打包后的app.js文件开头记下时间戳，在js文件末尾减去开始的时间，得到一个时间，众所周知，打包之后的app.js是一个立即执行函数，所以这个时间包含了app.js文件中<strong>部分代码</strong>的运行时间</li>
<li>利用chrome 的<code>Performance</code>面板，可以直接得到一段js的执行时间<code>Evaluate Script</code></li>
</ol>
<p>实验结果如下（20次的平均值）</p>
<table>
<thead>
<tr>
<th align="center">version</th>
<th align="center">记录的运行时间</th>
<th align="center">Performance面板的Evaluate Script</th>
</tr>
</thead>
<tbody><tr>
<td align="center">es5</td>
<td align="center">258.88ms</td>
<td align="center">295.29ms</td>
</tr>
<tr>
<td align="center">es6</td>
<td align="center">206.28ms</td>
<td align="center">241.59ms</td>
</tr>
</tbody></table>
<p>测试条件下，es6的代码取得了<strong>20%左右</strong>的运行性能提升</p>
<h2 id="Shareit-系APP对ES-6支持情况"><a href="#Shareit-系APP对ES-6支持情况" class="headerlink" title="Shareit 系APP对ES 6支持情况"></a>Shareit 系APP对ES 6支持情况</h2><p><a target="_blank" rel="noopener" href="http://ruanyf.github.io/es-checker/">检查 ES 6 兼容性</a></p>
<p>最新的Mac Chrome</p>
<p><img src="https://cdn.jsdelivr.net/gh/zheyizhifeng/picture_repo/images/image-20210421104026586.png" alt="image-20210421104026586"></p>
<p><img src="https://cdn.jsdelivr.net/gh/zheyizhifeng/picture_repo/images/image-20210420232910160.png" alt="image-20210420232910160"></p>
<blockquote>
<p>注释：<a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2015/04/tail-call.html">什么是尾调用优化</a></p>
</blockquote>
<ul>
<li>Android 版本对ES 6 支持情况</li>
</ul>
<p><strong>本地设备列表</strong>【Genymotion 模拟】</p>
<p><img src="https://cdn.jsdelivr.net/gh/zheyizhifeng/picture_repo/images/image-20210420231211354.png" alt="image-20210420231211354"></p>
<ul>
<li>Android 4.4</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/zheyizhifeng/picture_repo/images/image-20210420231614343.png" alt="image-20210420231614343"></p>
<ul>
<li>Android 5.0</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/zheyizhifeng/picture_repo/images/image-20210420231821967.png" alt="image-20210420231821967"></p>
<ul>
<li>Android 5.1</li>
</ul>
<p>![image-20210420231748619](/Users/chenlei/Library/Application Support/typora-user-images/image-20210420231748619.png)</p>
<p><img src="https://cdn.jsdelivr.net/gh/zheyizhifeng/picture_repo/images/image-20210420232729704.png" alt="image-20210420232729704"></p>
<ul>
<li>Android 6.0</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/zheyizhifeng/picture_repo/images/image-20210420232053842.png" alt="image-20210420232053842"></p>
<p>![image-20210420232600122](/Users/chenlei/Library/Application Support/typora-user-images/image-20210420232600122.png)</p>
<ul>
<li>Android 7.0</li>
</ul>
<p>![image-20210420232020159](/Users/chenlei/Library/Application Support/typora-user-images/image-20210420232020159.png)</p>
<ul>
<li>Android 7.1</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/zheyizhifeng/picture_repo/images/image-20210420232253070.png" alt="image-20210420232253070"></p>
<h3 id="likeit-lite-task项目"><a href="#likeit-lite-task项目" class="headerlink" title="likeit-lite-task项目"></a>likeit-lite-task项目</h3><ul>
<li>Webview 分布</li>
</ul>
<table>
<thead>
<tr>
<th>89.0.4389</th>
<th>88.0.4324</th>
<th>87.0.4280</th>
<th>83.0.4103</th>
<th>81.0.4044</th>
<th>80.0.3987</th>
<th>74.0.3729</th>
<th>70.0.3538</th>
<th>其他</th>
</tr>
</thead>
<tbody><tr>
<td>47%</td>
<td>8%</td>
<td>5%</td>
<td>5%</td>
<td>2%</td>
<td>5%</td>
<td>2%</td>
<td>3%</td>
<td>16%</td>
</tr>
</tbody></table>
<ul>
<li>Android 版本分布</li>
</ul>
<table>
<thead>
<tr>
<th>10</th>
<th>9</th>
<th>8.1</th>
<th>11</th>
<th>7.1.2</th>
<th>7.1.1</th>
<th>6.0.1</th>
<th>7.0</th>
<th>5.1.1</th>
<th>其他</th>
</tr>
</thead>
<tbody><tr>
<td>36%</td>
<td>21%</td>
<td>19%</td>
<td>4%</td>
<td>3%</td>
<td>3%</td>
<td>2%</td>
<td>2%</td>
<td>2%</td>
<td>3%</td>
</tr>
</tbody></table>
<p><img src="https://cdn.jsdelivr.net/gh/zheyizhifeng/picture_repo/images/image-20210420233722214.png" alt="image-20210420233722214"></p>
<ul>
<li>修改前：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/zheyizhifeng/picture_repo/images/image-20210421000418656.png" alt="image-20210421000418656"></p>
<ul>
<li>修改后：</li>
</ul>
<p>![image-20210421000447491](/Users/chenlei/Library/Application Support/typora-user-images/image-20210421000447491.png)</p>
<p>话说回来，构建成 ES5 和 ES6，到底差别在哪里？执行变快还容易理解，为什么代码量也可以少这么多？下面的图是通过 Webpack 构建分析工具得到的，ES5 版本代码比 ES6 主要多了两大块。一个是 <strong>core-js</strong>，包含了很多 ES6 特性的 polyfill，这些代码在 Gzip 压缩以后仍然超过 10K。</p>
<p><img src="https://cdn.jsdelivr.net/gh/zheyizhifeng/picture_repo/images/image-20210421000552744.png" alt="image-20210421000552744"></p>
<p>另一个是 <strong>regenerator-runtime</strong>，这是 ES 6 生成器转译为 ES 5 所产生的，单单这一个东西，Gzip 压缩后就有 2.37K 之多，是 ES 6 转译为 ES 5 当之无愧的第一大 polyfill。开发的时候用 ES 8 特性 <code>async</code>/<code>await</code>，构建时 Babel 就会把它们先转译为 ES 6 的生成器，再转译为 ES5。</p>
<p>![image-20210421000619834](/Users/chenlei/Library/Application Support/typora-user-images/image-20210421000619834.png)</p>
<p>除此之外，还有一些语法特性是无法在运行时进行处理的，必须在转译过程中修改源代码。这些修改也会导致代码量增加。</p>
<p><img src="https://cdn.jsdelivr.net/gh/zheyizhifeng/picture_repo/images/image-20210421000812430.png" alt="image-20210421000812430"></p>
<h2 id="降级方案"><a href="#降级方案" class="headerlink" title="降级方案"></a>降级方案</h2><p><img src="https://cdn.jsdelivr.net/gh/zheyizhifeng/picture_repo/images/image-20210421133454968.png" alt="image-20210421133454968"></p>
<pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>es6.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  
  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">nomodule</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>es5.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="https://cdn.jsdelivr.net/gh/zheyizhifeng/picture_repo/images/image-20210421111842163.png" alt="image-20210421111842163"></p>
<p>![image-20210421000922146](/Users/chenlei/Library/Application Support/typora-user-images/image-20210421000922146.png)</p>
<h3 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h3><p>如果已经使用了 webpack 或者 rollup 这类模块打包工具来生成 JS 文件，那么应该继续保持。</p>
<p>除了当前的代码包，还需要生成类似于第一份的另外一份代码包。（该代码包使用了 ES2015+ 语法），唯一的不同是你不需要将其编译成 ES5 语法的代码，并且不需要引入 polyfills 插件。</p>
<p>例如，假设你使用了 webpack 并且 JS 的入口文件是<code> ./path/to/main.js</code> ，你当前的 ES5 版本的配置应该如下所示</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  entry<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token string">'main-legacy'</span><span class="token operator">:</span> <span class="token string">'./path/to/main.js'</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    filename<span class="token operator">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span>
      test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
      use<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
        options<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          presets<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">[</span><span class="token string">'env'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
              modules<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
              useBuiltIns<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
              targets<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                browsers<span class="token operator">:</span> <span class="token punctuation">[</span>
                  <span class="token string">'> 1%'</span><span class="token punctuation">,</span>
                  <span class="token string">'last 2 versions'</span><span class="token punctuation">,</span>
                  <span class="token string">'Firefox ESR'</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  entry<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token string">'main'</span><span class="token operator">:</span> <span class="token string">'./path/to/main.js'</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    filename<span class="token operator">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span>
      test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
      use<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
        options<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          presets<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">[</span><span class="token string">'env'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
              modules<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
              useBuiltIns<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
              targets<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                browsers<span class="token operator">:</span> <span class="token punctuation">[</span>
                  <span class="token string">'Chrome >= 60'</span><span class="token punctuation">,</span>
                  <span class="token string">'Safari >= 10.1'</span><span class="token punctuation">,</span>
                  <span class="token string">'iOS >= 10.3'</span><span class="token punctuation">,</span>
                  <span class="token string">'Firefox >= 54'</span><span class="token punctuation">,</span>
                  <span class="token string">'Edge >= 15'</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>一旦运行，这两个配置文件就会输出两个 JS 文件：</p>
<ul>
<li>main.js （该文件支持 ES2015+ 语法）</li>
<li>main-legacy.js （该文件支持 ES5 语法）</li>
</ul>
<pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token comment">&lt;!-- Browsers with ES module support load this file. --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>main.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
 
<span class="token comment">&lt;!-- Older browsers load this file (and module-supporting --></span>
<span class="token comment">&lt;!-- browsers know *not* to load this file). --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">nomodule</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>main-legacy.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">var</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>内核版本 <span class="token operator">></span> <span class="token number">60</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    script<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'es6.js'</span>
    script<span class="token punctuation">.</span>onload <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    script<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'es5.js'</span>
  <span class="token punctuation">&#125;</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://cdn.jsdelivr.net/gh/zheyizhifeng/picture_repo/images/image-20210421000934553.png" alt="image-20210421000934553"></p>
<h2 id="Polyfill"><a href="#Polyfill" class="headerlink" title="Polyfill"></a>Polyfill</h2><p>JavaScript 语言在稳步发展。也会定期出现一些对语言的新提议，它们会被分析讨论，如果认为有价值，就会被加入到 <a target="_blank" rel="noopener" href="https://tc39.github.io/ecma262/">https://tc39.github.io/ecma262/</a> 的列表中，然后被加到 <a target="_blank" rel="noopener" href="http://www.ecma-international.org/publications/standards/Ecma-262.htm">规范</a> 中。</p>
<p>JavaScript 引擎背后的团队关于首先要实现什么有着他们自己想法。他们可能会决定执行草案中的建议，并推迟已经在规范中的内容，因为它们不太有趣或者难以实现。</p>
<p>因此，一个 JavaScript 引擎只能实现标准中的一部分是很常见的情况。</p>
<p>查看语言特性的当前支持状态的一个很好的页面是 <a target="_blank" rel="noopener" href="https://kangax.github.io/compat-table/es6/%EF%BC%88%E5%AE%83%E5%BE%88%E5%A4%A7%EF%BC%8C%E6%88%91%E4%BB%AC%E7%8E%B0%E5%9C%A8%E8%BF%98%E6%9C%89%E5%BE%88%E5%A4%9A%E4%B8%9C%E8%A5%BF%E8%A6%81%E5%AD%A6%EF%BC%89%E3%80%82">https://kangax.github.io/compat-table/es6/（它很大，我们现在还有很多东西要学）。</a></p>
<p><code>Polyfill</code>或者<code>Polyfiller</code>，是英国Web开发者 <a target="_blank" rel="noopener" href="https://remysharp.com/">Remy Sharp</a> 在咖啡店蹲坑的时候拍脑袋造出来的。当时他想用一个词来形容”用JavaScript（或者Flash之类的什么鬼）来实现一些浏览器不支持的原生API”。<code>Shim</code>这个已经有的词汇第一时间出现在他的脑海里。但是他回头想了一下<code>Shim</code>一般有自己的API，而不是单纯实现原生不支持的API。苦思冥想一直想不到合适的单词，于是他一怒之下造了一个单词<code>Polyfill</code>。除了他自己用这个词以外，他还给其他开发者用。随着他在各种Web会议演讲和他写的书《Introducing HTML5》中频繁提到这个词，大家用了都觉得很好，就一起来用。</p>
<p><code>Polyfill</code>的准确意思为：<strong>用于实现浏览器并不支持的原生API的代码。</strong></p>
<p>如，<code>querySelectorAll</code>是很多现代浏览器都支持的原生Web API，但是有些古老的浏览器并不支持，那么假设有人写了库，只要用了这个库， 你就可以在古老的浏览器里面使用<code>document.querySelectorAll</code>，使用方法跟现代浏览器原生API无异。那么这个库就可以称为<code>Polyfill</code>或者<code>Polyfiller</code>。</p>
<p>好，那么问题就来了。jQuery是不是一个<code>Polyfill</code> ?答案是No。因为它并不是实现一些标准的原生API，而是封装了自己API。一个<code>Polyfill</code>是抹平新老浏览器 <strong><em>标准原生API</em></strong> 之间的差距的一种封装，而不是实现自己的API。</p>
<p>已有的一些<code>Polyfill</code>，如 <a target="_blank" rel="noopener" href="https://www.polymer-project.org/0.5/docs/start/platform.html">Polymer</a> 是让旧的浏览器也能用上 HTML5 Web Component 的一个<code>Polyfill</code>。<a target="_blank" rel="noopener" href="http://flashcanvas.net/">FlashCanvas</a>是用Flash实现的可以让不支持Canvas API的浏览器也能用上Canvas的<code>Polyfill</code>。</p>
<p>这里有一堆<code>Polyfills</code>，有兴趣可以把玩一下：<a target="_blank" rel="noopener" href="https://github.com/Modernizr/Modernizr/wiki/HTML5-Cross-browser-Polyfills">HTML5 Cross Browser Polyfills</a></p>
<h2 id="过去"><a href="#过去" class="headerlink" title="过去"></a>过去</h2><h3 id="shim-sham"><a href="#shim-sham" class="headerlink" title="shim + sham"></a>shim + sham</h3><p>如果你是一个 3 年陈 + 的前端，应该会有听说过 shim、sham、<a target="_blank" rel="noopener" href="https://github.com/es-shims/es5-shim">es5-shim</a> 和 <a target="_blank" rel="noopener" href="https://github.com/es-shims/es6-shim">es6-shim</a> 等等现在看起来很古老的补丁方式。</p>
<p>那么，shim 和 sham 是啥？又有什么区别？</p>
<ul>
<li>shim 是<strong>能用</strong>的补丁</li>
<li>sham 顾名思义，是假的意思，所以 sham 是一些<strong>假的方法</strong>，只能使用保证不出错，但不能用。至于为啥会有 sham，因为有些方法的低端浏览器里根本实现不了</li>
</ul>
<h3 id="babel-polyfill-js"><a href="#babel-polyfill-js" class="headerlink" title="babel-polyfill.js"></a>babel-polyfill.js</h3><p>在 shim 和 sham 之后，还有一种补丁方式是引入包含所有语言层补丁的 <code>babel-polyfill.js</code>。比如：</p>
<pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdnjs.cloudflare.com/ajax/libs/babel-polyfill/7.2.5/polyfill.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>然后就 es6、es7 特性随便写了。</p>
<p>但缺点是，babel-polyfill 包含所有补丁，不管浏览器是否支持，也不管你的项目是否有用到，都全量引了，所以如果你的用户全都不差流量和带宽（比如内部应用），尽可以用这种方式。</p>
<h2 id="现在"><a href="#现在" class="headerlink" title="现在"></a>现在</h2><p>现在还没有银弹，各种方案百花齐放。</p>
<h3 id="babel-preset-env-useBuiltins-entry-targets"><a href="#babel-preset-env-useBuiltins-entry-targets" class="headerlink" title="@babel/preset-env + useBuiltins: entry + targets"></a>@babel/preset-env + useBuiltins: entry + targets</h3><p>babel-polyfill 包含所有补丁，那我只需要支持某些浏览器的某些版本，是否有办法只包含这些浏览器的补丁？这就是 <code>@babel/preset-env</code> + <code>useBuiltins: entry</code> + <code>targets</code> 配置的方案。</p>
<p>我们先在入口文件里引入 <code>@babel/polyfill</code>，</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token string">'@babel/polyfill'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>然后配置 .babelrc，添加 preset <code>@babel/preset-env</code>，并设置 <code>useBuiltIns</code> 和 <code>targets</code>，</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"presets"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">"@babel/env"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
      useBuiltIns<span class="token operator">:</span> 'entry'<span class="token punctuation">,</span>
      targets<span class="token operator">:</span> <span class="token punctuation">&#123;</span> chrome<span class="token operator">:</span> <span class="token number">60</span> <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>useBuiltIns: entry</code> 的含义是找到入口文件里引入的 <code>@babel/polyfill</code>，并替换为 targets 浏览器/环境需要的补丁列表。</p>
<p>替换后的内容，比如：</p>
<pre class="line-numbers language-none"><code class="language-none">import &quot;core-js&#x2F;modules&#x2F;es7.string.pad-start&quot;;
import &quot;core-js&#x2F;modules&#x2F;es7.string.pad-end&quot;;
...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>这样就只会引入 chrome@62 及以上所需要的补丁，什么 Promise 之类的都不会再打包引入。</p>
<h3 id="Ployfill-io-方案"><a href="#Ployfill-io-方案" class="headerlink" title="Ployfill.io 方案"></a>Ployfill.io 方案</h3><p>动态 Polyfill 是根据不同浏览器的特性，载入需要的特性补丁。Polyfill.io 通过尝试使用 polyfill 重新创建缺少的功能，可以轻松地支持不同的浏览器，并且可以大幅度地减少构建体积。</p>
<p><a target="_blank" rel="noopener" href="http://www.ft.com/">Financial Times</a> 在开发和维护这个项目，所以我们能确信这个项目可以持续更新下去.</p>
<p><strong><em>有一点需要明白：Polyfill.io 没有提供语法糖支持。比如 类、增强的对象字面量，以及箭头函数之类的特性。对那些代码，你仍然需要进行编译。</em></strong></p>
<p>动态 Polyfill 方案对比：</p>
<table>
<thead>
<tr>
<th>方案</th>
<th>优点</th>
<th>缺点</th>
<th>是否采用</th>
</tr>
</thead>
<tbody><tr>
<td>babel-polyfill</td>
<td>React16 官方推荐</td>
<td>1. 包体积 200K+，难以单独抽离 Map、Set 2. 项目里 React 是单独引用的 CDN，如果要用它，需要单独构建一份放在 React 前加载</td>
<td>❌</td>
</tr>
<tr>
<td>babel-plugin-transform-runtime</td>
<td>能只 polyfill 用到的类或方法，相对体积较小</td>
<td>不能 polyfill 原型上的方法，不适用于业务项目的复杂开发环境</td>
<td>❌</td>
</tr>
<tr>
<td>自己写 Map、Set 的 Polyfill</td>
<td>定制化高，体积小</td>
<td>1. 重复造轮子，容易在日后年久失修成为坑 2. 即使体积小，依然所有用户都要加载</td>
<td>❌</td>
</tr>
<tr>
<td>polyfill-service</td>
<td>只给用户返回需要的 polyfill，社区维护</td>
<td>部分国内奇葩浏览器 UA 可能无法识别（但可以降级返回所需全部 Polyfill）</td>
<td>✅</td>
</tr>
</tbody></table>
<h3 id="Polyfill-Service原理"><a href="#Polyfill-Service原理" class="headerlink" title="Polyfill Service原理"></a>Polyfill Service原理</h3><ul>
<li><p>每次打开页面，浏览器都会向Polyfill Service发送请求，Polyfill Service识别 User Agent，下发不同的 Polyfill，做到按需加载Polyfill的效果。</p>
<p><img src="https://serverless-action.com/assets/img/28.e7e06200.png" alt="Polyfill Service原理"></p>
</li>
</ul>
<h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><p>直接引入代码即可使用默认配置的 Polyfill：</p>
<pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">crossOrigin</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>anonymous<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://polyfill.io/v3/polyfill.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Polyfill.io 通过分析请求头信息中的 UserAgent 实现自动加载浏览器所需的 polyfill。</p>
<p><img src="https://cdn.jsdelivr.net/gh/zheyizhifeng/picture_repo/images/image-20210421143435576.png" alt="image-20210421143435576"></p>
<h2 id="高级用法"><a href="#高级用法" class="headerlink" title="高级用法"></a>高级用法</h2><p>Polyfill.io 有一份默认捆绑列表，包括了最常见的 HTML5 中的 <code>document.querySelector</code>、<code>Element.classList</code>、ES5、ES6、ES7 中的 <code>Promise</code>、<code>fetch</code>、<code>Array.from</code> 等等。</p>
<p>你可以通过传递 <code>features</code> 参数来自定义功能列表：</p>
<pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token comment">&lt;!-- 加载 Promise&amp;fetch --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.polyfill.io/v3/polyfill.min.js?features=Promise,fetch<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>

<span class="token comment">&lt;!-- 加载所有 ES5&amp;ES6 新特性 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.polyfill.io/v3/polyfill.min.js?features=es5,es6,es7<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Polyfill.io 还提供了其他 API，具体请查阅官方文档：</p>
<pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token comment">&lt;!-- 异步加载 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.polyfill.io/v3/polyfill.min.js?callback=main<span class="token punctuation">"</span></span> <span class="token attr-name">async</span> <span class="token attr-name">defer</span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token comment">&lt;!-- 无视 UA，始终加载 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.polyfill.io/v3/polyfill.js?features=modernizr:es5array|always<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="未来"><a href="#未来" class="headerlink" title="未来"></a>未来</h2><p>关于补丁方案的未来，我觉得<strong>按需特性探测 + 在线补丁</strong>才是终极方案。</p>
<p>按需特性探测保证特性的最小集；在线补丁做按需下载。</p>
<p>按需特性探测可以用 <code>@babel/preset-env</code> 配上 <code>targets</code> 以及试验阶段的 <code>useBuiltIns: usage</code>，保障特性集的最小化。之所以说是未来，因为 JavaScript 的动态性，语法探测不太可能探测出所有特性，但上了 TypeScript 之后可能会好一些。另外，要注意一个前提是 node_modules 也需要走 babel 编译，不然 node_modules 下用到的特性会探测不出来。</p>
<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><blockquote>
<p> <strong>时间带走一切，es5也不例外。</strong></p>
<p><strong>编写 ES6 只是程序员的胜利</strong></p>
<p><strong>部署 ES6 才是与用户的双赢</strong></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zheyizhifeng.github.io/2021/10/26/%E7%88%B1%E7%9A%84%E5%91%8A%E7%99%BD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="lucida">
      <meta itemprop="description" content="文质彬彬，然后君子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucida's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/10/26/%E7%88%B1%E7%9A%84%E5%91%8A%E7%99%BD/" class="post-title-link" itemprop="url">爱的告白</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-10-26 17:21:37" itemprop="dateCreated datePublished" datetime="2021-10-26T17:21:37+08:00">2021-10-26</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-11-11 12:59:27" itemprop="dateModified" datetime="2022-11-11T12:59:27+08:00">2022-11-11</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Life/" itemprop="url" rel="index"><span itemprop="name">Life</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>丹丹小可爱，聪明机智如你，想必一进屋子就知道我要干嘛了吧。此刻，你的心情是怎样的呢？<code>灰色是不想说，蓝色是忧郁，而漂泊的你狂浪的心停在哪里</code>（唱出来）。我猜，你一定和我一样，激动中有几丝不安，兴奋又满心期许吧。不过先别急，我们先来看一段视频。</p>
</blockquote>
<p>丹丹小可爱，你还记得19年我们第一次见面的那一天吗？虽然咱俩对外都声称，是因为朋友的朋友这层关系结识的，哈哈，其实咱俩属于网友线下见面，最终双向奔赴。所以朋友们，你们问我网恋靠不靠谱？我不好说，至少在我身上是靠谱的哈。咱俩邂逅在深圳5月的初夏，起源在南山区的一家猫咖啡店，在这里我留下了贻笑大方被你后来翻出来反复“鞭尸”的难忘记忆。不怕大家笑话，丹丹说我当时和她讲话时说着说着，突然跑开一个人过去逗猫了🤣，但为啥我一点印象没有嘞，这大概就是当局者迷的吧。我们去吃了同仁四季的椰子鸡，这在后来变成了我们在外面最爱吃的美食，在胃口上大相径庭的我们，难得拥有了宝贵的共同爱好，太赞了👍！我们在一起后，开始尝试自己烹饪椰子鸡，再回到同仁四季对照口味，历经反复尝试，终于研究出新鲜出炉的 ”丹丹牌椰子鸡“，对门的美食家老李吃过后也连声称好。谢谢你对美食的热爱，谢谢你的探索精神，让我一次吃鸡吃到爽，爽啊！</p>
<p>后来呀，咱们的见面频次从周末见一次，升级到周末见两次，再到周一到周五晚上下班以后都出来见面，那些难忘的相伴在深圳湾的记忆，不只停留在那些晚上潮起潮落的夜风里，也在我的脑海里挥之不去。我会记得你对我讲你小时候多舛的际遇，讲你初高中时铭记在心的三两知心好友，讲你斑斓多彩的大学时光，讲你旅行途中遇见的形形色色有趣的生命。。。现在你还会偶尔讲讲那些日子，我都记在心里了呢。谢谢你对我的信任，谢谢你愿意把你的生活和过去分享给我。以后，也请你继续讲给我听，好吗？</p>
<p>我还记得有一回是6月初，我第二天早上要搭乘早班机跟同事去日本团建，而前一天晚上咱们还在深圳湾彻夜长谈到凌晨两三点，许是那个时候，我们渐渐对双方产生了依赖。从日本回来，咱们相约去了就近的河源，河源没有什么特别，唯一让我记忆比较深刻的就只剩一碧万顷的万绿湖和湖畔边的那间雅致的民宿了。从河源归来，咱俩正式在一起了，这么看来，河源也算是我们的定情之地呢。在那之后，我过上了下班有饭吃，家里有人牵挂，午餐还有爱心便当的幸福🥰生活。谢谢你绝佳的厨艺，谢谢你对我无微不至的照顾，从此我的体重一往无前，一度比初识你时胖了20多斤，这是当之无愧的幸福肥呀！</p>
<p>9月咱们飞去了菲律宾，上一回去日本是我第一回出国，完全是跟着大部队统一行动，这回完全是我们说走就走的自由行，全程我们自己做主。还好有你，慷慨地贡献你的人文地理知识，贡献你的旅途经验，而我，偶尔充当一两回胖翻译，谁让咱英文词汇比你多哈哈。你带着我，看见了清澈见底的湛蓝的海，海里游曳着五彩缤纷的海鱼、水母、珊瑚； 你带着我，住在了一览众山小的山顶民宿，我们在山顶碧蓝的泳池里，极目远眺，一切美景尽收眼底，多么自在惬意。后来你又带着我潜水，我怕得要命，就连跟你一起坐游艇我当时都害怕得不行，😒哼，都怪你当时眉飞色舞地对我讲之前发生在泰国的那起 400多人的沉船事故，当时我们乘坐的游艇一直在汹涌的波涛上上蹿下跳摇晃个不停，时刻感觉要侧翻，你偏偏对我讲，泰国的那起事故沉船也是这个型号，一旦船翻了，咱们都出不去。可是后来，在潜水教练的耳提面命和当头棒喝下， 四肢不协调的我在你的耐心配合和指导下，最终还是考下了潜水证，对水不再那么恐惧，可以携手与你鱼翔浅底，一起看到海面下的另一番风景，那是过去的人生里都不曾领略的难忘一生的风景。谢谢你在我软弱怯懦时候的理解和包容，谢谢你帮我克服恐惧，谢谢你对人生的热爱，谢谢你带我领略人生的风景！</p>
<p>11月这次是你陪着我第一次来北京看我喜欢的雅尼的音乐会。11月的京城，满地金黄，在雄伟的天安门，在庄严的故宫，在热闹的南锣鼓巷，在僻静的帽儿胡同，你在我的手机相机里留下了一个个婀娜多姿的倩影，在庄重神圣的人民大会堂，你陪我圆了我的一个梦。谢谢你陪着我，谢谢你支持理解我的喜好，我好开心呐。从那以后我也开始理解你的爱好，爱上了你爱听的赵雷，赵雷甚至一度成了我听歌最多的那位，我开始关注了你在意的那些B站up主，和你一起窝在被窝里看“非洲飞哥”，一起听“波士顿圆脸”入眠。。。从最初咱俩没啥共同话题爱好，也开始慢慢越来越默契，这应该就是爱的力量吧。谁能想到，半年后咱们直接跨域南北离开温暖潮湿的深圳，来到天干物燥的北京，现在站在这里。在那之后，就是遇到你们，台下的这群相识在北京的可爱的朋友们。</p>
<p>我们和其他众多的情侣一样也闹过别扭闹分手，大多数时候过错一方都在我，有时候自己都会觉得自己好傻，怎么会做出这种行为，脑子是不是上学那会学傻了，还是写代码写魔怔了。我记得19年11月份给小可爱过第一个生日，提前预订的鲜花结果没送到，定的蛋糕倒是送到了，却在蜡烛都还没插上等许愿吹灭呢，就被我提前切割了；还有今年的 2.14 情人节，我说出了“挺想送你浪琴的，但我嫌贵”这种蠢话。 可是你最后都用宽广的心包容了我，除了你，不会再有第二个人能忍受我吧。谢谢你的理解和宽容，谢谢你的大度，谢谢你的坦然和真诚！在和你的相处中，我渐渐地变得成熟，渐渐地变得优秀，渐渐地变成你喜欢的样子，在将来的日子里，我一定会在你的鼓励下变得更好！</p>
<p>丹丹小可爱，你常常会问，你爱我吗？刚在一起那会儿，我对你应该是好感和喜欢大过了爱。爱吗？当然爱。爱有几分？我说不太清。那现在呢？我爱你100分，100% 爱你😘。谢谢你的勇敢，谢谢你的坚持，谢谢你的宽容，谢谢你的热情，谢谢你的同理心和共情，谢谢你的诚实正直，谢谢你的善良，谢谢你的博学多知，谢谢你身上还有许许多多的难能可贵的闪光点，谢谢你让我遇到一个有趣的灵魂。</p>
<p>今天陪同和见证我们幸福现场的是一群我们在北京遇到的良人们，谢谢你们，我们的好朋友们！还要感谢在这段日子丹丹的朋友们无私的配合和帮助，感谢梦圆妹妹、芝芝、蛙牛、马狗、叶子、豹子、虎子、小爷阿文等好友，最要感谢丹丹的爸爸妈妈和恩恩弟弟，谢谢你们把赵丹交给我，请你们放心，我一定和丹丹相亲相爱、相辅相成、相濡以沫、相敬如宾。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zheyizhifeng.github.io/2021/10/20/%E6%B1%82%E5%A9%9A%E5%A4%A7%E4%BD%9C%E6%88%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="lucida">
      <meta itemprop="description" content="文质彬彬，然后君子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucida's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/10/20/%E6%B1%82%E5%A9%9A%E5%A4%A7%E4%BD%9C%E6%88%98/" class="post-title-link" itemprop="url">求婚大作战</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-10-20 17:21:37" itemprop="dateCreated datePublished" datetime="2021-10-20T17:21:37+08:00">2021-10-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-11-11 12:59:43" itemprop="dateModified" datetime="2022-11-11T12:59:43+08:00">2022-11-11</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Life/" itemprop="url" rel="index"><span itemprop="name">Life</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="求婚时间"><a href="#求婚时间" class="headerlink" title="求婚时间"></a>求婚时间</h1><blockquote>
<p> 2021.11.14 [周日] 晚。丹丹生日在第二天，农历10.11。</p>
</blockquote>
<h1 id="地点"><a href="#地点" class="headerlink" title="地点"></a>地点</h1><p>考虑到是在周日进行，直接带她去酒店太突兀。以及要想个合适的理由“骗”她出门，目前我的想法是带着她参加集体活动，她就不会起疑了，且能保证出门形象是OK的。计划是周日上半场 + 下半场。</p>
<ul>
<li>下午大家一起出门 KTV ，晚上大家可能一起聚餐，最后我带她去提前定好的酒店。但由于切换了场地， 转场如何我还欠缺考虑，如何让大家再突然出现。</li>
</ul>
<blockquote>
<p>KTV 求婚也考虑过，丹丹喜欢唱歌，大家也都在，之前参加别人的求婚，见过了电影院求婚的创意，KTV 这个点子至少还算新，就是不知道会不会太吵闹，KTV 能不能播放我的求婚视频和亲朋好友的祝福视频。</p>
</blockquote>
<ul>
<li>上半场大家一起去轰趴馆，晚上后续的计划和前面一致。</li>
</ul>
<h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><p>从网络上搜索了不少求婚策划、准备相关的东西，目前确定是在室内进行求婚。需要准备这些，多多益善</p>
<ul>
<li>求婚戒指 【今晚先拿回测手指的戒圈快递】，准备直接从网上购买</li>
<li>求婚视频，包含丹丹爸妈、弟弟、闺蜜、死党还有你们等，目前进行中</li>
<li>整理打印照片，制作相册</li>
<li>投影仪？待定视频播放方式</li>
<li>场地布置：打气筒、气球、星空灯、背景音乐</li>
<li>自己形象【目前纠结中，西装or便装？】</li>
<li>预订鲜花</li>
<li>求婚台词准备</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zheyizhifeng.github.io/2021/10/19/%E6%88%91%E6%89%80%E4%BA%86%E8%A7%A3%E7%9A%84%E8%B0%83%E8%AF%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="lucida">
      <meta itemprop="description" content="文质彬彬，然后君子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucida's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/10/19/%E6%88%91%E6%89%80%E4%BA%86%E8%A7%A3%E7%9A%84%E8%B0%83%E8%AF%95/" class="post-title-link" itemprop="url">我所了解的调试</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-10-19 17:21:37" itemprop="dateCreated datePublished" datetime="2021-10-19T17:21:37+08:00">2021-10-19</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-11-11 13:00:11" itemprop="dateModified" datetime="2022-11-11T13:00:11+08:00">2022-11-11</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Debug/" itemprop="url" rel="index"><span itemprop="name">Debug</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Debug/Node-JS/" itemprop="url" rel="index"><span itemprop="name">Node.JS</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>调试是每个程序员必备的技能，因此选择合适的调试工具能极大地方便我们调试代码。Node.js 的调试方式也有很多，常见的有：</p>
<ol>
<li>万能的 console.log</li>
<li>debugger</li>
<li>node-inspector</li>
</ol>
<p>以上本节都不会讲解，因为：</p>
<ol>
<li>console.log 就不用说了。</li>
<li>debugger 不推荐使用，因为：<ol>
<li>使用繁琐，需手动打点。</li>
<li>若忘记删除 debugger，还会引起性能问题。</li>
</ol>
</li>
<li>node-inspector 已经退出历史舞台。<a href="mailto:&#x6e;&#111;&#x64;&#101;&#64;&#x36;&#46;&#x33;">&#x6e;&#111;&#x64;&#101;&#64;&#x36;&#46;&#x33;</a> 以后内置了一个调试器，可以结合 Chrome DevTools 使用，而且比 node-inspector 更强大。</li>
</ol>
<h1 id="Chrome-DevTools-调试"><a href="#Chrome-DevTools-调试" class="headerlink" title="Chrome DevTools 调试"></a>Chrome DevTools 调试</h1><p>JavaScript 程序越来越复杂，调试工具的重要性日益凸显。客户端脚本有浏览器，Node 脚本怎么调试呢？</p>
<p><img src="https://www.ruanyifeng.com/blogimg/asset/2018/bg2018031901.png" alt="img"></p>
<p>2016年，Node 决定将 Chrome 浏览器的”开发者工具”作为官方的调试工具，使得 Node 脚本也可以使用图形界面调试，这大大方便了开发者。</p>
<h2 id="一、示例程序"><a href="#一、示例程序" class="headerlink" title="一、示例程序"></a>一、示例程序</h2><p>为了方便讲解，下面是一个示例脚本。首先，新建一个工作目录，并进入该目录。</p>
<blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">mkdir</span> debug-demo
$ <span class="token builtin class-name">cd</span> debug-demo<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</blockquote>
<p>然后，生成<code>package.json</code>文件，并安装 <a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2017/08/koa.html">Koa</a> 框架和 koa-route 模块。</p>
<blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">npm</span> init -y
$ <span class="token function">npm</span> <span class="token function">install</span> --save koa koa-route<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</blockquote>
<p>接着，新建一个脚本<code>app.js</code>，并写入下面的内容。</p>
<blockquote>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// app.js</span>
<span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-route'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">main</span> <span class="token operator">=</span> <span class="token parameter">ctx</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'Hello World'</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">welcome</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> name</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'Hello '</span> <span class="token operator">+</span> name<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> main<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/:name'</span><span class="token punctuation">,</span> welcome<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'listening on port 3000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</blockquote>
<p>上面代码是一个简单的 Web 应用，指定了两个路由，访问后会显示一行欢迎信息。如果想了解代码的详细含义，可以参考 <a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2017/08/koa.html">Koa 教程</a>。</p>
<h2 id="二、启动开发者工具"><a href="#二、启动开发者工具" class="headerlink" title="二、启动开发者工具"></a>二、启动开发者工具</h2><p>现在，运行上面的脚本。</p>
<blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ node --inspect app.js<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</blockquote>
<p>上面代码中，<code>--inspect</code>参数是启动调试模式必需的。这时，打开浏览器访问<code>http://127.0.0.1:3000</code>，就可以看到 Hello World 了。</p>
<p><img src="https://www.ruanyifeng.com/blogimg/asset/2018/bg2018031902.png" alt="img"></p>
<p>接下来，就要开始调试了。一共有两种打开调试工具的方法，第一种是在 Chrome 浏览器的地址栏，键入 <code>chrome://inspect</code>或者<code>about:inspect</code>，回车后就可以看到下面的界面。</p>
<p><img src="https://www.ruanyifeng.com/blogimg/asset/2018/bg2018031903.png" alt="img"></p>
<p>在 Target 部分，点击 inspect 链接，就能进入调试工具了。</p>
<p>第二种进入调试工具的方法，是在 <a target="_blank" rel="noopener" href="http://127.0.0.1:3000/">http://127.0.0.1:3000</a> 的窗口打开”开发者工具”，顶部左上角有一个 Node 的绿色标志，点击就可以进入。</p>
<p><img src="https://www.ruanyifeng.com/blogimg/asset/2018/bg2018031904.png" alt="img"></p>
<h2 id="三、调试工具窗口"><a href="#三、调试工具窗口" class="headerlink" title="三、调试工具窗口"></a>三、调试工具窗口</h2><p>调试工具其实就是”开发者工具”的定制版，省去了那些对服务器脚本没用的部分。</p>
<p>它主要有四个面板。</p>
<blockquote>
<ul>
<li>Console：控制台</li>
<li>Memory：内存</li>
<li>Profiler：性能</li>
<li>Sources：源码</li>
</ul>
</blockquote>
<p><img src="https://www.ruanyifeng.com/blogimg/asset/2018/bg2018031905.png" alt="img"></p>
<p>这些面板的用法，基本上跟浏览器环境差不多，这里只介绍 Sources （源码）面板。</p>
<h2 id="四、设置断点"><a href="#四、设置断点" class="headerlink" title="四、设置断点"></a>四、设置断点</h2><p>进入 Sources 面板，找到正在运行的脚本<code>app.js</code>。</p>
<p><img src="https://www.ruanyifeng.com/blogimg/asset/2018/bg2018031906.png" alt="img"></p>
<p>在第11行（也就是下面这一行）的行号上点一下，就设置了一个断点。</p>
<blockquote>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'Hello '</span> <span class="token operator">+</span> name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</blockquote>
<p><img src="https://www.ruanyifeng.com/blogimg/asset/2018/bg2018031907.png" alt="img"></p>
<p>这时，浏览器访问 <a target="_blank" rel="noopener" href="http://127.0.0.1:3000/alice">http://127.0.0.1:3000/alice</a> ，页面会显示正在等待服务器返回。切换到调试工具，可以看到 Node 主线程处于暂停（paused）阶段。</p>
<p><img src="https://www.ruanyifeng.com/blogimg/asset/2018/bg2018031908.png" alt="img"></p>
<p>进入 Console 面板，输入 name，会返回 alice。这表明我们正处在断点处的上下文（context）。</p>
<p><img src="https://www.ruanyifeng.com/blogimg/asset/2018/bg2018031909.png" alt="img"></p>
<p>再切回 Sources 面板，右侧可以看到 Watch、Call Stack、Scope、Breakpoints 等折叠项。打开 Scope 折叠项，可以看到 Local 作用域和 Global 作用域里面的所有变量。</p>
<p>Local 作用域里面，变量<code>name</code>的值是<code>alice</code>，双击进入编辑状态，把它改成<code>bob</code>。</p>
<p><img src="https://www.ruanyifeng.com/blogimg/asset/2018/bg2018031910.png" alt="img"></p>
<p>然后，点击顶部工具栏的继续运行按钮。</p>
<p><img src="https://www.ruanyifeng.com/blogimg/asset/2018/bg2018031911.png" alt="img"></p>
<p>页面上就可以看到 Hello bob 了。</p>
<p><img src="https://www.ruanyifeng.com/blogimg/asset/2018/bg2018031912.png" alt="img"></p>
<p>命令行下，按下 ctrl + c，终止运行<code>app.js</code>。</p>
<h2 id="五、调试非服务脚本"><a href="#五、调试非服务脚本" class="headerlink" title="五、调试非服务脚本"></a>五、调试非服务脚本</h2><p>Web 服务脚本会一直在后台运行，但是大部分脚本只是处理某个任务，运行完就会终止。这时，你可能根本没有时间打开调试工具。等你打开了，脚本早就结束运行了。这时怎么调试呢？</p>
<blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ node --inspect<span class="token operator">=</span><span class="token number">9229</span> -e <span class="token string">"setTimeout(function() &#123; console.log('yes'); &#125;, 30000)"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</blockquote>
<p>上面代码中，<code>--inspect=9229</code>指定调试端口为 9229，这是调试工具默认的通信端口。<code>-e</code>参数指定一个字符串，作为代码运行。</p>
<p>访问<code>chrome://inspect</code>，就可以进入调试工具，调试这段代码了。</p>
<p><img src="https://www.ruanyifeng.com/blogimg/asset/2018/bg2018031913.png" alt="img"></p>
<p>代码放在<code>setTimeout</code>里面，总是不太方便。那些运行时间较短的脚本，可能根本来不及打开调试工具。这时就要使用下面的方法。</p>
<blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ node --inspect-brk<span class="token operator">=</span><span class="token number">9229</span> app.js<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</blockquote>
<p>上面代码中，<code>--inspect-brk</code>指定在第一行就设置断点。也就是说，一开始运行，就是暂停的状态。</p>
<h2 id="六、忘了写-–inspect-怎么办？"><a href="#六、忘了写-–inspect-怎么办？" class="headerlink" title="六、忘了写 –inspect 怎么办？"></a>六、忘了写 –inspect 怎么办？</h2><p>打开调试工具的前提是，启动 Node 脚本时就加上<code>--inspect</code>参数。如果忘了这个参数，还能不能调试呢？</p>
<p>回答是可以的。首先，正常启动脚本。</p>
<blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ node app.js<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</blockquote>
<p>然后，在另一个命令行窗口，查找上面脚本的进程号。</p>
<blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">ps</span> ax <span class="token operator">|</span> <span class="token function">grep</span> app.js 

<span class="token number">30464</span> pts/11   Sl+    <span class="token number">0</span>:00 node app.js
<span class="token number">30541</span> pts/12   S+     <span class="token number">0</span>:00 <span class="token function">grep</span> app.js<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</blockquote>
<p>上面命令中，<code>app.js</code>的进程号是<code>30464</code>。</p>
<p>接着，运行下面的命令。</p>
<blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ node -e <span class="token string">'process._debugProcess(30464)'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</blockquote>
<p>上面命令会建立进程 30464 与调试工具的连接，然后就可以打开调试工具了。</p>
<p>还有一种方法，就是向脚本进程发送 <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/13052548/node-js-how-to-attach-to-a-running-process-and-to-debug-the-server-with-a-conso">SIGUSR1</a> 信号，也可以建立调试连接。</p>
<blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">kill</span> -SIGUSR1 <span class="token number">30464</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</blockquote>
<h2 id="七、参考链接"><a href="#七、参考链接" class="headerlink" title="七、参考链接"></a>七、参考链接</h2><ul>
<li><a target="_blank" rel="noopener" href="https://medium.com/the-node-js-collection/debugging-node-js-with-google-chrome-4965b5f910f4">Debugging Node.js with Google Chrome</a>, by Jacopo Daeli</li>
<li><a target="_blank" rel="noopener" href="https://medium.com/@paul_irish/debugging-node-js-nightlies-with-chrome-devtools-7c4a1b95ae27">Debugging Node.js with Chrome DevTools</a>, by Paul Irish</li>
<li><a target="_blank" rel="noopener" href="https://remysharp.com/2018/03/03/last-minute-node-debugging">Last minute node debugging</a>, by Remy Sharp</li>
</ul>
<h1 id="VS-Code-调试"><a href="#VS-Code-调试" class="headerlink" title="VS Code 调试"></a>VS Code 调试</h1><p>Visual Studio Code（简称 VS Code）是一款微软开源的现代化、跨平台、轻量级的代码编辑器。VS Code 很好很强大，本节将介绍如何使用 VS Code 来调试 Node.js 代码。</p>
<h2 id="基本调试"><a href="#基本调试" class="headerlink" title="基本调试"></a>基本调试</h2><p>示例代码如下：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// app.js</span>
<span class="token keyword">const</span> Paloma <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'paloma'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Paloma</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token parameter">ctx</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'hello world!'</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>用 VS Code 加载 test 文件夹，打开 app.js，然后进行如下操作：</p>
<ol>
<li>单击左侧第 4 个 tab，切换到调试模式。</li>
<li>单击代码第 5 行 <code>ctx.body=&#39;hello world!&#39;</code> 左侧空白处添加断点。</li>
<li>单击左上角 ”调试“ 的绿色三角按钮启动调试。</li>
<li>单击左上角的终端图标打开调试控制台。</li>
</ol>
<p>最终如下所示：</p>
<p><img src="https://wizardforcel.gitbooks.io/node-in-debugging/content/assets/4.3.1.png" alt="img"></p>
<p>从 “调试控制台“ 切换到 ”终端“，运行：</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">$ curl localhost:3000<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>如下所示：</p>
<p><img src="https://wizardforcel.gitbooks.io/node-in-debugging/content/assets/4.3.2.png" alt="img"></p>
<p>可以看出，VS Code 基本覆盖了 Chrome DevTools 的所有功能，并且有两个额外的优点：</p>
<ol>
<li>集成了终端，不用再打开新的终端输入命令了。</li>
<li>调试动作里添加了 ”重启“ 和 ”停止“ 按钮，不用每次修改完代码后切回终端去重启了。</li>
</ol>
<p>但 VS Code 的强大远不止如此，通过 launch.json 可以配置详细的调试功能。</p>
<h2 id="launch-json"><a href="#launch-json" class="headerlink" title="launch.json"></a>launch.json</h2><p>上图可以看出，”调试“ 按钮右边有一个下拉菜单，默认是 ”没有配置“。单击右侧的齿轮状图标，会在项目根目录下创建 .vscode 文件夹及 launch.json 文件。launch.json 的内容如下：</p>
<p><img src="https://wizardforcel.gitbooks.io/node-in-debugging/content/assets/4.3.3.png" alt="img"></p>
<p>这个默认配置的意思是执行：</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">$ node $&#123;workspaceFolder&#125;&#x2F;app.js<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>launch.json 其实就是存储了一些调试相关的配置，VS Code 在启动调试时，会读取 launch.json 决定以何种方式调试。launch.json 有以下常用选项：</p>
<p>必需字段如下：</p>
<ul>
<li>type：调试器类型。这里是 node（内置的调试器），如果安装了 Go 和 PHP 的扩展后，则对应的 type 分别为 go 和 php。</li>
<li>request：请求的类型，支持 launch 和 attach。launch 就是以 debug 模式启动调试，attach 就是附加到已经启动的进程开启 debug 模式并调试，跟在上一小节中提到的用 <code>node -e &quot;process._debugProcess(PID)&quot;</code> 作用一样。</li>
<li>name：下拉菜单显示的名字。</li>
</ul>
<p>可选字段（括号里表示适用的类型）如下：</p>
<ul>
<li>program：可执行文件或者调试器要运行的文件 (launch)。</li>
<li>args：要传递给调试程序的参数 (launch)。</li>
<li>env：环境变量 (launch)。</li>
<li>cwd：当前执行目录 (launch)。</li>
<li>address：IP 地址 (launch &amp; attach)。</li>
<li>port：端口号 (launch &amp; attach)。</li>
<li>skipFiles：想要忽略的文件，数组类型 (launch &amp; attach)。</li>
<li>processId：进程 PID (attach)。</li>
<li>…</li>
</ul>
<p>变量替换：</p>
<ul>
<li>${workspaceFolder}：当前打开工程的路径。</li>
<li>${file}：当前打开文件的路径。</li>
<li>${fileBasename}：当前打开文件的名字，包含后缀名。</li>
<li>${fileDirname}：当前打开文件所在的文件夹的路径。</li>
<li>${fileExtname}：当前打开文件的后缀名。</li>
<li>${cwd}：当前执行目录。</li>
<li>…</li>
</ul>
<p>如果当前打开的文件是 app.js，则以下配置与默认配置是等效的：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
    <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"0.2.0"</span><span class="token punctuation">,</span>
    <span class="token property">"configurations"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"node"</span><span class="token punctuation">,</span>
            <span class="token property">"request"</span><span class="token operator">:</span> <span class="token string">"launch"</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"启动程序"</span><span class="token punctuation">,</span>
            <span class="token property">"program"</span><span class="token operator">:</span> <span class="token string">"$&#123;file&#125;"</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>若想了解更多的 launch.json 选项，则请查阅：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://code.visualstudio.com/docs/editor/debugging#_launchjson-attributes">Debugging in Visual Studio Code</a>。</li>
<li><a target="_blank" rel="noopener" href="https://code.visualstudio.com/docs/nodejs/nodejs-debugging#_launch-configuration-attributes">Debug Node.js Apps using VS Code</a>。</li>
</ul>
<p>下面以 5 个实用的技巧讲解部分 launch.json 配置的作用。</p>
<h2 id="技巧-1——条件断点"><a href="#技巧-1——条件断点" class="headerlink" title="技巧 1——条件断点"></a>技巧 1——条件断点</h2><p>VS Code 可以添加条件断点，即执行到该行代码满足特定条件后程序才会中断。在断点小红点上右键选择 ”编辑断点“，可以选择以下两种条件：</p>
<ol>
<li>表达式：当表达式计算结果为 true 时中断，例如设置：<code>ctx.query.name === &#39;nswbmw&#39;</code>，表示当访问 <code>localhost:3000?name=nswbmw</code> 时断点才会生效，其余请求断点无效。</li>
<li>命中次数：同样当表达式计算结果为 true 时中断，支持运算符 &lt;、&lt;=、==、&gt;、&gt;=、%。例如：<ol>
<li>&gt;10：执行 10 次以后，断点才会生效。</li>
<li>&lt;3：只有前 2 次断点会生效。</li>
<li>10：等价于 &gt;=10。</li>
<li>%2：隔一次中断一次。</li>
</ol>
</li>
</ol>
<p><strong>注意</strong>：可以组合表达式和命中次数条件一起使用。在切换条件类型时，需要将原来的条件清空，否则会添加两种条件。将鼠标悬浮在断点上，可以查看设置了哪些条件。</p>
<h2 id="技巧-2——skipFiles"><a href="#技巧-2——skipFiles" class="headerlink" title="技巧 2——skipFiles"></a>技巧 2——skipFiles</h2><p>从上面图中可以看到，在 VS Code 左侧有一个 ”调用堆栈“ 面板，显示了当前断点的调用堆栈，但无法直观地看出哪些是我们项目的代码，哪些是 node_modules 里模块的代码，而且在单步调试时会进入到 node_modules 里。总之，我们不关心 node_modules 里的代码，我们只关心项目本身的代码。这时，skipFiles 就派上用场了。</p>
<p>skipFiles 顾名思义就是忽略我们不关心的文件。修改 launch.json 如下：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
    <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"0.2.0"</span><span class="token punctuation">,</span>
    <span class="token property">"configurations"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"node"</span><span class="token punctuation">,</span>
            <span class="token property">"request"</span><span class="token operator">:</span> <span class="token string">"launch"</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"启动程序"</span><span class="token punctuation">,</span>
            <span class="token property">"program"</span><span class="token operator">:</span> <span class="token string">"$&#123;workspaceFolder&#125;/app.js"</span><span class="token punctuation">,</span>
            <span class="token property">"skipFiles"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">"$&#123;workspaceFolder&#125;/node_modules/**/*.js"</span><span class="token punctuation">,</span>
                <span class="token string">"&lt;node_internals>/**/*.js"</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>有以下几点需要解释：</p>
<ol>
<li>支持 ${xxx} 这种变量替换。</li>
<li>支持 glob 模式匹配。</li>
<li>用来忽略 Node.js 核心模块。</li>
</ol>
<p>重启调试后，如下所示：</p>
<p><img src="https://wizardforcel.gitbooks.io/node-in-debugging/content/assets/4.3.4.png" alt="img"></p>
<p><strong>可以看出</strong>：在左侧 ”调用堆栈“ 中，我们不关心的调用栈都变灰了，而且单步调试也不会进入到 skipFiles 所匹配的文件里。</p>
<h2 id="技巧-3——自动重启"><a href="#技巧-3——自动重启" class="headerlink" title="技巧 3——自动重启"></a>技巧 3——自动重启</h2><p>在每次修改代码保存后都要手动重启，否则修改后的代码和断点都不会生效。VS Code 开发者们想到了这一点，通过添加配置可以实现修改代码保存后会自动重启调试，需要结合 <a target="_blank" rel="noopener" href="https://nodemon.io/">nodemon</a> 一起使用。</p>
<p>首先，全局安装 nodemon：</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">$ npm i nodemon -g<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>然后，修改 launch.json：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
    <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"0.2.0"</span><span class="token punctuation">,</span>
    <span class="token property">"configurations"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"node"</span><span class="token punctuation">,</span>
            <span class="token property">"request"</span><span class="token operator">:</span> <span class="token string">"launch"</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"启动程序"</span><span class="token punctuation">,</span>
            <span class="token property">"runtimeExecutable"</span><span class="token operator">:</span> <span class="token string">"nodemon"</span><span class="token punctuation">,</span>
            <span class="token property">"program"</span><span class="token operator">:</span> <span class="token string">"$&#123;workspaceFolder&#125;/app.js"</span><span class="token punctuation">,</span>
            <span class="token property">"restart"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token property">"console"</span><span class="token operator">:</span> <span class="token string">"integratedTerminal"</span><span class="token punctuation">,</span>
            <span class="token property">"skipFiles"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">"$&#123;workspaceFolder&#125;/node_modules/**/*.js"</span><span class="token punctuation">,</span>
                <span class="token string">"&lt;node_internals>/**/*.js"</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>当前的 launch.json 相比较上一个版本的 launch.json，多了以下几个字段：</p>
<ul>
<li>runtimeExecutable：用什么命令执行 app.js，这里设置为 nodemon。</li>
<li>restart：设置为 true，修改代码并保存后会自动重启调试。</li>
<li>console：当单击停止按钮或者修改代码并保存后自动重启调试，而 nodemon 是仍然在运行的，通过设置为 console 为 integratedTerminal 可以解决这个问题。此时 VS Code 终端将会打印 nodemon 的 log，可以在终端右侧的下拉菜单中选择返回第 1 个终端，然后运行 <code>curl localhost:3000</code> 进行调试。</li>
</ul>
<p>对于已经使用 nodemon 运行的程序，例如：</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">$ nodemon --inspect app.js<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>可使用 attach 模式启动调试，launch.json 如下：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
    <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"0.2.0"</span><span class="token punctuation">,</span>
    <span class="token property">"configurations"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Attach to node"</span><span class="token punctuation">,</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"node"</span><span class="token punctuation">,</span>
            <span class="token property">"request"</span><span class="token operator">:</span> <span class="token string">"attach"</span><span class="token punctuation">,</span>
            <span class="token property">"restart"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token property">"processId"</span><span class="token operator">:</span> <span class="token string">"$&#123;command:PickProcess&#125;"</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>运行 Attach to node 配置进行调试时，VS Code 会列出正在执行的 node 进程及对应的 PID 以供选择。也可以通过 address 和 port 参数设置 attach 到具体的进程开启调试。</p>
<h2 id="技巧-4——特定操作系统设置"><a href="#技巧-4——特定操作系统设置" class="headerlink" title="技巧 4——特定操作系统设置"></a>技巧 4——特定操作系统设置</h2><p>针对不同的操作系统，可能会用到不同的调试配置。可选的参数为：</p>
<ul>
<li>windows</li>
<li>linux</li>
<li>osx</li>
</ul>
<p>示例如下：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
    <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"0.2.0"</span><span class="token punctuation">,</span>
    <span class="token property">"configurations"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"node"</span><span class="token punctuation">,</span>
            <span class="token property">"request"</span><span class="token operator">:</span> <span class="token string">"launch"</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"启动调试"</span><span class="token punctuation">,</span>
            <span class="token property">"program"</span><span class="token operator">:</span> <span class="token string">"./node_modules/gulp/bin/gulpfile.js"</span><span class="token punctuation">,</span>
            <span class="token property">"args"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"/path/to/app.js"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">"windows"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                <span class="token property">"args"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"\\path\\to\\app.js"</span><span class="token punctuation">]</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="技巧-5——多配置"><a href="#技巧-5——多配置" class="headerlink" title="技巧 5——多配置"></a>技巧 5——多配置</h2><p>configurations 是个数组而不是个对象，这样设计就是为了可以添加多个调试配置。打开 launch.json，单击右下角的 ”添加配置…“，会弹出配置模板，如下所示：</p>
<p><img src="https://wizardforcel.gitbooks.io/node-in-debugging/content/assets/4.3.5.png" alt="img"></p>
<p>configurations 可以用来配置不同的调试规则，比如最终将 launch.json 修改如下：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
    <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"0.2.0"</span><span class="token punctuation">,</span>
    <span class="token property">"configurations"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"node"</span><span class="token punctuation">,</span>
            <span class="token property">"request"</span><span class="token operator">:</span> <span class="token string">"attach"</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Attach to node"</span><span class="token punctuation">,</span>
            <span class="token property">"restart"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token property">"processId"</span><span class="token operator">:</span> <span class="token string">"$&#123;command:PickProcess&#125;"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"node"</span><span class="token punctuation">,</span>
            <span class="token property">"request"</span><span class="token operator">:</span> <span class="token string">"launch"</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"启动程序"</span><span class="token punctuation">,</span>
            <span class="token property">"runtimeExecutable"</span><span class="token operator">:</span> <span class="token string">"nodemon"</span><span class="token punctuation">,</span>
            <span class="token property">"program"</span><span class="token operator">:</span> <span class="token string">"$&#123;workspaceFolder&#125;/app.js"</span><span class="token punctuation">,</span>
            <span class="token property">"restart"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token property">"console"</span><span class="token operator">:</span> <span class="token string">"integratedTerminal"</span><span class="token punctuation">,</span>
            <span class="token property">"skipFiles"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">"$&#123;workspaceFolder&#125;/node_modules/**/*.js"</span><span class="token punctuation">,</span>
                <span class="token string">"&lt;node_internals>/**/*.js"</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>VS Code 的调试功能十分强大，本节只讲解了一些常用的调试功能，对于其余的调试功能，还请读者自行尝试。</p>
<h1 id="TypeScript-调试"><a href="#TypeScript-调试" class="headerlink" title="TypeScript 调试"></a>TypeScript 调试</h1><p>VS Code 内置的 Node.js 的调试器支持 <strong>JavaScript Source Map</strong>，可以结合 Source Map 调试转译前的代码，如 TypeScript，压缩混淆的 JavaScript 代码等都可以利用 Source Map 的支持调试源码。</p>
<p>我准备了一个简单的 <a href="https://link.juejin.cn/?target=https://github.com/chhpt/node-debug">TS Server Demo</a>，可以直接 Clone 源码本地测试。下面是项目中的 <code>src/index.ts</code> 文件，创建了一个 HTTP Server</p>
<pre class="line-numbers language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> http <span class="token keyword">from</span> <span class="token string">"http"</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> reqCount <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

http
  <span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Request Count: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>reqCount<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

    res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token string">"Content-Type"</span><span class="token operator">:</span> <span class="token string">"text/html"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;html>&lt;body></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>message<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">&lt;/body>&lt;/html></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"handled request: "</span> <span class="token operator">+</span> reqCount<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"server running on port 3000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>创建 <code>tsconfig.json</code> 配置，配置编译生成 Source Map</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"outDir"</span><span class="token operator">:</span> <span class="token string">"./dist"</span><span class="token punctuation">,</span>
    <span class="token property">"sourceMap"</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"include"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"src/**/*"</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用 <code>tsc</code> 编译一下，生成 JS 代码：<code>dist/index.js</code>，创建调试配置，入口文件为 <code>dist/index.js</code></p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"node"</span><span class="token punctuation">,</span>
  <span class="token property">"request"</span><span class="token operator">:</span> <span class="token string">"launch"</span><span class="token punctuation">,</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Launch Program"</span><span class="token punctuation">,</span>
  <span class="token property">"program"</span><span class="token operator">:</span> <span class="token string">"$&#123;workspaceFolder&#125;/dist/index.js"</span><span class="token punctuation">,</span>
  <span class="token property">"skipFiles"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"&lt;node_internals>/**"</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span>
复制代码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>然后打断点，启动调试，浏览器访问 <code>http://localhost:3000</code>，即可看到调试进入了 TS 文件</p>
<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/26/172efe59f8115352~tplv-t2oaga2asx-watermark.awebp" alt="img"></p>
<h1 id="远程调试"><a href="#远程调试" class="headerlink" title="远程调试"></a>远程调试</h1><p>当我们需要在真实的服务器等远程运行环境调试 Node.js 时，我们可以利用上面提到的方式，在服务器上开启 Node.js 调试功能，并在本地连接上远程的调试端口进行调试。</p>
<p>VS Code 默认支持远程调试，我们需要 <code>launch.json</code> 配置文件中指定远程服务的 IP 地址以及端口，如下所示：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"node"</span><span class="token punctuation">,</span>
  <span class="token property">"request"</span><span class="token operator">:</span> <span class="token string">"attach"</span><span class="token punctuation">,</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"远程调试"</span><span class="token punctuation">,</span>
  <span class="token property">"address"</span><span class="token operator">:</span> <span class="token string">"IP 地址"</span><span class="token punctuation">,</span>
  <span class="token property">"port"</span><span class="token operator">:</span> <span class="token string">"9229"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>VS Code 会自动加载远程的文件，展示为只读代码供调试使用。</p>
<p>如果想要在调试的过程中编辑源代码，或者更好的调试体验，可以在远程文件夹和本地项目之间设置一个映射。VS Code 提供了 <code>localRoot</code> 和 <code>remoteRoot</code> 属性来映射本地 VS Code 项目和（远程）Node.js 文件夹：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"node"</span><span class="token punctuation">,</span>
  <span class="token property">"request"</span><span class="token operator">:</span> <span class="token string">"attach"</span><span class="token punctuation">,</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"远程调试"</span><span class="token punctuation">,</span>
  <span class="token property">"address"</span><span class="token operator">:</span> <span class="token string">"IP 地址"</span><span class="token punctuation">,</span>
  <span class="token property">"port"</span><span class="token operator">:</span> <span class="token string">"9229"</span><span class="token punctuation">,</span>
  <span class="token property">"localRoot"</span><span class="token operator">:</span> <span class="token string">"$&#123;workspaceFolder&#125;/src"</span><span class="token punctuation">,</span>
  <span class="token property">"remoteRoot"</span><span class="token operator">:</span> <span class="token string">"/var/user/"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在建立映射关系后，即可在本地项目进行断点调试，远程的断点信息会同步到本地项目，使用起来十分方便。</p>
<h1 id="子进程调试"><a href="#子进程调试" class="headerlink" title="子进程调试"></a>子进程调试</h1><p>与普通进程调试原理一致，子进程调试时也需要传入 <code>--inspect</code> 参数，这一点需要特别注意，否则无法启动子进程调试。</p>
<p>如下通过子进程启动 <code>Server</code> 的例子：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// fork.js 文件</span>
<span class="token keyword">const</span> <span class="token punctuation">&#123;</span> spawn <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"child_process"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> sp <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">"node"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"./fork_server.js"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"父进程 PID"</span><span class="token punctuation">,</span> sp<span class="token punctuation">.</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>

sp<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">stdout: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>data<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

sp<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">stderr: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>data<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>如果直接使用 <code>node --inspect</code> 启动主进程的话，会发现只显示了主进程的调试端口，这就是因为我们在程序中启动子进程时没有传递 <code>--inspect</code> 选项导致的。</p>
<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/26/172efe5a0a9b20f7~tplv-t2oaga2asx-watermark.awebp" alt="img"></p>
<p>这里我们在启动进程时添加上 <code>--inspect</code> 参数，同时注意要指定一个默认 <code>9229</code> 端口之外的端口号，避免调试端口冲突</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">-</span> <span class="token keyword">const</span> sp <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">"node"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"./fork_server.js"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span> <span class="token keyword">const</span> sp <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">"node"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"--inspect=9230"</span><span class="token punctuation">,</span> <span class="token string">"./fork_server.js"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>再次启动，就能看到两个调试信息输出了</p>
<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/26/172efe5a18704d54~tplv-t2oaga2asx-watermark.awebp" alt="img"></p>
<p>当然，怎么能少得了强大的 VS Code 呢。VS Code 的 Node 调试器提供了一种机制，可以追踪所有子进程，并在调试模式下，自动链接进程。可以通过 <code>autoAttachChildProcesses</code> 属性开启此机制：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"node"</span><span class="token punctuation">,</span>
  <span class="token property">"request"</span><span class="token operator">:</span> <span class="token string">"launch"</span><span class="token punctuation">,</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"启动程序"</span><span class="token punctuation">,</span>
  <span class="token property">"program"</span><span class="token operator">:</span> <span class="token string">"$&#123;workspaceFolder&#125;/fork.js"</span><span class="token punctuation">,</span>
  <span class="token property">"autoAttachChildProcesses"</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>启动后，即可对父进程，或子进程进行断点调试，效果如下</p>
<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/26/172efe5a27b86eb9~tplv-t2oaga2asx-watermark.awebp" alt="img"></p>
<h1 id="调试工具"><a href="#调试工具" class="headerlink" title="调试工具"></a>调试工具</h1><p>调试不只是打断点，我们在开发过程中往往还会有其他方面的需求，比如：</p>
<ul>
<li>如何快速地切换输出的日志类型（或级别）?</li>
<li>我想用 moment 打印出年份，是使用 <code>moment().format(&#39;YYYY&#39;)</code>，还是 <code>moment().format(&#39;yyyy&#39;)</code>，还是两种写法都可以?</li>
<li>断言报错：AssertionError: false == true，没啥有用信息，黑人问号???</li>
</ul>
<p>这里将介绍 3 款实用的调试工具，分别解决以上 3 种情况，来提高我们的调试效率。</p>
<h2 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h2><p>debug 是一个小巧却非常实用的日志模块，可以根据环境变量决定打印不同类型（或级别）的日志。代码如下：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// app.js</span>
<span class="token keyword">const</span> normalLog <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'debug'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'log'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> errorLowLog <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'debug'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'error:low'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> errorNormalLog <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'debug'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'error:normal'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> errorHighLog <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'debug'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'error:high'</span><span class="token punctuation">)</span>

<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> value <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> value <span class="token operator">&lt;</span> <span class="token number">0.5</span><span class="token operator">:</span> <span class="token function">normalLog</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span>
    <span class="token keyword">case</span> value <span class="token operator">>=</span> <span class="token number">0.5</span> <span class="token operator">&amp;&amp;</span> value <span class="token operator">&lt;</span> <span class="token number">0.7</span><span class="token operator">:</span> <span class="token function">errorLowLog</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span>
    <span class="token keyword">case</span> value <span class="token operator">>=</span> <span class="token number">0.7</span> <span class="token operator">&amp;&amp;</span> value <span class="token operator">&lt;</span> <span class="token number">0.9</span><span class="token operator">:</span> <span class="token function">errorNormalLog</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span>
    <span class="token keyword">case</span> value <span class="token operator">>=</span> <span class="token number">0.9</span><span class="token operator">:</span> <span class="token function">errorHighLog</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token function">normalLog</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>运行上面的代码，每一秒生成一个随机数，根据随机数的值模拟不同级别的日志输出：</p>
<ul>
<li>&lt; 0.5：正常日志。</li>
<li>0.5~0.7：低级别的错误日志。</li>
<li>0.7~0.9：一般级别的错误日志。</li>
<li>&gt;= 0.9：严重级别的错误日志。</li>
</ul>
<p>运行：</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">$ DEBUG&#x3D;* node app.js<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>打印如下：</p>
<p><img src="https://wizardforcel.gitbooks.io/node-in-debugging/content/assets/4.4.1.jpg" alt="img"></p>
<p>可以看出，debug 模块打印的日志与 console.log 相比，有以下几个特点：</p>
<ol>
<li>不同的日志类型分配了不同的颜色加以区分，更直观。</li>
<li>添加了日志类型的前缀。</li>
<li>添加了自上一次该类型日志打印到这次日志打印经历了多长时间的后缀。</li>
</ol>
<p>debug 模块支持以下用法：</p>
<ul>
<li>DEBUG=*：打印所有类型的日志。</li>
<li>DEBUG=log：只打印 log 类型的日志。</li>
<li>DEBUG=error:*：打印所有以 error: 开头的日志。</li>
<li>DEBUG=error:*,-error:low：打印所有以 error: 开头的并且过滤掉 error:low 类型的日志。</li>
</ul>
<p>下面演示一下第 4 种的用法，运行：</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">$ DEBUG&#x3D;error:*,-error:low node app.js<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>打印如下：</p>
<p><img src="https://wizardforcel.gitbooks.io/node-in-debugging/content/assets/4.4.2.jpg" alt="img"></p>
<h2 id="repl2"><a href="#repl2" class="headerlink" title="repl2"></a>repl2</h2><p>我们在写代码时，有时可能记不清某个模块的某个方法的具体用法，比如：用 moment 格式化年份是用 <code>moment().format(&#39;YYYY&#39;)</code> 还是用 <code>moment().format(&#39;yyyy&#39;)</code> 还是两种写法都可以？lodash 的 <code>_.pick</code> 方法能否能接收数组作为参数？这个时候相对于翻阅官方文档，在 REPL 里试一下可能会更快，通常步骤是：</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">$ npm i moment
$ node
&gt; const moment &#x3D; require(&#39;moment&#39;)
&gt; moment().format(&#39;YYYY&#39;)
&#39;2017&#39;
&gt; moment().format(&#39;yyyy&#39;)
&#39;yyyy&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>一次还好，次数多了也略微烦琐。repl2 模块便是为了解决这个问题而生的。</p>
<p>repl2 顾名思义是 REPL 的增强版，repl2 会根据一个用户配置（~/.noderc），预先加载模块到 REPL 中，省下了我们手动在 REPL 中 require 模块的过程。</p>
<p>全局安装 repl2：</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">$ npm i repl2 -g<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>使用方式很简单:</p>
<ol>
<li>将常用的模块全局安装，例如：</li>
</ol>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">$ npm i lodash validator moment -g<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol>
<li>添加配置到 ~/.noderc：</li>
</ol>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"lodash"</span><span class="token operator">:</span> <span class="token string">"__"</span><span class="token punctuation">,</span>
  <span class="token property">"moment"</span><span class="token operator">:</span> <span class="token string">"moment"</span><span class="token punctuation">,</span>
  <span class="token property">"validator"</span><span class="token operator">:</span> <span class="token string">"validator"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol>
<li>运行 noder：</li>
</ol>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">$ noder
__ &#x3D; lodash@4.17.4 -&gt; local
moment &#x3D; moment@2.18.1 -&gt; global
validator &#x3D; validator@7.0.0 -&gt; global
&gt; moment().format(&#39;YYYY&#39;)
&#39;2017&#39;
&gt; __.random(0, 5)
3
&gt; validator.isEmail(&#39;foo@bar.com&#39;)
true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>需要讲解以下几点：</p>
<ol>
<li>~/.noderc 是一个 JSON 文件，key 是模块的名字，value 是 require 这个模块后加载到 REPL 中的变量名。这里给 lodash 命名的变量名是 <em>_ 而不是</em> ，是因为 REPL 中 _ 有特殊含义，表示上一个表达式的结果。</li>
<li>repl2 会优先加载当前目录下的模块，没有找到然后再去加载全局安装的模块。上面结果显示 lodash 是从本地目录加载的，因为 test 目录下已经安装了 lodash，其余的模块没有从本地目录找到则尝试从全局 npm 目录加载。如果都没有找到，则不会加载。</li>
</ol>
<h2 id="power-assert"><a href="#power-assert" class="headerlink" title="power-assert"></a>power-assert</h2><p>我们常用的断言库有：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/shouldjs/should.js">should.js</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Automattic/expect.js">expect.js</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/chaijs/chai">chai</a></li>
</ul>
<p>但这类断言库都有一些通病：</p>
<ol>
<li>过分追求语义化，API 复杂。</li>
<li>错误信息不足。</li>
</ol>
<p>先看一段代码：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// test.js</span>
<span class="token keyword">const</span> assert <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'assert'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> should <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'should'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> expect <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'expect.js'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> tom <span class="token operator">=</span> <span class="token punctuation">&#123;</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">18</span> <span class="token punctuation">&#125;</span>
<span class="token keyword">const</span> bob <span class="token operator">=</span> <span class="token punctuation">&#123;</span> id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">&#125;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'app.js'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'assert'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">assert</span><span class="token punctuation">(</span>tom<span class="token punctuation">.</span>age <span class="token operator">></span> bob<span class="token punctuation">.</span>age<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should.js'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    tom<span class="token punctuation">.</span>age<span class="token punctuation">.</span>should<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">above</span><span class="token punctuation">(</span>bob<span class="token punctuation">.</span>age<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'expect.js'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>tom<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">above</span><span class="token punctuation">(</span>bob<span class="token punctuation">.</span>age<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>运行：</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">$ mocha<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>结果如下：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">app<span class="token punctuation">.</span>js
  <span class="token number">1</span><span class="token punctuation">)</span> assert
  <span class="token number">2</span><span class="token punctuation">)</span> should<span class="token punctuation">.</span>js
  <span class="token number">3</span><span class="token punctuation">)</span> expect<span class="token punctuation">.</span>js


<span class="token number">0</span> <span class="token function">passing</span> <span class="token punctuation">(</span><span class="token number">13</span>ms<span class="token punctuation">)</span>
<span class="token number">3</span> failing

<span class="token number">1</span><span class="token punctuation">)</span> app<span class="token punctuation">.</span>js
     assert<span class="token operator">:</span>

    AssertionError <span class="token punctuation">[</span><span class="token constant">ERR_ASSERTION</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token operator">==</span> <span class="token boolean">true</span>
    <span class="token operator">+</span> expected <span class="token operator">-</span> actual

    <span class="token operator">-</span><span class="token boolean">false</span>
    <span class="token operator">+</span><span class="token boolean">true</span>

    at Context<span class="token punctuation">.</span><span class="token function">it</span> <span class="token punctuation">(</span>test<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">10</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">)</span>

<span class="token number">2</span><span class="token punctuation">)</span> app<span class="token punctuation">.</span>js
     should<span class="token punctuation">.</span>js<span class="token operator">:</span>
   AssertionError<span class="token operator">:</span> expected <span class="token number">18</span> to be above <span class="token number">20</span>
    at Assertion<span class="token punctuation">.</span><span class="token function">fail</span> <span class="token punctuation">(</span>node_modules<span class="token operator">/</span>should<span class="token operator">/</span>cjs<span class="token operator">/</span>should<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">275</span><span class="token operator">:</span><span class="token number">17</span><span class="token punctuation">)</span>
    at Assertion<span class="token punctuation">.</span><span class="token function">value</span> <span class="token punctuation">(</span>node_modules<span class="token operator">/</span>should<span class="token operator">/</span>cjs<span class="token operator">/</span>should<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">356</span><span class="token operator">:</span><span class="token number">19</span><span class="token punctuation">)</span>
    at Context<span class="token punctuation">.</span><span class="token function">it</span> <span class="token punctuation">(</span>test<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">13</span><span class="token operator">:</span><span class="token number">23</span><span class="token punctuation">)</span>

<span class="token number">3</span><span class="token punctuation">)</span> app<span class="token punctuation">.</span>js
     expect<span class="token punctuation">.</span>js<span class="token operator">:</span>
   Error<span class="token operator">:</span> expected <span class="token number">18</span> to be above <span class="token number">20</span>
    at Assertion<span class="token punctuation">.</span><span class="token function">assert</span> <span class="token punctuation">(</span>node_modules<span class="token operator">/</span>expect<span class="token punctuation">.</span>js<span class="token operator">/</span>index<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">96</span><span class="token operator">:</span><span class="token number">13</span><span class="token punctuation">)</span>
    at Assertion<span class="token punctuation">.</span>greaterThan<span class="token punctuation">.</span>Assertion<span class="token punctuation">.</span><span class="token function">above</span> <span class="token punctuation">(</span>node_modules<span class="token operator">/</span>expect<span class="token punctuation">.</span>js<span class="token operator">/</span>index<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">297</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">)</span>
    at Function<span class="token punctuation">.</span><span class="token function">above</span> <span class="token punctuation">(</span>node_modules<span class="token operator">/</span>expect<span class="token punctuation">.</span>js<span class="token operator">/</span>index<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">499</span><span class="token operator">:</span><span class="token number">17</span><span class="token punctuation">)</span>
    at Context<span class="token punctuation">.</span><span class="token function">it</span> <span class="token punctuation">(</span>test<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">24</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可以看出，基本没有有用的信息。这时，power-assert 粉墨登场。</p>
<p>power-assert 使用起来很简单，理论上只用一个 assert 就可以了，而且可以无缝迁移。</p>
<p><strong>注意</strong>：在使用 intelli-espower-loader 时，要求必须将测试文件放到 test/ 目录下，所以我们在 test 目录下创建 test/app.js，将原来的 test.js 代码粘贴过去。</p>
<p>安装 power-assert 和 intelli-espower-loader，然后运行测试：</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">$ npm i power-assert intelli-espower-loader --save-dev
$ mocha -r intelli-espower-loader<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>结果如下：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">app<span class="token punctuation">.</span>js
  <span class="token number">1</span><span class="token punctuation">)</span> assert
  <span class="token number">2</span><span class="token punctuation">)</span> should<span class="token punctuation">.</span>js
  <span class="token number">3</span><span class="token punctuation">)</span> expect<span class="token punctuation">.</span>js


<span class="token number">0</span> <span class="token function">passing</span> <span class="token punctuation">(</span><span class="token number">42</span>ms<span class="token punctuation">)</span>
<span class="token number">3</span> failing

<span class="token number">1</span><span class="token punctuation">)</span> app<span class="token punctuation">.</span>js
     assert<span class="token operator">:</span>

    AssertionError <span class="token punctuation">[</span><span class="token constant">ERR_ASSERTION</span><span class="token punctuation">]</span><span class="token operator">:</span>   # test<span class="token operator">/</span>app<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">10</span>

<span class="token function">assert</span><span class="token punctuation">(</span>tom<span class="token punctuation">.</span>age <span class="token operator">></span> bob<span class="token punctuation">.</span>age<span class="token punctuation">)</span>
       <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span> <span class="token operator">|</span>   <span class="token operator">|</span>
       <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span> <span class="token operator">|</span>   <span class="token number">20</span>
       <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span> Object<span class="token punctuation">&#123;</span>id<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span>age<span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">&#125;</span>
       <span class="token operator">|</span>   <span class="token number">18</span>  <span class="token boolean">false</span>
       Object<span class="token punctuation">&#123;</span>id<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>age<span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">&#125;</span>

    <span class="token operator">+</span> expected <span class="token operator">-</span> actual

    <span class="token operator">-</span><span class="token boolean">false</span>
    <span class="token operator">+</span><span class="token boolean">true</span>
    <span class="token operator">...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>错误信息非常直观，有以下两点需要说明：</p>
<ol>
<li>mocha 需要引入 intelli-espower-loader，主要是转译代码，转译之后 <code>require(&#39;assert&#39;)</code> 都不需要改。</li>
<li>intelli-espower-loader 可选择地在 package.json 中添加 directories.test 配置，例如：</li>
</ol>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token property">"directories"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
  <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"mytest/"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>如果没有 directories.test 配置，则默认是 <code>test/</code>。</p>
<h1 id="Android-调试"><a href="#Android-调试" class="headerlink" title="# Android 调试"></a># Android 调试</h1><h2 id="USB-有线调试"><a href="#USB-有线调试" class="headerlink" title="USB 有线调试"></a>USB 有线调试</h2><h2 id="无线调试"><a href="#无线调试" class="headerlink" title="无线调试"></a>无线调试</h2>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zheyizhifeng.github.io/2021/10/18/%E6%92%B8%E4%B8%80%E4%B8%AA%20VS%20Code%20Extension/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="lucida">
      <meta itemprop="description" content="文质彬彬，然后君子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucida's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/10/18/%E6%92%B8%E4%B8%80%E4%B8%AA%20VS%20Code%20Extension/" class="post-title-link" itemprop="url">撸一个 VSCode Extension</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-10-18 15:25:03" itemprop="dateCreated datePublished" datetime="2021-10-18T15:25:03+08:00">2021-10-18</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-10-22 11:16:42" itemprop="dateModified" datetime="2021-10-22T11:16:42+08:00">2021-10-22</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Tools/" itemprop="url" rel="index"><span itemprop="name">Tools</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Tools/VSCode/" itemprop="url" rel="index"><span itemprop="name">VSCode</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>工欲善其事，必先利其器</p>
</blockquote>
<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>Visual Studio Code (以下简称 VSCode) 是一个轻量且强大的跨平台开源代码编辑器。VSCode 采用了 Electron 技术，使用的代码编辑器名为 Monaco，Monaco 也是 Visual Studio Team Service（Visual Studio Online）使用的代码编辑器，在开发语言上，VSCode 使用了自家的 TypeScript 语言进行开发。</p>
<p>VSCode提供了强大的插件拓展机制，并提供 <a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/">插件市场</a> 供开发者发布、下载插件。VSCode 提供了丰富的扩展能力模型，例如基础的语法高亮、API 提示、引用跳转（转到定义）、文件搜索、主题定制、高级的 Debug 协议等等，但不允许插件直接访问底层 UI DOM (即很难定制 VSCode 外观)。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/10/18/%E6%92%B8%E4%B8%80%E4%B8%AA%20VS%20Code%20Extension/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zheyizhifeng.github.io/2021/10/16/%E6%B1%82%E5%A9%9ATODO/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="lucida">
      <meta itemprop="description" content="文质彬彬，然后君子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucida's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/10/16/%E6%B1%82%E5%A9%9ATODO/" class="post-title-link" itemprop="url">求婚TODO</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-10-16 17:21:37" itemprop="dateCreated datePublished" datetime="2021-10-16T17:21:37+08:00">2021-10-16</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-11-11 12:59:36" itemprop="dateModified" datetime="2022-11-11T12:59:36+08:00">2022-11-11</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Life/" itemprop="url" rel="index"><span itemprop="name">Life</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Todo-List"><a href="#Todo-List" class="headerlink" title="Todo List"></a>Todo List</h1><ul>
<li><p><input checked="" disabled="" type="checkbox">  戒指</p>
</li>
<li><p><input checked="" disabled="" type="checkbox">  视频</p>
<p><strong>出现人物</strong></p>
<ul>
<li><input checked="" disabled="" type="checkbox"> 家人：爸爸妈妈、弟弟</li>
<li><input checked="" disabled="" type="checkbox"> 妹妹：黎梦圆</li>
<li><input checked="" disabled="" type="checkbox"> 闺蜜：芝芝</li>
<li><input checked="" disabled="" type="checkbox"> 老家好友：叶子、豹子、虎子、小爷阿文</li>
<li><input checked="" disabled="" type="checkbox"> 大学好友：蛙牛、马狗【马狗未发】</li>
<li><input checked="" disabled="" type="checkbox"> 北京好友 1：201 全体</li>
<li><input disabled="" type="checkbox"> 北京好友 2：国粹交流群全体</li>
</ul>
</li>
<li><p><input checked="" disabled="" type="checkbox">  场地：西二旗 北青 轰趴馆</p>
</li>
<li><p><input checked="" disabled="" type="checkbox">  布置道具：PDD 月亮代表我的心套餐</p>
</li>
<li><p><input checked="" disabled="" type="checkbox">  台词：</p>
</li>
<li><p><input checked="" disabled="" type="checkbox">  独白BGM：赵海洋 ——《夜色钢琴曲》人生的旅途</p>
</li>
<li><p><input checked="" disabled="" type="checkbox">  求婚音乐：齐晨——《咱们结婚吧》</p>
</li>
<li><p><input checked="" disabled="" type="checkbox">  照片：50 张</p>
</li>
<li><p><input disabled="" type="checkbox">  生日蛋糕：</p>
</li>
<li><p><input disabled="" type="checkbox">  鲜花：</p>
</li>
<li><p><input disabled="" type="checkbox">  服装：</p>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zheyizhifeng.github.io/2021/10/15/%E3%80%8A%E5%A4%A7%E5%89%8D%E7%AB%AF%E8%BF%9B%E9%98%B6%20%E5%AE%89%E5%85%A8%E3%80%8B%E7%B3%BB%E5%88%97%20HTTPS%20%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="lucida">
      <meta itemprop="description" content="文质彬彬，然后君子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucida's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/10/15/%E3%80%8A%E5%A4%A7%E5%89%8D%E7%AB%AF%E8%BF%9B%E9%98%B6%20%E5%AE%89%E5%85%A8%E3%80%8B%E7%B3%BB%E5%88%97%20HTTPS%20%E8%AF%A6%E8%A7%A3/" class="post-title-link" itemprop="url">《大前端进阶 安全》系列 HTTPS 详解</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-10-15 17:21:37" itemprop="dateCreated datePublished" datetime="2021-10-15T17:21:37+08:00">2021-10-15</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-10-18 12:05:46" itemprop="dateModified" datetime="2021-10-18T12:05:46+08:00">2021-10-18</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/" itemprop="url" rel="index"><span itemprop="name">网络通信</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>转载自掘金，原文链接 <a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904127420432391">点这里查看</a></p>
<hr>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><blockquote>
<p>Coding 应当是一生的事业，而不仅仅是 30 岁的青春饭<br>本文已收录 <a href="https://link.juejin.cn/?target=https://github.com/ponkans/F2E">GitHub https://github.com/ponkans/F2E</a>，欢迎 Star，持续更新</p>
</blockquote>
<p>每篇文章都希望你能收获到东西，这篇将带你<strong>深入 HTTPS 加解密原理</strong>，希望看完能够有这些收获：</p>
<ul>
<li>明白 HTTPS 到底解决了什么问题</li>
<li>理解对称加密与非对称加密的原理和使用场景</li>
<li>明白 CA 机构和根证书到底起了什么作用</li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/10/15/%E3%80%8A%E5%A4%A7%E5%89%8D%E7%AB%AF%E8%BF%9B%E9%98%B6%20%E5%AE%89%E5%85%A8%E3%80%8B%E7%B3%BB%E5%88%97%20HTTPS%20%E8%AF%A6%E8%A7%A3/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zheyizhifeng.github.io/2021/10/15/Web%20Security/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="lucida">
      <meta itemprop="description" content="文质彬彬，然后君子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucida's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/10/15/Web%20Security/" class="post-title-link" itemprop="url">Web Security</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-10-15 14:47:35" itemprop="dateCreated datePublished" datetime="2021-10-15T14:47:35+08:00">2021-10-15</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-10-18 11:47:41" itemprop="dateModified" datetime="2021-10-18T11:47:41+08:00">2021-10-18</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">网络安全</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Web-Security"><a href="#Web-Security" class="headerlink" title="Web Security"></a>Web Security</h1><h2 id="sql注入"><a href="#sql注入" class="headerlink" title="sql注入"></a>sql注入</h2><h3 id="MySql"><a href="#MySql" class="headerlink" title="MySql"></a>MySql</h3><ul>
<li><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/86021">MySQL False 注入及技巧总结</a></li>
<li><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/85936">MySQL 注入攻击与防御</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzI5MDQ2NjExOQ==&mid=2247484372&idx=1&sn=ffcc51a88c9acf96c312421b75fc2a26&chksm=ec1e33fcdb69baea53838fd545a236c0deb8a42f3b341ee0879c9e4ac9427c2147fab95b6669#rd">sql注入学习总结 </a></li>
<li><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/86005">SQL注入防御与绕过的几种姿势</a></li>
<li><a target="_blank" rel="noopener" href="http://rcoil.me/2017/05/MySQL%E5%81%8F%E9%97%A8%E6%8A%80%E5%B7%A7/">MySQL偏门技巧</a>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/10/15/Web%20Security/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lucida</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div><script color="0,0,255" opacity="0.5" zIndex="-1" count="99" src="https://cdn.jsdelivr.net/npm/canvas-nest.js@1/dist/canvas-nest.js"></script>

    </div>
  </footer>

  
  <script size="300" alpha="0.6" zIndex="-1" src="https://cdn.jsdelivr.net/npm/ribbon.js@1.0.2/dist/ribbon.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/pace.js"></script>

  





</body>
</html>
